<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>گلد کوین - استخراج سکه طلایی</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <style>
        :root {
            --primary: #ffd700;
            --primary-dark: #ff6b00;
            --primary-light: #fff9c4;
            --secondary: #6a11cb;
            --secondary-dark: #2575fc;
            --dark: #0a0a0a;
            --darker: #050505;
            --dark-light: #1a1a1a;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: rgba(0, 0, 0, 0.3);
            --light: #ffffff;
            --gray: #b0b0b0;
            --success: #00ff88;
            --danger: #ff4757;
            --info: #2e86de;
            --warning: #ff9f43;
            --admin: #8e44ad;
            --admin-dark: #6c3483;
            --admin-light: #9b59b6;
            --admin-text: #ffffff;
            --admin-bg: rgba(142, 68, 173, 0.1);
            --admin-border: rgba(142, 68, 173, 0.3);
            --miner-bg: #0f0f23;
            --miner-secondary: #1a1a2e;
            --miner-accent: #00f5ff;
            --miner-purple: #9d4edd;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, 
                var(--darker) 0%, 
                var(--dark) 50%, 
                #1a0b2e 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* بهبود performance برای موبایل */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .coin, .click-effect {
                animation: none !important;
            }
        }

        /* افکت پارالاکس پیشرفته */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(106, 17, 203, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 107, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 215, 0, 0.08) 0%, transparent 50%),
                linear-gradient(45deg, 
                    rgba(10, 10, 10, 0.9) 0%, 
                    rgba(26, 11, 46, 0.8) 50%, 
                    rgba(10, 10, 10, 0.9) 100%);
            z-index: -2;
            animation: backgroundFloat 20s ease-in-out infinite;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
            z-index: -1;
            animation: starMove 100s linear infinite;
        }

        @keyframes backgroundFloat {
            0%, 100% { 
                transform: translate(0, 0) scale(1);
                filter: hue-rotate(0deg);
            }
            33% { 
                transform: translate(-30px, -20px) scale(1.05);
                filter: hue-rotate(60deg);
            }
            66% { 
                transform: translate(20px, 25px) scale(0.95);
                filter: hue-rotate(120deg);
            }
        }

        @keyframes starMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100px, -100px); }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* هدر شیشه‌ای */
        header {
            padding: 15px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
             -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }
        
        .animated-gem {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gemPulse 2s ease-in-out infinite;
            cursor: pointer;
        }
        
        @keyframes gemPulse {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                filter: drop-shadow(0 0 10px var(--primary));
            }
            50% { 
                transform: scale(1.2) rotate(180deg);
                filter: drop-shadow(0 0 25px var(--primary-light));
            }
        }
        
        /* **تغییر شماره 1: بهبود کادر سکه در هدر - شبیه آیکون کاربر** */
        .live-coins {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            backdrop-filter: blur(20px);
            padding: 12px 20px;
            border-radius: 25px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            font-size: 1rem;
            font-weight: 800;
            transition: all 0.4s ease;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
            color: #000 !important;
            min-width: 140px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .live-coins::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            transform: rotate(45deg);
            transition: all 0.8s ease;
        }

        .live-coins:hover::before {
            transform: rotate(45deg) translate(50%, 50%);
        }

        .live-coins:hover {
            transform: scale(1.05) rotate(2deg);
            box-shadow: 0 12px 35px rgba(255, 215, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .live-coins span {
            color: #000 !important;
            font-weight: 800;
            font-size: 1.1rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }

        .live-coins i {
            color: #000 !important;
            font-size: 1.2rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }
        
        /* نویگیشن موبایل شیشه‌ای - بهبود یافته */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 25px 25px 0 0;
            z-index: 1000;
            padding: 12px;
            width: 100%;
            max-width: 100%;
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.3);
            margin: 0;
        }
        
        .nav-icons {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .nav-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            color: var(--gray);
            text-decoration: none;
            font-size: 0.75rem;
            padding: 10px 15px;
            border-radius: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .nav-icon::before {
            content: '';
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: right 0.6s ease;
        }
        
        .nav-icon:hover::before {
            right: 100%;
        }
        
        .nav-icon.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--dark);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.4);
        }
        
        .nav-icon:hover:not(.active) {
            color: var(--primary-light);
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .nav-icon i {
            font-size: 1.3rem;
            transition: all 0.3s ease;
        }
        
        .nav-icon.active i {
            transform: scale(1.3);
        }
        
        /* محتوای اصلی - بهبود فضای پایین */
        .main-content {
            padding: 100px 0 140px;
            min-height: 100vh;
        }
        
        /* استایل‌های جدید برای ماینر */
        .miner-section {
            padding: 20px 0;
        }

        .miner-container {
            background: var(--miner-bg);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid rgba(0, 245, 255, 0.3);
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 245, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .miner-container::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(0, 245, 255, 0.1) 0%, 
                rgba(157, 78, 221, 0.05) 50%, 
                rgba(0, 245, 255, 0.08) 100%);
            pointer-events: none;
        }

        .miner-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .miner-title {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--miner-accent), var(--miner-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 245, 255, 0.5);
        }

        .miner-status {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .status-active {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success);
            border: 1px solid rgba(0, 255, 136, 0.4);
            animation: pulse 2s infinite;
        }

        .status-inactive {
            background: rgba(255, 71, 87, 0.2);
            color: var(--danger);
            border: 1px solid rgba(255, 71, 87, 0.4);
        }

        .miner-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .miner-stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .miner-stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--miner-accent);
        }

        .miner-stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--miner-accent), var(--miner-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .miner-stat-label {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 500;
        }

        .miner-progress {
            margin-bottom: 25px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--light);
        }

        .miner-progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .miner-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--miner-accent), var(--miner-purple));
            border-radius: 10px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .miner-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: -50%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: progressShine 2s infinite;
        }

        .miner-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .miner-btn {
            padding: 15px;
            border-radius: 15px;
            border: none;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .miner-btn::before {
            content: '';
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: right 0.6s ease;
        }

        .miner-btn:hover::before {
            right: 100%;
        }

        .miner-btn-primary {
            background: linear-gradient(135deg, var(--miner-accent), var(--miner-purple));
            color: white;
            box-shadow: 0 8px 25px rgba(0, 245, 255, 0.4);
        }

        .miner-btn-primary:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 245, 255, 0.6);
        }

        .miner-btn-success {
            background: linear-gradient(135deg, var(--success), #00cc6a);
            color: white;
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4);
        }

        .miner-btn-success:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.6);
        }

        .miner-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: var(--gray);
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .miner-history {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-title {
            font-size: 1.2rem;
            color: var(--light);
            margin-bottom: 15px;
            text-align: center;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .history-amount {
            color: var(--miner-accent);
            font-weight: 600;
        }

        .history-time {
            color: var(--gray);
            font-size: 0.8rem;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* **تغییر شماره 2: حذف آمار کاربر فعال و سکه استخراج شده و تغییر چیدمان** */
        
        /* شمارنده سکه */
        .coin-counter-compact {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.2) 0%, 
                rgba(255, 107, 0, 0.15) 100%);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            margin-bottom: 20px;
            font-weight: 800;
            font-size: 1.3rem;
            color: var(--primary);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .coin-counter-compact::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            transform: rotate(45deg);
            transition: all 0.8s ease;
        }
        
        .coin-counter-compact:hover::before {
            transform: rotate(45deg) translate(50%, 50%);
        }
        
        .coin-counter-compact:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.3);
            border-color: var(--primary);
        }
        
        /* دکمه‌های مدرن */
        .btn {
            padding: 15px 25px;
            border-radius: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s ease;
            border: none;
            font-size: 0.95rem;
            width: 100%;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            transition: right 0.6s ease;
        }
        
        .btn:hover::before {
            right: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--dark);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.6);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            backdrop-filter: blur(10px);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: var(--dark);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #00cc6a);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, var(--info), #1e6ec4);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e67e22);
            color: white;
        }
        
        .btn-admin {
            background: linear-gradient(135deg, var(--admin), #9b59b6);
            color: white;
            box-shadow: 0 8px 25px rgba(142, 68, 173, 0.4);
        }
        
        .btn-admin:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(142, 68, 173, 0.6);
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        /* کارت‌های سطح - طراحی مدرن */
        .level-card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--glass-border);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .level-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: var(--progress, 0%);
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            transition: width 0.6s ease;
            border-radius: 0 0 4px 4px;
        }
        
        .level-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 215, 0, 0.5);
        }
        
        .level-card.current {
            border: 2px solid var(--primary);
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.15) 0%, 
                var(--glass) 100%);
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.4);
            transform: scale(1.03);
        }
        
        .level-card.unlocked {
            border: 1px solid rgba(0, 255, 136, 0.5);
            background: rgba(0, 255, 136, 0.08);
        }
        
        .level-card.locked {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.7;
        }
        
        .level-card.purchasable {
            border: 1px solid rgba(255, 159, 67, 0.5);
            background: rgba(255, 159, 67, 0.08);
        }
        
        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .level-title {
            font-size: 1.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .level-bonus {
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.2) 0%, 
                rgba(255, 107, 0, 0.15) 100%);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            color: var(--primary-light);
            font-weight: 600;
        }
        
        .level-price {
            background: linear-gradient(135deg, 
                rgba(255, 159, 67, 0.2) 0%, 
                rgba(255, 107, 0, 0.15) 100%);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--warning);
        }

        /* وضعیت سطح - جدید */
        .level-status {
            font-size: 0.8rem;
            padding: 8px 12px;
            border-radius: 12px;
            margin-top: 10px;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .status-current { 
            background: rgba(255, 215, 0, 0.2); 
            color: var(--primary);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        .status-unlocked { 
            background: rgba(0, 255, 136, 0.2); 
            color: var(--success);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        .status-purchasable { 
            background: rgba(255, 159, 67, 0.2); 
            color: var(--warning);
            border: 1px solid rgba(255, 159, 67, 0.3);
        }
        .status-locked { 
            background: rgba(255, 255, 255, 0.1); 
            color: var(--gray);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* بخش‌ها */
        .section {
            display: none;
            animation: fadeInUp 0.6s ease;
        }
        
        .section.active {
            display: block;
        }

        /* غیرفعال کردن انیمیشن‌ها در بخش‌های غیرفعال */
        .section:not(.active) * {
            animation-play-state: paused !important;
            transition: none !important;
        }

        /* الماس ماینر فقط در بخش فعال انیمیشن داشته باشد */
        #miner-section:not(.active) .miner-diamond-logo {
            animation: none !important;
        }

        #miner-section:not(.active) .mining-hammer {
            display: none !important;
        }
        
        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        /* منوی کاربر */
        .user-menu {
            position: relative;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }
        
        .user-avatar::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent);
            transform: rotate(45deg);
            transition: all 0.8s ease;
        }
        
        .user-avatar:hover::before {
            transform: rotate(45deg) translate(50%, 50%);
        }
        
        .user-avatar:hover {
            transform: scale(1.1) rotate(5deg);
            border-color: var(--primary-light);
            box-shadow: 0 12px 35px rgba(255, 215, 0, 0.5);
        }
        
        /* اصلاح badge سطح کاربر */
        .user-level-badge {
            position: absolute;
            bottom: -2px;
            right: -2px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--dark) !important;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 800;
            border: 2px solid var(--dark);
            z-index: 2;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            -webkit-text-fill-color: var(--dark) !important;
            text-shadow: none;
        }
        
        /* نوتیفیکیشن ارتقاء سطح */
        .level-up-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--glass);
            backdrop-filter: blur(30px);
            border: 2px solid var(--primary);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            z-index: 3000;
            box-shadow: 
                0 0 80px rgba(255, 215, 0, 0.6),
                inset 0 0 50px rgba(255, 215, 0, 0.1);
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 90%;
            width: 350px;
        }
        
        .level-up-notification.show {
            transform: translate(-50%, -50%) scale(1);
        }
        
        .level-up-icon {
            font-size: 4rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            animation: levelUpBounce 1.2s infinite alternate;
        }
        
        @keyframes levelUpBounce {
            0% { 
                transform: scale(1) rotate(-10deg); 
                filter: drop-shadow(0 0 10px var(--primary));
            }
            100% { 
                transform: scale(1.3) rotate(10deg); 
                filter: drop-shadow(0 0 30px var(--primary-light));
            }
        }
        
        /* مودال */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 4000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: var(--glass);
            backdrop-filter: blur(30px);
            border-radius: 25px;
            padding: 30px;
            width: 100%;
            max-width: 450px;
            border: 1px solid var(--glass-border);
            position: relative;
            animation: modalAppear 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-30px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.3s ease;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            transform: scale(1.2);
            background: rgba(255, 215, 0, 0.1);
        }
        
        /* نوار پیشرفت */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 10px;
            transition: width 0.6s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: -50%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: progressShine 2s infinite;
        }
        
        @keyframes progressShine {
            0% { right: -50%; }
            100% { right: 100%; }
        }
        
        /* کنترل‌های فرم */
        .form-control {
            width: 100%;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            color: white;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        /* کانتینر رمز عبور */
        .password-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .password-toggle {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            transition: color 0.3s ease;
            padding: 5px;
            border-radius: 5px;
        }
        
        .password-toggle:hover {
            color: var(--primary);
            background: rgba(255, 215, 0, 0.1);
        }
        
        /* **تغییر شماره 3: بهبود نوتیفیکیشن‌ها برای فرم‌های ورود و ثبت‌نام */
        .notification {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            border-right: 5px solid var(--primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            z-index: 2000;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 90%;
            width: 350px;
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .notification.success {
            border-right-color: var(--success);
        }
        
        .notification.error {
            border-right-color: var(--danger);
        }
        
        .notification.info {
            border-right-color: var(--info);
        }
        
        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification-icon {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .notification.success .notification-icon {
            background: linear-gradient(135deg, var(--success), #00cc6a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .notification.error .notification-icon {
            background: linear-gradient(135deg, var(--danger), #ff2e4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* نوتیفیکیشن‌های مخصوص فرم‌ها */
        .form-notification {
            position: absolute;
            top: -70px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 15px 20px;
            border-right: 5px solid var(--primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            z-index: 2000;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 90%;
            width: 320px;
            opacity: 0;
            visibility: hidden;
        }
        
        .form-notification.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
        
        .form-notification.success {
            border-right-color: var(--success);
        }
        
        .form-notification.error {
            border-right-color: var(--danger);
        }
        
        .form-notification.info {
            border-right-color: var(--info);
        }
        
        .form-notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.9rem;
        }
        
        .form-notification-icon {
            font-size: 1.3rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .form-notification.success .form-notification-icon {
            background: linear-gradient(135deg, var(--success), #00cc6a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .form-notification.error .form-notification-icon {
            background: linear-gradient(135deg, var(--danger), #ff2e4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* نوتیفیکیشن‌های مدرن پنل مدیریت */
        .admin-notification {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--admin-bg);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            border-right: 5px solid var(--admin);
            box-shadow: 0 10px 30px rgba(142, 68, 173, 0.4);
            z-index: 2000;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 90%;
            width: 350px;
            border: 1px solid var(--admin-border);
        }
        
        .admin-notification.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .admin-notification.success {
            border-right-color: var(--success);
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        .admin-notification.error {
            border-right-color: var(--danger);
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid rgba(255, 71, 87, 0.3);
        }
        
        .admin-notification.info {
            border-right-color: var(--info);
            background: rgba(46, 134, 222, 0.1);
            border: 1px solid rgba(46, 134, 222, 0.3);
        }
        
        .admin-notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .admin-notification-icon {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--admin), var(--admin-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .admin-notification.success .admin-notification-icon {
            background: linear-gradient(135deg, var(--success), #00cc6a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .admin-notification.error .admin-notification-icon {
            background: linear-gradient(135deg, var(--danger), #ff2e4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* بخش معرف - تغییر شماره 2: اصلاح چیدمان */
        .referral-code {
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.15) 0%, 
                rgba(255, 107, 0, 0.1) 100%);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            margin: 20px 0;
            border: 1px solid rgba(255, 215, 0, 0.3);
            transition: all 0.4s ease;
        }
        
        .referral-code:hover {
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.2) 0%, 
                rgba(255, 107, 0, 0.15) 100%);
            border-color: rgba(255, 215, 0, 0.5);
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.2);
        }
        
        /* اصلاح کد معرف */
        .code-display {
            font-family: 'Courier New', monospace;
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary) !important;
            background: rgba(0, 0, 0, 0.4) !important;
            -webkit-background-clip: initial !important;
            -webkit-text-fill-color: initial !important;
            background-clip: initial !important;
            letter-spacing: 3px;
            margin: 15px 0;
            padding: 15px;
            border-radius: 12px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.3);
            text-align: center;
            direction: ltr;
        }
        
        /* **تغییر شماره 2: اصلاح چیدمان آمار زیرمجموعه‌گیری */
        .game-stats-compact {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-compact {
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }
        
        .stat-compact:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            font-weight: 500;
        }

        /* لایه مهمان */
        .guest-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .guest-message {
            background: var(--glass);
            backdrop-filter: blur(30px);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid var(--primary);
            max-width: 90%;
            animation: modalAppear 0.4s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        /* انیمیشن‌های Lottie */
        .lottie-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2500;
            display: none;
        }
        
        /* بخش آمار */
        .stats-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }
        
        .stat-icon {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .stat-number {
            font-size: 1.3rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }
        
        .stat-description {
            font-size: 0.8rem;
            color: var(--gray);
            font-weight: 500;
        }
        
        /* بهبود خوانایی متن‌های مهم */
        .stat-value, .stat-number, .countdown-display {
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        /* بهبود contrast برای متن‌های روشن */
        .level-title, .booster-name, .stat-label, .countdown-title {
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* لودینگ - جدید */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }
        /* اضافه کردن به بخش CSS */
.history-list {
    max-height: 200px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) rgba(255,255,255,0.1);
}

.history-list::-webkit-scrollbar {
    width: 6px;
}

.history-list::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.1);
    border-radius: 3px;
}

.history-list::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 3px;
}

.history-list::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

        /* اسکلتون لودینگ */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 10px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* بهبود بخش الزامات سطح */
        .level-requirements {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .level-requirements span {
            font-size: 0.85rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* استایل‌های VIP */
        .vip-plan {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .vip-plan:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* استایل برای کاربران VIP در پروفایل */
        .vip-badge {
            background: linear-gradient(135deg, #ffd700, #ff6b00);
            color: var(--dark);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-right: 8px;
        }

        /* ==================== پنل مدیریت جدید - طراحی یکپارچه با سایت اصلی ==================== */
        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        /* کارت‌های آمار پنل مدیریت */
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        .admin-stat-card {
            background: var(--admin-bg);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid var(--admin-border);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .admin-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(142, 68, 173, 0.1) 0%, 
                transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .admin-stat-card:hover::before {
            opacity: 1;
        }

        .admin-stat-card:hover {
            transform: translateY(-3px) scale(1.02);
            border-color: var(--admin);
            box-shadow: 0 10px 25px rgba(142, 68, 173, 0.2);
        }

        .admin-stat-icon {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--admin), var(--admin-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .admin-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--admin-text);
            margin-bottom: 4px;
            text-shadow: 0 0 10px rgba(142, 68, 173, 0.3);
        }

        .admin-stat-label {
            font-size: 0.75rem;
            color: var(--admin-text);
            opacity: 0.8;
            font-weight: 600;
        }

        /* فرم‌های پنل مدیریت */
        .admin-form-section {
            background: var(--admin-bg);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--admin-border);
        }

        .admin-section-title {
            color: var(--admin-text);
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-section-title i {
            background: linear-gradient(135deg, var(--admin), var(--admin-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-control-group {
            margin-bottom: 12px;
        }

        .admin-label {
            display: block;
            color: var(--admin-text);
            font-size: 0.8rem;
            margin-bottom: 6px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .admin-label i {
            color: var(--admin);
            font-size: 0.7rem;
        }

        .admin-input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--admin-border);
            color: var(--admin-text);
            font-size: 0.8rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--admin);
            box-shadow: 0 0 10px rgba(142, 68, 173, 0.3);
            background: rgba(0, 0, 0, 0.4);
            transform: translateY(-1px);
        }

        .admin-input::placeholder {
            color: var(--gray);
        }

        /* دکمه‌های پنل مدیریت */
        .admin-btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
        }

        .admin-btn {
            padding: 10px 12px;
            border-radius: 10px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s ease;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            position: relative;
            overflow: hidden;
        }

        .admin-btn::before {
            content: '';
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            transition: right 0.6s ease;
        }

        .admin-btn:hover::before {
            right: 100%;
        }

        .admin-btn-primary {
            background: linear-gradient(135deg, var(--admin), var(--admin-light));
            color: white;
            box-shadow: 0 4px 15px rgba(142, 68, 173, 0.4);
        }

        .admin-btn-primary:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(142, 68, 173, 0.6);
        }

        .admin-btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff2e4e);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
        }

        .admin-btn-danger:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.6);
        }

        .admin-btn-success {
            background: linear-gradient(135deg, var(--success), #00cc6a);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
        }

        .admin-btn-success:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.6);
        }

        .admin-btn:active {
            transform: scale(0.95);
        }

        /* جدول کاربران */
        .admin-users-table-container {
            background: var(--admin-bg);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid var(--admin-border);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .admin-users-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            font-size: 0.7rem;
        }

        .admin-users-table th {
            background: linear-gradient(135deg, rgba(142, 68, 173, 0.4), rgba(155, 89, 182, 0.3));
            padding: 10px 8px;
            text-align: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: white;
            border-bottom: 2px solid rgba(142, 68, 173, 0.5);
        }

        .admin-users-table td {
            padding: 8px 6px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.65rem;
            text-align: center;
            transition: all 0.3s ease;
            color: var(--admin-text);
        }

        .admin-users-table tr:last-child td {
            border-bottom: none;
        }

        .admin-users-table tr {
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.02);
        }

        .admin-users-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }

        .admin-users-table tr:hover {
            background: rgba(142, 68, 173, 0.15);
        }

        .user-action-btn {
            padding: 6px 8px;
            border-radius: 6px;
            border: none;
            font-size: 0.65rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1px;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            font-weight: 600;
        }

        .user-edit-btn {
            background: linear-gradient(135deg, rgba(46, 134, 222, 0.3), rgba(46, 134, 222, 0.2));
            color: var(--info);
            border: 1px solid rgba(46, 134, 222, 0.5);
        }

        .user-edit-btn:hover {
            background: linear-gradient(135deg, rgba(46, 134, 222, 0.5), rgba(46, 134, 222, 0.4));
            transform: translateY(-1px);
        }

        .user-delete-btn {
            background: linear-gradient(135deg, rgba(255, 71, 87, 0.3), rgba(255, 71, 87, 0.2));
            color: var(--danger);
            border: 1px solid rgba(255, 71, 87, 0.5);
        }

        .user-delete-btn:hover {
            background: linear-gradient(135deg, rgba(255, 71, 87, 0.5), rgba(255, 71, 87, 0.4));
            transform: translateY(-1px);
        }

        .user-vip-badge {
            background: linear-gradient(135deg, #ffd700, #ff6b00);
            color: var(--dark);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: bold;
            display: inline-block;
        }

        .user-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.6rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-active {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));
            color: var(--success);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .status-inactive {
            background: linear-gradient(135deg, rgba(255, 71, 87, 0.2), rgba(255, 71, 87, 0.1));
            color: var(--danger);
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        /* مودال لاگین ادمین */
        .admin-login-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--glass);
            backdrop-filter: blur(40px);
            border-radius: 20px;
            padding: 25px 15px;
            width: 90%;
            max-width: 350px;
            border: 2px solid var(--admin);
            z-index: 6000;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
        }

        .admin-login-modal.active {
            transform: translate(-50%, -50%) scale(1);
        }

        .virtual-keyboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .keyboard-key {
            padding: 12px;
            background: rgba(142, 68, 173, 0.2);
            border: 1px solid rgba(142, 68, 173, 0.4);
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
        }

        .keyboard-key:hover {
            background: rgba(142, 68, 173, 0.4);
            transform: scale(1.05);
        }

        .keyboard-key:active {
            transform: scale(0.95);
        }

        .admin-code-input {
            font-family: 'Courier New', monospace;
            letter-spacing: 8px;
            text-align: center;
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--admin);
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid var(--glass-border);
        }

        /* استایل‌های جدید برای پنل مدیریت ماینر */
        .miner-admin-panel {
            background: var(--miner-bg);
            border: 1px solid rgba(0, 245, 255, 0.3);
        }

        .miner-admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        .miner-admin-stat {
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.3);
        }

        .miner-admin-stat .admin-stat-icon {
            background: linear-gradient(135deg, var(--miner-accent), var(--miner-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .miner-admin-controls {
            background: rgba(0, 245, 255, 0.05);
            border: 1px solid rgba(0, 245, 255, 0.2);
        }

        .miner-admin-section-title {
            color: var(--miner-accent);
        }

        .miner-admin-section-title i {
            background: linear-gradient(135deg, var(--miner-accent), var(--miner-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ==================== استایل جدید الماس ماینر طلایی - بزرگتر و زیباتر ==================== */
        .miner-logo-container {
            text-align: center;
            margin: 40px 0;
            position: relative;
            overflow: visible;
            z-index: 1;
        }

        /* الماس ماینر بسیار بزرگتر و زیباتر */
        .miner-diamond-logo {
            width: 180px;
            height: 180px;
            background: linear-gradient(135deg, #ffd700, #ff6b00, #ffd700);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            position: relative;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 
                0 0 80px rgba(255, 215, 0, 0.9),
                inset 0 0 50px rgba(255, 255, 255, 0.5);
            border: 4px solid rgba(255, 215, 0, 0.8);
            animation: goldenDiamondPulse 3s ease-in-out infinite;
            transform-style: preserve-3d;
            z-index: 2;
        }

        .miner-diamond-logo i {
            font-size: 5.5rem;
            background: linear-gradient(135deg, #ffffff, #fff9c4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 1));
        }

        /* چکش استخراج بزرگتر */
        .mining-hammer {
            position: absolute;
            top: -70px;
            right: 50%;
            transform: translateX(50%) rotate(-45deg);
            font-size: 3.5rem;
            color: var(--primary);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 3;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 1));
        }

        /* انیمیشن‌های الماس */
        @keyframes goldenDiamondPulse {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                box-shadow: 
                    0 0 80px rgba(255, 215, 0, 0.9),
                    inset 0 0 50px rgba(255, 255, 255, 0.5);
            }
            50% { 
                transform: scale(1.12) rotate(180deg);
                box-shadow: 
                    0 0 120px rgba(255, 107, 0, 1),
                    inset 0 0 60px rgba(255, 255, 255, 0.7);
            }
        }

        @keyframes goldenHammerStrike {
            0%, 100% { 
                transform: translateX(50%) rotate(-45deg) translateY(0);
                opacity: 1;
            }
            50% { 
                transform: translateX(50%) rotate(-45deg) translateY(80px);
                opacity: 1;
            }
            75% {
                transform: translateX(50%) rotate(-45deg) translateY(80px) rotate(25deg);
                opacity: 1;
            }
        }

        /* بهبود افکت hover برای الماس بزرگتر */
        .miner-diamond-logo:hover {
            transform: scale(1.18) rotate(12deg);
            box-shadow: 
                0 0 120px rgba(255, 215, 0, 1),
                inset 0 0 70px rgba(255, 255, 255, 0.8);
        }

        .miner-diamond-logo:hover i {
            transform: scale(1.4);
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 1.5));
        }

        /* الماس در حالت استخراج */
        .miner-diamond-logo.mining-active {
    animation: miningDiamondGlow 2s ease-in-out infinite !important;
}

.miner-diamond-logo.mining-active .mining-hammer {
    animation: goldenHammerStrike 2s ease-in-out infinite !important;
    opacity: 1 !important;
    display: block !important;
}

        @keyframes miningDiamondGlow {
            0%, 100% { 
                transform: scale(1.05);
                box-shadow: 
                    0 0 100px rgba(0, 245, 255, 0.8),
                    inset 0 0 60px rgba(0, 245, 255, 0.3);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 
                    0 0 150px rgba(0, 245, 255, 1),
                    inset 0 0 80px rgba(0, 245, 255, 0.5);
            }
        }

        /* الماس در حالت نیاز به ورود */
        .miner-diamond-logo.login-required {
            animation: loginRequiredPulse 2s ease-in-out infinite;
            filter: grayscale(0.3);
        }

        @keyframes loginRequiredPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 
                    0 0 60px rgba(255, 255, 255, 0.3),
                    inset 0 0 40px rgba(255, 255, 255, 0.2);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 
                    0 0 80px rgba(255, 255, 255, 0.5),
                    inset 0 0 50px rgba(255, 255, 255, 0.3);
            }
        }

        /* متن زیر الماس */
        .miner-login-required {
            margin-top: 20px;
            color: var(--gray);
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        /* ==================== کارت‌های مدرن ماینر ==================== */
.miner-stats-modern {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 25px;
}

.miner-stat-card-modern {
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.1) 0%, 
        rgba(255, 255, 255, 0.05) 100%);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    border: 1px solid rgba(255, 215, 0, 0.3);
    position: relative;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.miner-stat-card-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent,
        rgba(255, 255, 255, 0.1),
        transparent);
    transition: left 0.6s ease;
}

.miner-stat-card-modern:hover::before {
    left: 100%;
}

.miner-stat-card-modern:hover {
    transform: translateY(-8px) scale(1.02);
    border-color: rgba(0, 245, 255, 0.6);
    box-shadow: 
        0 20px 50px rgba(0, 245, 255, 0.3),
        0 8px 32px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

/* کارت در حال استخراج */
.miner-stat-card-modern.mining-active {
    background: linear-gradient(135deg, 
        rgba(0, 245, 255, 0.15) 0%, 
        rgba(157, 78, 221, 0.1) 100%);
    border-color: rgba(0, 245, 255, 0.5);
    animation: cardPulse 2s ease-in-out infinite;
}

/* کارت آماده برداشت */
.miner-stat-card-modern.ready-to-harvest {
    background: linear-gradient(135deg, 
        rgba(0, 255, 136, 0.15) 0%, 
        rgba(0, 200, 100, 0.1) 100%);
    border-color: rgba(0, 255, 136, 0.5);
    animation: cardGlow 1.5s ease-in-out infinite;
}

/* آیکون کارت */
.miner-stat-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
    display: block;
    text-align: center;
    transition: all 0.3s ease;
}

.miner-stat-card-modern:hover .miner-stat-icon {
    transform: scale(1.2) rotate(10deg);
}

/* مقدار عددی */
.miner-stat-value-modern {
    font-size: 1.4rem;
    font-weight: 800;
    text-align: center;
    margin-bottom: 8px;
    background: linear-gradient(135deg, var(--miner-accent), var(--miner-purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 30px rgba(0, 245, 255, 0.5);
    transition: all 0.3s ease;
}

.miner-stat-card-modern:hover .miner-stat-value-modern {
    text-shadow: 0 0 50px rgba(0, 245, 255, 0.8);
}

/* لیبل */
.miner-stat-label-modern {
    font-size: 0.9rem;
    color: var(--gray);
    text-align: center;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
}

/* انیمیشن‌ها */
@keyframes cardPulse {
    0%, 100% { 
        box-shadow: 
            0 8px 32px rgba(0, 245, 255, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    50% { 
        box-shadow: 
            0 15px 45px rgba(0, 245, 255, 0.5),
            0 5px 25px rgba(0, 245, 255, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
}

@keyframes cardGlow {
    0%, 100% { 
        box-shadow: 
            0 8px 32px rgba(0, 255, 136, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    50% { 
        box-shadow: 
            0 15px 45px rgba(0, 255, 136, 0.5),
            0 5px 25px rgba(0, 255, 136, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
}

/* شمارش معکوس ویژه */
.countdown-active {
    animation: countdownPulse 1s ease-in-out infinite;
}

@keyframes countdownPulse {
    0%, 100% { 
        transform: scale(1);
        color: var(--miner-accent);
    }
    50% { 
        transform: scale(1.05);
        color: var(--miner-purple);
    }
}

/* مدیریت فونت تایمر برای زمان‌های طولانی */
#minerTimeLeft {
    font-size: 1.4rem;
    letter-spacing: 1px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--miner-accent), var(--miner-purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 30px rgba(0, 245, 255, 0.5);
}

/* این استایل‌ها رو در تگ <style> اصلی پیدا کن و اضافه کن */

/* استایل برای اعداد بزرگ در بخش تبدیل */
.stat-value {
    transition: all 0.3s ease;
    word-break: break-all;
    text-align: center;
    min-height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

#cashAmount, #dollarAmount, #availableCoins, #conversionRate,
#tomanRateDisplay, #dollarRateDisplay {
    transition: all 0.3s ease;
    word-break: break-all;
    text-align: center;
    min-height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
}

/* استایل برای دکمه‌های مقدار سریع */
.btn-quick-amount {
    transition: all 0.2s ease;
    border: none;
    cursor: pointer;
}

.btn-quick-amount:hover {
    transform: translateY(-2px);
    background: rgba(255, 215, 0, 0.2) !important;
}

/* استایل برای کارت‌های تبدیل */
.stat-compact {
    transition: all 0.3s ease;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

/* برای موبایل */
@media (max-width: 768px) {
    .stat-value {
        font-size: 1.1rem !important;
        min-height: 35px;
    }
    
    #cashAmount, #dollarAmount, #availableCoins, #conversionRate,
    #tomanRateDisplay, #dollarRateDisplay {
        font-size: 1rem !important;
        min-height: 25px;
    }
    
    .stat-compact {
        min-height: 100px;
    }
}

@media (max-width: 768px) {
    #minerTimeLeft {
        font-size: 1.2rem;
        letter-spacing: 0.5px;
    }
}

@media (max-width: 480px) {
    #minerTimeLeft {
        font-size: 1.1rem;
    }
}

/* پیشرفت مدرن */
.miner-progress-modern {
    margin-bottom: 25px;
}

.progress-header-modern {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    font-size: 0.95rem;
    color: var(--light);
    font-weight: 600;
}

.miner-progress-bar-modern {
    width: 100%;
    height: 16px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
}

.miner-progress-fill-modern {
    height: 100%;
    background: linear-gradient(90deg, 
        var(--miner-accent), 
        var(--miner-purple),
        var(--miner-accent));
    border-radius: 10px;
    transition: width 0.5s ease;
    position: relative;
    background-size: 200% 100%;
    animation: progressGradient 3s ease-in-out infinite;
}

@keyframes progressGradient {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

.miner-progress-fill-modern::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.6), 
        transparent);
    animation: progressShine 2s ease-in-out infinite;
}
 
/* این استایل‌های ساده رو اضافه کن */
.profile-sidebar {
    transition: all 0.3s ease;
}

.profile-sidebar:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0,0,0,0.2);
}

.crypto-item, .stat-item, .adv-stat {
    transition: all 0.3s ease;
}

.crypto-item:hover, .stat-item:hover {
    transform: translateY(-3px);
}

.adv-stat:hover {
    background: rgba(255,255,255,0.05) !important;
    border-radius: 10px;
}

/* رسپانسیو برای موبایل */
@media (max-width: 768px) {
    .game-container {
        padding: 15px !important;
    }
    
    .profile-sidebar,
    .stats-card,
    .crypto-card,
    .advanced-stats {
        margin-bottom: 20px;
        padding: 20px !important;
    }
    
    .crypto-card .crypto-item {
        margin-bottom: 15px;
    }
}

/* رفع مشکل موقعیت صفحه توکنومیکس */
#tokenomics-section {
    position: absolute !important;
    top: 80px !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    z-index: 100 !important;
}
        /* رسپانسیو */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .header-content {
                padding: 0 15px;
            }
            
            .logo {
                font-size: 1.1rem;
            }
            
            .live-coins {
                font-size: 0.9rem;
                padding: 10px 16px;
                min-width: 120px;
            }
            
            .live-coins span {
                font-size: 0.9rem;
            }
            
            .main-content {
                padding: 80px 0 140px;
            }
            
            .game-container {
                padding: 20px;
                border-radius: 20px;
            }
            
            .game-area-compact {
                height: 280px;
            }
            
            .coin {
                width: 55px !important;
                height: 55px !important;
                font-size: 1.4rem !important;
            }
            
            .coin.rare {
                width: 65px !important;
                height: 65px !important;
            }
            
            .coin.mega {
                width: 75px !important;
                height: 75px !important;
            }
            
            .mobile-nav {
                display: block;
                padding: 8px;
            }
            
            .boosters-compact {
                grid-template-columns: 1fr;
            }
            
            .level-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .nav-icon {
                padding: 8px;
                font-size: 0.7rem;
            }
            
            .nav-icon i {
                font-size: 1.1rem;
            }
            
            .stats-section {
                grid-template-columns: 1fr;
            }
            
            .code-display {
                font-size: 1.1rem;
                padding: 12px;
            }

            .level-requirements {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }

            /* استایل‌های رسپانسیو ماینر */
            .miner-stats {
                grid-template-columns: 1fr;
            }

            .miner-controls {
                grid-template-columns: 1fr;
            }

            .miner-stat-value {
                font-size: 1.5rem;
            }

            /* پنل مدیریت موبایل */
            .admin-stats-grid {
                grid-template-columns: 1fr;
            }

            .admin-btn-group {
                grid-template-columns: 1fr;
            }

            /* جدول کاربران در موبایل */
            .admin-users-table {
                font-size: 0.6rem;
            }

            .admin-users-table th,
            .admin-users-table td {
                padding: 8px 4px;
            }

            .user-action-btn {
                padding: 4px 6px;
                font-size: 0.6rem;
            }

            .admin-login-modal {
                padding: 20px 12px;
            }

            .admin-code-input {
                font-size: 1.2rem;
                letter-spacing: 6px;
                padding: 12px;
            }

            .keyboard-key {
                padding: 10px;
                font-size: 0.8rem;
            }

            /* پنل مدیریت ماینر موبایل */
            .miner-admin-stats {
                grid-template-columns: 1fr;
            }

            /* الماس ماینر موبایل */
            .miner-logo-container {
                margin: 30px 0;
            }

            .miner-diamond-logo {
                width: 150px;
                height: 150px;
            }

            .miner-diamond-logo i {
                font-size: 4.5rem;
            }

            .mining-hammer {
                font-size: 2.8rem;
                top: -60px;
            }
        }
        
        @media (max-width: 480px) {
            .game-area-compact {
                height: 220px;
            }
            
            .coin {
                width: 45px !important;
                height: 45px !important;
                font-size: 1.1rem !important;
            }
            
            .btn {
                padding: 12px 18px;
                font-size: 0.85rem;
            }
            
            .level-up-notification {
                padding: 25px 15px;
                width: 90%;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .live-coins {
                font-size: 0.8rem;
                padding: 8px 14px;
                min-width: 100px;
            }
            
            .live-coins span {
                font-size: 0.8rem;
            }

            .admin-login-modal {
                padding: 15px 10px;
            }

            .admin-code-input {
                font-size: 1.1rem;
                letter-spacing: 5px;
                padding: 10px;
            }

            .keyboard-key {
                padding: 8px;
                font-size: 0.7rem;
            }

            /* استایل‌های ماینر موبایل */
            .miner-title {
                font-size: 1.5rem;
            }

            .miner-btn {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .admin-users-table {
                font-size: 0.5rem;
            }
            
            .user-action-btn {
                padding: 3px 6px;
                font-size: 0.5rem;
            }

            /* الماس ماینر موبایل کوچک */
            .miner-logo-container {
                margin: 25px 0;
            }

            .miner-diamond-logo {
                width: 130px;
                height: 130px;
            }

            .miner-diamond-logo i {
                font-size: 4rem;
            }

            .mining-hammer {
                font-size: 2.5rem;
                top: -50px;
            }
        }
        /* کاهش فاصله هدر با محتوا */
.main-content {
    padding-top: 10px !important;
    margin-top: 0 !important;
}

.container {
    margin-top: 0 !important;
}

#miner-section,
#levels-section,
#conversion-section,
#vip-section,
#profile-section,
#affiliate-section {
    margin-top: 0 !important;
    padding-top: 10px !important;
}
/* نوتیفیکیشن جایزه ثبت‌نام مدرن - کوچک‌شده */
.signup-bonus-notification {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    border-radius: 20px; /* کوچک‌تر */
    padding: 0;
    z-index: 10000;
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.8), /* کوچک‌تر */
        0 0 0 1px rgba(255, 215, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 215, 0, 0.2);
    opacity: 0;
    transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    max-width: 90%; /* کوچک‌تر */
    width: 360px; /* کوچک‌تر */
    overflow: hidden;
    font-family: 'Vazirmatn', sans-serif;
}

.signup-bonus-notification.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

.bonus-header {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 107, 0, 0.1));
    padding: 25px 25px 15px; /* کوچک‌تر */
    text-align: center;
    border-bottom: 1px solid rgba(255, 215, 0, 0.3);
    position: relative;
}

.bonus-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #ffd700, #ff6b00, #ffd700);
    background-size: 200% 100%;
    animation: shimmer 3s infinite linear;
}

.bonus-icon {
    font-size: 3.5rem; /* کوچک‌تر */
    margin-bottom: 12px; /* کوچک‌تر */
    background: linear-gradient(135deg, #ffd700, #ff6b00);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.5)); /* کوچک‌تر */
    animation: float 3s ease-in-out infinite;
}

.bonus-title {
    color: #fff;
    font-size: 1.4rem; /* کوچک‌تر */
    font-weight: 800;
    margin-bottom: 6px; /* کوچک‌تر */
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.bonus-subtitle {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem; /* کوچک‌تر */
    font-weight: 500;
}

.bonus-body {
    padding: 25px; /* کوچک‌تر */
    text-align: center;
}

.bonus-amount {
    font-size: 2.8rem; /* کوچک‌تر */
    font-weight: 900;
    margin: 15px 0; /* کوچک‌تر */
    background: linear-gradient(135deg, #ffd700, #ff6b00, #ffd700);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 25px rgba(255, 215, 0, 0.5); /* کوچک‌تر */
    animation: pulse 2s infinite;
}

.bonus-message {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1rem; /* کوچک‌تر */
    line-height: 1.5; /* کوچک‌تر */
    margin-bottom: 20px; /* کوچک‌تر */
    font-weight: 500;
}

.bonus-features {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px; /* کوچک‌تر */
    margin: 20px 0; /* کوچک‌تر */
}

.bonus-feature {
    background: rgba(255, 215, 0, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 10px; /* کوچک‌تر */
    padding: 10px; /* کوچک‌تر */
    text-align: center;
    transition: all 0.3s ease;
}

.bonus-feature:hover {
    transform: translateY(-2px);
    background: rgba(255, 215, 0, 0.15);
}

.bonus-feature i {
    color: #ffd700;
    font-size: 1.1rem; /* کوچک‌تر */
    margin-bottom: 5px; /* کوچک‌تر */
    display: block;
}

.bonus-feature span {
    color: #fff;
    font-size: 0.75rem; /* کوچک‌تر */
    font-weight: 600;
    display: block;
}

.bonus-footer {
    padding: 15px 25px 25px; /* کوچک‌تر */
    text-align: center;
}

.bonus-button {
    background: linear-gradient(135deg, #ffd700, #ff6b00);
    border: none;
    padding: 14px 35px; /* کوچک‌تر */
    border-radius: 12px; /* کوچک‌تر */
    color: #000;
    font-weight: 800;
    font-size: 1rem; /* کوچک‌تر */
    cursor: pointer;
    transition: all 0.4s ease;
    box-shadow: 
        0 8px 25px rgba(255, 215, 0, 0.4), /* کوچک‌تر */
        0 0 0 1px rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
}

.bonus-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.6s ease;
}

.bonus-button:hover::before {
    left: 100%;
}

.bonus-button:hover {
    transform: translateY(-2px) scale(1.03); /* کوچک‌تر */
    box-shadow: 
        0 12px 30px rgba(255, 215, 0, 0.6), /* کوچک‌تر */
        0 0 0 1px rgba(255, 255, 255, 0.2);
}

.bonus-confetti {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
    z-index: -1;
}

@keyframes float {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-8px) rotate(5deg); } /* کوچک‌تر */
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.03); } /* کوچک‌تر */
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

/* انیمیشن کانفی */
.confetti-piece {
    position: absolute;
    width: 8px;
    height: 16px;
    background: linear-gradient(45deg, #ffd700, #ff6b00, #ffd700);
    opacity: 0;
    animation: confetti-fall 5s linear infinite;
}

@keyframes confetti-fall {
    0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
    }
    100% {
        transform: translateY(1000px) rotate(360deg);
        opacity: 0;
    }
}
/* استایل پروسه تأیید شبکه انگلیسی */
.network-confirmation {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    border-radius: 20px;
    padding: 30px;
    z-index: 10000;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8);
    border: 2px solid rgba(0, 245, 255, 0.3);
    opacity: 0;
    transition: all 0.5s ease;
    max-width: 90%;
    width: 400px;
    text-align: center;
    font-family: 'Vazirmatn', sans-serif;
}

.network-confirmation.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

.confirmation-header {
    margin-bottom: 25px;
}

.confirmation-icon {
    font-size: 3.5rem;
    color: #00f5ff;
    margin-bottom: 15px;
    animation: spin 2s linear infinite;
}

.confirmation-title {
    color: #fff;
    font-size: 1.4rem;
    font-weight: 800;
    margin-bottom: 8px;
}

.confirmation-subtitle {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
}

.confirmation-progress {
    margin: 25px 0;
}

.progress-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    position: relative;
}

.progress-steps::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 10%;
    right: 10%;
    height: 3px;
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-50%);
    z-index: 1;
}

.progress-step {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.8rem;
    font-weight: bold;
    position: relative;
    z-index: 2;
    transition: all 0.3s ease;
}

.progress-step.active {
    background: #00f5ff;
    border-color: #00f5ff;
    color: #000;
    box-shadow: 0 0 15px rgba(0, 245, 255, 0.5);
}

.progress-step.completed {
    background: #00ff88;
    border-color: #00ff88;
    color: #000;
}

.progress-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.6);
    margin-top: 5px;
}

.progress-label {
    text-align: center;
    width: 35px;
}

.confirmation-details {
    background: rgba(0, 245, 255, 0.1);
    border-radius: 12px;
    padding: 15px;
    margin: 20px 0;
    border: 1px solid rgba(0, 245, 255, 0.2);
}

.detail-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.85rem;
}

.detail-label {
    color: rgba(255, 255, 255, 0.7);
}

.detail-value {
    color: #00f5ff;
    font-weight: 600;
    direction: ltr;
    font-family: 'Courier New', monospace;
}

.confirmation-timer {
    color: #ffd700;
    font-size: 0.9rem;
    font-weight: 600;
    margin: 15px 0;
}

.confirmation-footer {
    margin-top: 20px;
}

.confirmation-button {
    background: linear-gradient(135deg, #00f5ff, #0099ff);
    border: none;
    padding: 12px 30px;
    border-radius: 10px;
    color: #000;
    font-weight: 800;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.confirmation-button:disabled {
    background: rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.5);
    cursor: not-allowed;
}

.network-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.network-overlay.show {
    opacity: 1;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.network-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.network-overlay.show {
    opacity: 1;
}
/* استایل‌های پیغام برداشت */
.withdrawal-message button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
}

.withdrawal-message button:active {
    transform: translateY(0);
}

.withdrawal-message button[onclick="closeWithdrawalMessage(this)"]:hover {
    background: rgba(255, 215, 0, 0.2) !important;
    transform: rotate(90deg);
}

@media (max-width: 480px) {
    .withdrawal-message {
        padding: 25px 20px !important;
    }
    
    .withdrawal-message h3 {
        font-size: 1.2rem !important;
    }
}
    </style>
</head>
<body>
    <!-- Lottie Animations Container -->
    <div class="lottie-container" id="celebrationAnimation">
        <lottie-player 
            src="https://assets1.lottiefiles.com/packages/lf20_sk5h1kfn.json"  
            background="transparent" 
            speed="1" 
            style="width: 100%; height: 100%;"
            loop autoplay>
        </lottie-player>
    </div>

    <!-- هدر انگلیسی شده -->
<header style="background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding: 15px 0 10px 0; position: sticky; top: 0; left: 0; right: 0; z-index: 1000; margin: 0;">
    
    <!-- افکت نور پس‌زمینه -->
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
                background: radial-gradient(circle at 20% 50%, rgba(0, 245, 255, 0.05), transparent 50%),
                           radial-gradient(circle at 80% 50%, rgba(157, 78, 221, 0.03), transparent 50%); 
                pointer-events: none;"></div>

    <div class="header-content" style="display: flex; justify-content: space-between; align-items: center; 
                                      max-width: 1200px; margin: 0 auto; padding: 0 20px; position: relative; z-index: 2;">
        
        <!-- Left Section - Brand -->
        <div style="display: flex; align-items: center; gap: 16px;">
            <!-- Logo -->
            <div style="display: flex; align-items: center; gap: 12px;">
                <div class="logo-3d" style="width: 36px; height: 36px; background: linear-gradient(135deg, #00f5ff, #9d4edd); 
                          border-radius: 8px; display: flex; align-items: center; justify-content: center;
                          cursor: pointer; position: relative;"
                     id="adminGemAccess">
                    <i class="fas fa-gem" style="color: #ffffff; font-size: 1rem;"></i>
                </div>
                
                <!-- Brand -->
                <span style="color: #ffffff; font-size: 1.2rem; font-weight: 700;
                            background: linear-gradient(135deg, #ffffff, #a0a0a0);
                            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
                            background-clip: text; letter-spacing: -0.3px;
                            font-family: 'Vazirmatn', 'Segoe UI', sans-serif;">
                    GOLD COIN
                </span>
            </div>
        </div>

        <!-- Right Section - User Information -->
        <div style="display: flex; align-items: center; gap: 16px;">
            
            <!-- Coin Display -->
            <div class="holographic-card" style="display: flex; align-items: center; gap: 8px; 
                     background: rgba(255, 215, 0, 0.08); padding: 8px 16px; border-radius: 12px;
                     border: 1px solid rgba(255, 215, 0, 0.2); position: relative;">
                <i class="fas fa-coins" style="color: #ffd700; font-size: 1rem;"></i>
                <span id="headerCoinCount" style="color: #ffffff; font-weight: 600; font-size: 1rem;
                       direction: ltr; font-family: 'Courier New', monospace;">
                    0
                </span>
            </div>

            <!-- Avatar with Dropdown Menu -->
            <div class="user-menu-container" style="position: relative;">
                <div class="avatar-3d" id="userAvatarBtn" style="width: 40px; height: 40px; 
                     background: linear-gradient(135deg, #667eea, #764ba2);
                     border-radius: 10px; display: flex; align-items: center; 
                     justify-content: center; cursor: pointer; position: relative;">
                    <i class="fas fa-user" style="color: #ffffff; font-size: 1rem;"></i>
                    
                    <!-- Level Badge -->
                    <div class="user-level-badge" id="userLevelBadge" style="position: absolute; bottom: -4px; right: -4px; 
                             background: linear-gradient(135deg, #ffd700, #ff6b00);
                             color: #000000; border-radius: 8px; width: 18px; height: 18px; 
                             display: flex; align-items: center; justify-content: center; 
                             font-size: 0.7rem; font-weight: 800; border: 2px solid #0a0a0a;">
                        1
                    </div>
                </div>

                <!-- Dropdown Menu -->
                <div class="user-dropdown-menu" style="position: absolute; top: 100%; left: 0; margin-top: 8px;
                         background: rgba(20, 20, 30, 0.95); backdrop-filter: blur(20px); 
                         border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px;
                         padding: 8px 0; min-width: 200px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
                         opacity: 0; visibility: hidden; transform: translateY(-10px);
                         transition: all 0.3s ease; z-index: 1000;">
                    
                    <!-- User Information -->
                    <div style="padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div style="color: #ffffff; font-weight: 600; font-size: 0.9rem;" id="dropdownUserName">Please login</div>
                        <div style="color: #b0b0b0; font-size: 0.8rem; margin-top: 4px;" id="dropdownUserBalance">Balance: 0 Tether</div>
                    </div>
                    
                    <!-- Menu Items -->
                    <div style="padding: 8px 0;">
                        <div class="dropdown-item" onclick="showDepositWithdraw()" style="display: flex; align-items: center; gap: 8px;
                            padding: 10px 16px; color: #ffffff; text-decoration: none; font-size: 0.85rem;
                            transition: background 0.2s ease; cursor: pointer;">
                            <i class="fas fa-exchange-alt" style="width: 16px;"></i>
                            Withdraw to Wallet
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="dynamic-status-bar" style="height: 2px; width: 100%; 
                background: linear-gradient(90deg, #00f5ff, #9d4edd, #ff6b00, #00f5ff);
                background-size: 400% 100%; animation: gradientFlow 4s infinite linear;
                position: absolute; bottom: 0; left: 0;">
    </div>
</header>

<script>
// مدیریت منوی کشویی
document.addEventListener('DOMContentLoaded', function() {
    const userAvatar = document.getElementById('userAvatarBtn');
    const dropdownMenu = document.querySelector('.user-dropdown-menu');
    
    if (userAvatar && dropdownMenu) {
        userAvatar.addEventListener('click', function(e) {
            e.stopPropagation();
            e.preventDefault();
            
            const isVisible = dropdownMenu.style.opacity === '1';
            
            if (isVisible) {
                dropdownMenu.style.opacity = '0';
                dropdownMenu.style.visibility = 'hidden';
                dropdownMenu.style.transform = 'translateY(-10px)';
            } else {
                dropdownMenu.style.opacity = '1';
                dropdownMenu.style.visibility = 'visible';
                dropdownMenu.style.transform = 'translateY(0)';
            }
        });
        
        // بستن منو با کلیک خارج
        document.addEventListener('click', function() {
            dropdownMenu.style.opacity = '0';
            dropdownMenu.style.visibility = 'hidden';
            dropdownMenu.style.transform = 'translateY(-10px)';
        });
        
        // جلوگیری از بستن منو با کلیک داخل منو
        dropdownMenu.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }
});

// تابع برای بروزرسانی اطلاعات منو
function updateUserDropdown() {
    const userNameElement = document.getElementById('dropdownUserName');
    const userBalanceElement = document.getElementById('dropdownUserBalance');
    const userLevelBadge = document.getElementById('userLevelBadge');
    
    if (window.userSystem && window.userSystem.currentUser) {
        userNameElement.textContent = window.userSystem.currentUser.name;
        
        // 🔥 **فقط تتر نمایش داده بشه**
        const tetherBalance = cryptoRateSystem.getUserBalances().tether || 0;
        
        userBalanceElement.textContent = `Tether: ${tetherBalance.toFixed(6)} USDT`;
        
        if (userLevelBadge) {
            userLevelBadge.textContent = window.levelSystem.currentLevel;
        }
    } else {
        userNameElement.textContent = 'Please login';
        userBalanceElement.textContent = 'Tether: ۰ USDT';
        if (userLevelBadge) {
            userLevelBadge.textContent = '1';
        }
    }
}

// توابع منو
// تابع نمایش پیغام مدرن برای برداشت
function showDepositWithdraw() {
    if (!window.userSystem || !window.userSystem.currentUser) {
        showNotification('Please login', 'error');
        return;
    }
    
    // ایجاد overlay
    const overlay = document.createElement('div');
    overlay.className = 'withdrawal-overlay';
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    `;

    // ایجاد پیغام مدرن
    const messageBox = document.createElement('div');
    messageBox.className = 'withdrawal-message';
    messageBox.style.cssText = `
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border-radius: 20px;
        padding: 30px;
        max-width: 400px;
        width: 90%;
        text-align: center;
        border: 2px solid rgba(255, 215, 0, 0.3);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        transform: scale(0.9);
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
        overflow: hidden;
    `;

    messageBox.innerHTML = `
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
                    background: radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.1), transparent 50%);
                    pointer-events: none;"></div>
        
        <div style="width: 80px; height: 80px; margin: 0 auto 20px; 
                    background: linear-gradient(135deg, #ffd700, #ff6b00);
                    border-radius: 50%; display: flex; align-items: center; 
                    justify-content: center; font-size: 2rem; color: white;
                    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);">
            <i class="fas fa-clock"></i>
        </div>

        <h3 style="color: #ffd700; margin-bottom: 15px; font-size: 1.4rem; font-weight: 700;">
            ⏳ Withdrawal Time
        </h3>

        <div style="color: rgba(255, 255, 255, 0.9); line-height: 1.6; margin-bottom: 25px; font-size: 0.95rem;">
            <p style="margin-bottom: 12px;">
                <strong>All withdrawals are processed after each mining phase ends.</strong>
            </p>
            <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem;">
                You can check your balance anytime in your 
                <strong style="color: #ffd700;">User Profile</strong> 
                section.
            </p>
        </div>

        <div style="background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 12px; 
                    border: 1px solid rgba(255, 215, 0, 0.3); margin-bottom: 20px;">
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px; 
                        color: #ffd700; font-size: 0.85rem; margin-bottom: 8px;">
                <i class="fas fa-info-circle"></i>
                <span>Important Information</span>
            </div>
            <div style="color: rgba(255, 255, 255, 0.8); font-size: 0.8rem; line-height: 1.4;">
                • Current Phase: <strong>Phase 1</strong><br>
                • Status: <strong style="color: #00ff88;">Mining Active</strong>
            </div>
        </div>

        <div style="display: flex; gap: 12px;">
            <button onclick="closeWithdrawalMessage(this)" 
                    style="flex: 1; padding: 12px; background: linear-gradient(135deg, #ffd700, #ff6b00);
                           border: none; border-radius: 10px; color: black; font-weight: 700; 
                           cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem;">
                <i class="fas fa-check"></i> Got it
            </button>
            <button onclick="goToProfileSection()" 
                    style="flex: 1; padding: 12px; background: rgba(255, 255, 255, 0.1);
                           border: 1px solid rgba(255, 215, 0, 0.5); border-radius: 10px; 
                           color: #ffd700; font-weight: 600; cursor: pointer; 
                           transition: all 0.3s ease; font-size: 0.9rem;">
                <i class="fas fa-user"></i> Profile
            </button>
        </div>

        <button onclick="closeWithdrawalMessage(this)" 
                style="position: absolute; top: 15px; left: 15px; background: rgba(255, 215, 0, 0.1); 
                       border: none; width: 35px; height: 35px; border-radius: 50%; 
                       color: #ffd700; cursor: pointer; display: flex; align-items: center; 
                       justify-content: center; font-size: 1.1rem; transition: all 0.3s ease;">
            <i class="fas fa-times"></i>
        </button>
    `;

    overlay.appendChild(messageBox);
    document.body.appendChild(overlay);

    setTimeout(() => {
        overlay.style.opacity = '1';
        messageBox.style.opacity = '1';
        messageBox.style.transform = 'scale(1)';
    }, 100);

    closeDropdown();
}

// تابع بستن پیغام
function closeWithdrawalMessage(button) {
    const messageBox = button.closest('.withdrawal-message');
    const overlay = document.querySelector('.withdrawal-overlay');
    
    if (messageBox) {
        messageBox.style.opacity = '0';
        messageBox.style.transform = 'scale(0.9)';
    }
    
    if (overlay) {
        overlay.style.opacity = '0';
    }
    
    setTimeout(() => {
        if (messageBox) messageBox.remove();
        if (overlay) overlay.remove();
    }, 300);
}

// تابع رفتن به بخش پروفایل
function goToProfileSection() {
    const messageBox = document.querySelector('.withdrawal-message');
    const overlay = document.querySelector('.withdrawal-overlay');
    
    if (messageBox) messageBox.remove();
    if (overlay) overlay.remove();
    
    sections.forEach(section => section.classList.remove('active'));
    const profileSection = document.getElementById('profile-section');
    if (profileSection) profileSection.classList.add('active');
    
    navIcons.forEach(icon => icon.classList.remove('active'));
    const profileNav = document.querySelector('[data-section="profile-section"]');
    if (profileNav) profileNav.classList.add('active');
    
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showWheel() {
    if (!window.userSystem || !window.userSystem.currentUser) {
        showNotification('Please log in to your account first', 'error');
        return;
    }
    showNotification('گردونه شانس به زودی اضافه می‌شود!', 'info');
    closeDropdown();
}

function closeDropdown() {
    const dropdownMenu = document.querySelector('.user-dropdown-menu');
    if (dropdownMenu) {
        dropdownMenu.style.opacity = '0';
        dropdownMenu.style.visibility = 'hidden';
        dropdownMenu.style.transform = 'translateY(-10px)';
    }
}

// بروزرسانی منو هنگام تغییر کاربر
setInterval(updateUserDropdown, 1000);
</script>

    <!-- Level Up Notification -->
    <div class="level-up-notification" id="levelUpNotification">
        <div class="level-up-icon">
            <i class="fas fa-trophy"></i>
        </div>
        <h3 style="color: var(--primary); margin-bottom: 15px; text-align: center;" id="levelUpTitle">تبریک! سطح شما ارتقا یافت</h3>
        <p style="color: var(--light); margin-bottom: 15px; text-align: center; line-height: 1.6;" id="levelUpMessage">شما اکنون در سطح <span id="newLevel" style="color: var(--primary); font-weight: bold;">1</span> هستید!</p>
        <div style="background: rgba(255, 215, 0, 0.15); padding: 15px; border-radius: 15px; margin: 15px 0; border: 1px solid rgba(255, 215, 0, 0.3);">
            <i class="fas fa-gift" style="color: var(--primary); margin-left: 8px;"></i>
            <span style="color: var(--light);">Your coin income +<span id="bonusPercent" style="color: var(--primary); font-weight: bold;">0</span>% increased</span>
        </div>
        <button class="btn btn-primary" onclick="closeLevelUp()" style="margin-top: 10px;">Continue</button>
    </div>

    <!-- Login Modal -->
<div class="modal" id="loginModal">
    <div class="modal-content">
        <button class="close-modal" id="closeLoginModal">&times;</button>
        <h3 style="color: var(--primary); text-align: center; margin-bottom: 25px; font-size: 1.4rem;">Login to Account</h3>
        
        <!-- Form Notification -->
        <div class="form-notification" id="loginFormNotification"></div>
        
        <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email">
        <div class="password-container">
            <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" style="padding-left: 45px;">
            <button type="button" class="password-toggle" id="toggleLoginPassword">
                <i class="fas fa-eye"></i>
            </button>
        </div>
        <button class="btn btn-primary" id="loginBtnModal" style="margin-top: 10px;">Login</button>
        <p style="text-align: center; margin-top: 20px; color: var(--gray); font-size: 0.9rem;">
            Don't have an account? 
            <a href="#" style="color: var(--primary); font-weight: 600;" id="showRegister">Sign Up</a>
        </p>
    </div>
</div>

<!-- Register Modal -->
<div class="modal" id="registerModal">
    <div class="modal-content">
        <button class="close-modal" id="closeRegisterModal">&times;</button>
        <h3 style="color: var(--primary); text-align: center; margin-bottom: 25px; font-size: 1.4rem;">Sign Up in Gold Coin</h3>
        
        <!-- Form Notification -->
        <div class="form-notification" id="registerFormNotification"></div>
        
        <input type="text" id="registerName" class="form-control" placeholder="Enter your full name">
        <input type="email" id="registerEmail" class="form-control" placeholder="Enter your email" required>
        <div class="password-container">
            <input type="password" id="registerPassword" class="form-control" placeholder="Enter your password" style="padding-left: 45px;">
            <button type="button" class="password-toggle" id="toggleRegisterPassword">
                <i class="fas fa-eye"></i>
            </button>
        </div>
        <div class="password-container">
            <input type="password" id="registerConfirmPassword" class="form-control" placeholder="Confirm password" style="padding-left: 45px;">
            <button type="button" class="password-toggle" id="toggleConfirmPassword">
                <i class="fas fa-eye"></i>
            </button>
        </div>
        <input type="text" id="referralCode" class="form-control" placeholder="Referral code (optional)">
        <button class="btn btn-primary" id="registerBtnModal" style="margin-top: 10px;">Sign Up</button>
        <p style="text-align: center; margin-top: 20px; color: var(--gray); font-size: 0.9rem;">
            Already have an account? 
            <a href="#" style="color: var(--primary); font-weight: 600;" id="showLogin">Login</a>
        </p>
    </div>
</div>

    <!-- VIP Activated Modal -->
    <div class="modal" id="vipActivatedModal">
        <div class="modal-content">
            <button class="close-modal" id="closeVipModal">&times;</button>
            <div style="text-align: center;">
                <i class="fas fa-crown" style="font-size: 4rem; background: linear-gradient(135deg, #ffd700, #ff6b00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 20px;"></i>
                <h3 style="color: var(--primary); margin-bottom: 15px;" id="vipModalTitle">تبریک! VIP شدید</h3>
                <p style="color: var(--light); margin-bottom: 20px; line-height: 1.6;" id="vipModalMessage">شما اکنون از امکانات ویژه برخوردار هستید!</p>
                <div style="background: rgba(255, 215, 0, 0.15); padding: 15px; border-radius: 15px; margin: 15px 0; border: 1px solid rgba(255, 215, 0, 0.3);">
                    <i class="fas fa-gift" style="color: var(--primary); margin-left: 8px;"></i>
                    <span style="color: var(--light);">Unlimited mining activated</span>
                </div>
                <button class="btn btn-primary" onclick="closeVipModal()" style="margin-top: 10px;">Continue</button>
            </div>
        </div>
    </div>

    <!-- Limit Reached Modal -->
    <div class="modal" id="limitReachedModal">
        <div class="modal-content">
            <button class="close-modal" id="closeLimitModal">&times;</button>
            <div style="text-align: center;">
                <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: var(--warning); margin-bottom: 20px;"></i>
                <h3 style="color: var(--warning); margin-bottom: 15px;">Mining limit</h3>
                <p style="color: var(--light); margin-bottom: 20px; line-height: 1.6;">
                    You ve reached the mining limit <span id="limitType" style="font-weight: bold;">Daily</span> reached
                    For unlimited mining, choose one of the VIP plans
                </p>
                <div style="background: rgba(255, 159, 67, 0.15); padding: 15px; border-radius: 15px; margin: 15px 0; border: 1px solid rgba(255, 159, 67, 0.3);">
                    <i class="fas fa-crown" style="color: var(--warning); margin-left: 8px;"></i>
                    <span style="color: var(--light);">با VIP removes all limits</span>
                </div>
                <button class="btn btn-warning" onclick="goToVipSection()" style="margin-top: 10px;">View VIP plans</button>
                <button class="btn btn-outline" onclick="closeLimitModal()" style="margin-top: 10px;">Later</button>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="admin-login-modal" id="adminLoginModal">
        <div style="text-align: center; margin-bottom: 20px;">
            <i class="fas fa-shield-alt" style="font-size: 2.5rem; background: linear-gradient(135deg, var(--admin), var(--admin-light)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px;"></i>
            <h3 style="color: var(--admin-text); margin-bottom: 8px; font-size: 1.2rem;">ورود به پنل مدیریت</h3>
            <p style="color: var(--gray); font-size: 0.8rem; line-height: 1.6;">لطفاً کد امنیتی ۸ رقمی را وارد کنید</p>
        </div>
        
        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: center; border: 1px solid var(--glass-border);">
            <div class="admin-code-input" id="adminCodeDisplay">________</div>
        </div>

        <div class="virtual-keyboard">
            <div class="keyboard-key" data-key="1">1</div>
            <div class="keyboard-key" data-key="2">2</div>
            <div class="keyboard-key" data-key="3">3</div>
            <div class="keyboard-key" data-key="4">4</div>
            <div class="keyboard-key" data-key="5">5</div>
            <div class="keyboard-key" data-key="6">6</div>
            <div class="keyboard-key" data-key="7">7</div>
            <div class="keyboard-key" data-key="8">8</div>
            <div class="keyboard-key" data-key="9">9</div>
            <div class="keyboard-key" data-key="0">0</div>
            <div class="keyboard-key" data-key="clear" style="grid-column: span 2;">
                <i class="fas fa-backspace"></i>
            </div>
        </div>

        <div class="admin-btn-group" style="margin-top: 15px;">
            <button class="admin-btn admin-btn-primary" id="adminLoginBtn">
                <i class="fas fa-sign-in-alt"></i> ورود به پنل
            </button>
            <button class="admin-btn admin-btn-danger" id="adminLoginCancel">
                <i class="fas fa-times"></i> انصراف
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Miner Section - Main Page -->
<section id="miner-section" class="section active">
    <div class="miner-section">
        <div class="miner-container">
            <div class="miner-header">
                <h1 class="miner-title">⛏️ Smart Miner</h1>
                <div class="miner-status status-inactive" id="minerStatus">Inactive</div>
            </div>
            
            <!-- Golden Miner Diamond -->
            <div class="miner-logo-container">
                <div class="miner-diamond-logo" id="minerDiamondLogo">
                    <i class="fas fa-gem"></i>
                    <div class="mining-hammer">
                        <i class="fas fa-hammer"></i>
                    </div>
                </div>
                <div class="miner-login-required" id="minerLoginRequired">
                    Login to start mining
                </div>
            </div>

            <div class="miner-stats-modern">
                <div class="miner-stat-card-modern" id="coinsCard">
                    <i class="fas fa-coins miner-stat-icon"></i>
                    <div class="miner-stat-value-modern" id="minerCollected">0</div>
                    <div class="miner-stat-label-modern">Coins Collected</div>
                </div>
                <div class="miner-stat-card-modern" id="timeCard">
                    <i class="fas fa-clock miner-stat-icon"></i>
                    <div class="miner-stat-value-modern" id="minerTimeLeft">0:00:00</div>
                    <div class="miner-stat-label-modern">Time Remaining</div>
                </div>
            </div>

            <div class="miner-progress-modern">
                <div class="progress-header-modern">
                    <span>⏳ Mining Progress</span>
                    <span id="minerProgressPercent">0%</span>
                </div>
                <div class="miner-progress-bar-modern">
                    <div class="miner-progress-fill-modern" id="minerProgressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="miner-controls">
                <button class="miner-btn miner-btn-primary" id="startMinerBtn">
                    <i class="fas fa-play"></i>
                    Start Mining
                </button>
                <button class="miner-btn miner-btn-success" id="harvestMinerBtn" disabled>
                    <i class="fas fa-coins"></i>
                    Harvest Coins
                </button>
            </div>

            <div class="miner-history">
                <h3 class="history-title">Mining History</h3>
                <div class="history-list" id="minerHistoryList">
                    <!-- Mining history will be displayed here -->
                </div>
            </div>
        </div>
    </div>
</section>

            <!-- Levels Section -->
<section id="levels-section" class="section">
    <div class="game-container">
        <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center; font-size: 1.5rem;">Level System</h3>
        <p style="color: var(--gray); text-align: center; margin-bottom: 25px; font-size: 0.95rem; line-height: 1.6;">
            💡 <strong style="color: var(--primary-light);">Level 1 and 2 are free</strong> - Other levels can be purchased with coins
        </p>
        
        <!-- New layout similar to referral section -->
        <div class="game-stats-compact" style="margin-bottom: 20px;">
            <div class="stat-compact">
                <div class="stat-value" id="currentLevelDisplay">1</div>
                <div class="stat-label">Current Level</div>
            </div>
            <div class="stat-compact">
                <div class="stat-value" id="totalXpDisplay">0</div>
                <div class="stat-label">Total XP</div>
            </div>
        </div>

        <div class="game-stats-compact" style="margin-bottom: 25px;">
            <div class="stat-compact">
                <div class="stat-value" id="nextLevelXp">50</div>
                <div class="stat-label">XP Required for Next Level</div>
            </div>
            <div class="stat-compact">
                <div class="stat-value" id="levelBonus">0%</div>
                <div class="stat-label">Level Bonus</div>
            </div>
        </div>

        <!-- Level cards in grid -->
        <div id="levelsContainer" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <!-- Levels will be generated here -->
        </div>
    </div>
</section>

            <!-- Conversion Section -->
<section id="conversion-section" class="section">
    <div class="game-container" style="max-width: 100%; overflow: hidden;">
        <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center; font-size: 1.5rem;">💱 Convert Coins to Cryptocurrency</h3>
        
        <!-- Conversion rate card -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
            <div style="background: var(--glass); backdrop-filter: blur(10px); padding: 15px; border-radius: 15px; text-align: center; border: 1px solid var(--glass-border);">
                <i class="fas fa-coins" style="color: var(--primary); font-size: 1.5rem; margin-bottom: 8px;"></i>
                <div style="color: var(--light); font-size: 1.2rem; font-weight: bold;" id="availableCoins">0</div>
                <div style="color: var(--gray); font-size: 0.8rem;">Available Coins</div>
            </div>
            <div style="background: var(--glass); backdrop-filter: blur(10px); padding: 15px; border-radius: 15px; text-align: center; border: 1px solid var(--glass-border);">
                <i class="fas fa-exchange-alt" style="color: var(--primary); font-size: 1.5rem; margin-bottom: 8px;"></i>
                <div style="color: var(--light); font-size: 1.2rem; font-weight: bold;" id="conversionRate">0.0001</div>
                <div style="color: var(--gray); font-size: 0.8rem;">Conversion Rate (USDT)</div>
            </div>
        </div>

        <!-- Main conversion section -->
        <div style="background: var(--glass); backdrop-filter: blur(15px); padding: 20px; border-radius: 20px; margin-bottom: 20px; border: 1px solid var(--glass-border); max-width: 100%;">
            
            <!-- Live rates display -->
            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 107, 0, 0.05) 100%); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(255, 215, 0, 0.3);">
                <div style="color: var(--primary); font-size: 0.9rem; font-weight: 600; margin-bottom: 12px; text-align: center;">
                    <i class="fas fa-chart-line"></i> Live Exchange Rates
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; text-align: center;">
                    <div>
                        <div style="color: #f7931a; font-size: 0.75rem; font-weight: 600;">
                            <i class="fab fa-bitcoin"></i> Bitcoin
                        </div>
                        <div style="color: var(--light); font-size: 0.7rem; font-family: 'Courier New';" id="btcRateDisplay">
                            $0
                        </div>
                    </div>
                    <div>
                        <div style="color: #6946d2; font-size: 0.75rem; font-weight: 600;">
                            <i class="fab fa-ethereum"></i> Ethereum
                        </div>
                        <div style="color: var(--light); font-size: 0.7rem; font-family: 'Courier New';" id="ethRateDisplay">
                            $0
                        </div>
                    </div>
                    <div>
                        <div style="color: var(--info); font-size: 0.75rem; font-weight: 600;">
                            <i class="fas fa-coins"></i> Tether
                        </div>
                        <div style="color: var(--light); font-size: 0.7rem; font-family: 'Courier New';" id="usdtRateDisplay">
                            $0
                        </div>
                    </div>
                </div>
                <div id="lastRatesUpdate" style="color: var(--gray); font-size: 0.65rem; text-align: center; margin-top: 8px;">
                    Loading rates...
                </div>
            </div>

            <!-- Coin input -->
            <div style="margin-bottom: 20px;">
                <label style="color: var(--light); margin-bottom: 8px; display: block; font-weight: 600; font-size: 0.9rem;">
                    <i class="fas fa-coins" style="margin-left: 6px;"></i>
                    Number of coins to convert
                </label>
                <div style="position: relative;">
                    <input type="number" id="coinAmount" class="form-control" 
                           placeholder="Number of coins" min="1" value="100" 
                           style="padding-left: 45px; font-size: 1rem; text-align: center;">
                    <div style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--primary);">
                        <i class="fas fa-coins"></i>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 8px; gap: 5px;">
                    <button class="btn-quick-amount" data-amount="100" style="flex: 1; background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); color: var(--primary); padding: 5px 8px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease;">100</button>
                    <button class="btn-quick-amount" data-amount="500" style="flex: 1; background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); color: var(--primary); padding: 5px 8px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease;">500</button>
                    <button class="btn-quick-amount" data-amount="1000" style="flex: 1; background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); color: var(--primary); padding: 5px 8px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease;">1,000</button>
                    <button class="btn-quick-amount" data-amount="5000" style="flex: 1; background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); color: var(--primary); padding: 5px 8px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease;">5,000</button>
                </div>
            </div>

            <!-- Conversion results - now 2 columns for mobile -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                <!-- Tether -->
                <div style="background: linear-gradient(135deg, rgba(46, 134, 222, 0.1) 0%, rgba(30, 110, 196, 0.05) 100%); padding: 15px; border-radius: 12px; border: 1px solid rgba(46, 134, 222, 0.3); text-align: center; min-height: 100px; display: flex; flex-direction: column; justify-content: center;">
                    <div style="color: var(--info); font-size: 0.8rem; margin-bottom: 8px; font-weight: 600;">
                        <i class="fas fa-coins"></i>
                        Tether
                    </div>
                    <div style="color: var(--info); font-size: 0.9rem; font-weight: bold; margin-bottom: 4px;" id="tetherAmount">0</div>
                    <div style="color: var(--gray); font-size: 0.7rem;">USDT</div>
                </div>

                <!-- Bitcoin -->
                <div style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.1) 0%, rgba(240, 140, 20, 0.05) 100%); padding: 15px; border-radius: 12px; border: 1px solid rgba(247, 147, 26, 0.3); text-align: center; min-height: 100px; display: flex; flex-direction: column; justify-content: center;">
                    <div style="color: #f7931a; font-size: 0.8rem; margin-bottom: 8px; font-weight: 600;">
                        <i class="fab fa-bitcoin"></i>
                        Bitcoin
                    </div>
                    <div style="color: #f7931a; font-size: 0.85rem; font-weight: bold; margin-bottom: 4px;" id="bitcoinAmount">0</div>
                    <div style="color: var(--gray); font-size: 0.7rem;">BTC</div>
                </div>

                <!-- Ethereum - moved to second row -->
                <div style="background: linear-gradient(135deg, rgba(105, 70, 210, 0.1) 0%, rgba(90, 60, 190, 0.05) 100%); padding: 15px; border-radius: 12px; border: 1px solid rgba(105, 70, 210, 0.3); text-align: center; min-height: 100px; display: flex; flex-direction: column; justify-content: center; grid-column: 1 / -1;">
                    <div style="color: #6946d2; font-size: 0.8rem; margin-bottom: 8px; font-weight: 600;">
                        <i class="fab fa-ethereum"></i>
                        Ethereum
                    </div>
                    <div style="color: #6946d2; font-size: 0.85rem; font-weight: bold; margin-bottom: 4px;" id="ethereumAmount">0</div>
                    <div style="color: var(--gray); font-size: 0.7rem;">ETH</div>
                </div>
            </div>

            <!-- Convert button -->
            <button class="btn btn-primary" id="convertBtn" style="width: 100%; padding: 12px; font-size: 1rem; border-radius: 10px; margin-top: 10px;">
                <i class="fas fa-exchange-alt" style="margin-left: 6px;"></i>
                Convert Coins
            </button>
        </div>
    </div>
</section>

            <!-- VIP Section -->
<section id="vip-section" class="section">
    <div class="game-container">
        <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center; font-size: 1.5rem;">💎 VIP System</h3>
        
        <!-- Current user status -->
        <div id="vipStatus" style="background: linear-gradient(135deg, rgba(255,215,0,0.15) 0%, rgba(255,107,0,0.1) 100%); padding: 20px; border-radius: 20px; margin-bottom: 25px; text-align: center; border: 1px solid rgba(255,215,0,0.3);">
            <div style="color: var(--primary-light); font-size: 1rem; margin-bottom: 10px; font-weight: 600;">Current Status:</div>
            <div id="currentVipStatus" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: bold; font-size: 1.2rem;">Regular User</div>
            <div id="vipExpiry" style="color: var(--gray); font-size: 0.85rem; margin-top: 8px;"></div>
        </div>

        <!-- User limit -->
        <div id="userLimitInfo" style="background: rgba(255, 71, 87, 0.1); padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255, 71, 87, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <span style="color: var(--danger); font-size: 0.9rem; font-weight: 600;" id="limitTitle">Coin Limit:</span>
                <span id="dailyLimitText" style="color: var(--light); font-weight: bold;">100,000 coins</span>
            </div>
            <div class="progress-bar" style="height: 8px;">
                <div class="progress-fill" id="limitProgress" style="width: 0%; background: linear-gradient(90deg, var(--danger), #ff2e4e);"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.8rem;">
                <span style="color: var(--gray);" id="collectedText">0 coins collected</span>
                <span style="color: var(--gray);" id="remainingText">100,000 coins remaining</span>
            </div>
        </div>

        <!-- VIP reset timer -->
        <div id="vipResetTimer" style="display: none; background: linear-gradient(135deg, rgba(0, 245, 255, 0.1) 0%, rgba(157, 78, 221, 0.05) 100%); padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(0, 245, 255, 0.3); text-align: center; font-size: 0.9rem; backdrop-filter: blur(10px);">
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px; color: var(--miner-accent);">
                <i class="fas fa-clock fa-spin"></i>
                <span id="timerText">Next reset: 20:00:00</span>
            </div>
            <div style="color: var(--gray); font-size: 0.8rem; margin-top: 5px;">
                ⏰ Your limit resets every 20 hours
            </div>
        </div>

        <!-- VIP plans -->
        <div id="vipPlansContainer">
            <!-- Plans will be generated here -->
        </div>

        <!-- Limit warning - only for regular users -->
        <div id="limitWarning" style="display: none; background: rgba(255, 159, 67, 0.15); padding: 15px; border-radius: 15px; margin-top: 20px; border: 1px solid rgba(255, 159, 67, 0.4); text-align: center;">
            <i class="fas fa-exclamation-triangle" style="color: var(--warning); margin-left: 8px;"></i>
            <span style="color: var(--warning); font-weight: 600;">You are approaching your mining limit!</span>
            <p style="color: var(--gray); margin-top: 8px; font-size: 0.85rem; line-height: 1.5;">
                To continue unlimited mining, choose one of the VIP plans.
            </p>
        </div>
    </div>
</section>

            <!-- بخش Profile Section انگلیسی شده -->
<section id="profile-section" class="section">
    <div class="game-container">
        <!-- Profile Header -->
        <div class="profile-header" style="text-align: center; margin-bottom: 30px;">
            <h3 style="color: var(--primary); margin-bottom: 10px; font-size: 1.8rem; font-weight: 800;">
                👤 User Profile
            </h3>
            <p style="color: var(--gray); font-size: 0.95rem;">Account management and personal information</p>
        </div>

        <!-- Main Layout with Flexbox for better compatibility -->
        <div style="display: flex; flex-direction: column; gap: 25px;">
            
            <!-- First Row: User Info and Main Stats -->
            <div style="display: grid; grid-template-columns: 1fr; gap: 25px;">
                
                <!-- User Info Card -->
                <div class="profile-sidebar" style="background: var(--glass); backdrop-filter: blur(20px); border-radius: 25px; padding: 25px; border: 1px solid var(--glass-border); text-align: center; order: 1;">
                    <!-- Dynamic Avatar -->
                    <div class="user-avatar-profile" style="width: 100px; height: 100px; margin: 0 auto 20px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: white; position: relative; box-shadow: 0 10px 30px rgba(255,215,0,0.3);">
                        <i class="fas fa-user"></i>
                        <div id="profileVipBadge" class="vip-crown" style="position: absolute; bottom: 5px; right: 5px; background: linear-gradient(135deg, #ffd700, #ff6b00); width: 25px; height: 25px; border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 0.8rem; color: black;">
                            <i class="fas fa-crown"></i>
                        </div>
                    </div>
                    
                    <!-- User Information -->
                    <div id="userName" style="color: var(--light); font-weight: 700; font-size: 1.3rem; margin-bottom: 8px;">Please login</div>
                    <div id="userEmail" style="color: var(--gray); font-size: 0.9rem; margin-bottom: 15px; direction: ltr; text-align: center;">-</div>
                    
                    <!-- User Level -->
                    <div class="user-level-display" style="background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,107,0,0.1)); padding: 12px; border-radius: 15px; border: 1px solid rgba(255,215,0,0.3); margin-bottom: 20px;">
                        <div style="color: var(--gray); font-size: 0.8rem; margin-bottom: 5px;">Current Level</div>
                        <div style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 1.4rem; font-weight: 800;" id="profileLevel">-</div>
                    </div>

                    <!-- Action Buttons -->
                    <button class="btn btn-primary" id="profileLoginBtn" style="width: 100%; margin-bottom: 15px; padding: 12px; border-radius: 12px; font-weight: 600;">
                        Login / Register
                    </button>
                    
                    <!-- Quick Stats -->
                    <div class="quick-stats" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: var(--gray); font-size: 0.8rem;">Active Days:</span>
                            <span style="color: var(--primary); font-weight: 600;" id="activeDays">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray); font-size: 0.8rem;">Rank:</span>
                            <span style="color: var(--primary); font-weight: 600;" id="userRank">#-</span>
                        </div>
                    </div>
                </div>

                <!-- Financial Stats Card -->
                <div class="stats-card" style="background: var(--glass); backdrop-filter: blur(20px); border-radius: 20px; padding: 25px; border: 1px solid var(--glass-border); order: 2;">
                    <div style="display: flex; align-items: center; margin-bottom: 20px;">
                        <i class="fas fa-chart-line" style="color: var(--primary); font-size: 1.5rem; margin-left: 10px;"></i>
                        <h4 style="color: var(--light); font-size: 1.2rem; font-weight: 700;">Financial Statistics</h4>
                    </div>
                    
                    <!-- Level Progress -->
                    <div class="level-progress-section">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.85rem;">
                            <span style="color: var(--gray);">Level <span id="currentLevel" style="color: var(--primary);">-</span></span>
                            <span style="color: var(--gray);"><span id="currentXP" style="color: var(--primary);">-</span> / <span id="requiredXP" style="color: var(--primary);">-</span></span>
                        </div>
                        <div class="progress-bar" style="height: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden;">
                            <div class="progress-fill" id="levelProgressFill" style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--primary-light)); border-radius: 10px; width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <span style="color: var(--gray); font-size: 0.8rem;">Level Bonus: </span>
                            <span style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700;" id="profileBonus">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Second Row: Cryptocurrency Balances -->
            <div class="crypto-card" style="background: var(--glass); backdrop-filter: blur(20px); border-radius: 20px; padding: 25px; border: 1px solid var(--glass-border); order: 3;">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <i class="fas fa-wallet" style="color: var(--primary); font-size: 1.5rem; margin-left: 10px;"></i>
                    <h4 style="color: var(--light); font-size: 1.2rem; font-weight: 700;">Cryptocurrency Balances</h4>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <!-- Tether -->
                    <div class="crypto-item" style="background: linear-gradient(135deg, rgba(46, 134, 222, 0.15), rgba(30, 110, 196, 0.1)); padding: 20px; border-radius: 15px; border: 1px solid rgba(46, 134, 222, 0.3); text-align: center;">
                        <i class="fas fa-coins" style="color: var(--info); font-size: 1.5rem; margin-bottom: 10px;"></i>
                        <div style="color: var(--info); font-size: 0.9rem; font-weight: 600; margin-bottom: 8px;">Tether</div>
                        <div style="color: var(--light); font-size: 1rem; font-weight: 700;" id="profileTether">-</div>
                        <div style="color: var(--gray); font-size: 0.75rem;">USDT</div>
                    </div>
                    
                    <!-- Bitcoin -->
                    <div class="crypto-item" style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.15), rgba(240, 140, 20, 0.1)); padding: 20px; border-radius: 15px; border: 1px solid rgba(247, 147, 26, 0.3); text-align: center;">
                        <i class="fab fa-bitcoin" style="color: #f7931a; font-size: 1.5rem; margin-bottom: 10px;"></i>
                        <div style="color: #f7931a; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px;">Bitcoin</div>
                        <div style="color: var(--light); font-size: 1rem; font-weight: 700;" id="profileBitcoin">-</div>
                        <div style="color: var(--gray); font-size: 0.75rem;">BTC</div>
                    </div>
                    
                    <!-- Ethereum -->
                    <div class="crypto-item" style="background: linear-gradient(135deg, rgba(105, 70, 210, 0.15), rgba(90, 60, 190, 0.1)); padding: 20px; border-radius: 15px; border: 1px solid rgba(105, 70, 210, 0.3); text-align: center;">
                        <i class="fab fa-ethereum" style="color: #6946d2; font-size: 1.5rem; margin-bottom: 10px;"></i>
                        <div style="color: #6946d2; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px;">Ethereum</div>
                        <div style="color: var(--light); font-size: 1rem; font-weight: 700;" id="profileEthereum">-</div>
                        <div style="color: var(--gray); font-size: 0.75rem;">ETH</div>
                    </div>
                </div>
            </div>

            <!-- Third Row: Advanced Statistics -->
            <div class="advanced-stats" style="background: var(--glass); backdrop-filter: blur(20px); border-radius: 20px; padding: 25px; border: 1px solid var(--glass-border); order: 4;">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <i class="fas fa-chart-bar" style="color: var(--primary); font-size: 1.5rem; margin-left: 10px;"></i>
                    <h4 style="color: var(--light); font-size: 1.2rem; font-weight: 700;">Advanced Statistics</h4>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px;">
                    <div class="adv-stat" style="text-align: center; padding: 15px;">
                        <i class="fas fa-gem" style="color: var(--primary); font-size: 1.3rem; margin-bottom: 8px;"></i>
                        <div style="color: var(--light); font-size: 1.1rem; font-weight: 700;" id="totalMined">0</div>
                        <div style="color: var(--gray); font-size: 0.8rem;">Total Mined</div>
                    </div>
                    
                    <div class="adv-stat" style="text-align: center; padding: 15px;">
                        <i class="fas fa-users" style="color: var(--info); font-size: 1.3rem; margin-bottom: 8px;"></i>
                        <div style="color: var(--light); font-size: 1.1rem; font-weight: 700;" id="referralCount">0</div>
                        <div style="color: var(--gray); font-size: 0.8rem;">Referrals</div>
                    </div>
                    
                    <div class="adv-stat" style="text-align: center; padding: 15px;">
                        <i class="fas fa-trophy" style="color: var(--warning); font-size: 1.3rem; margin-bottom: 8px;"></i>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <!-- بخش Affiliate Section انگلیسی شده -->
<section id="affiliate-section" class="section">
    <div class="game-container">
        <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center; font-size: 1.5rem;">👥 Referral System</h3>
        
        <div class="referral-code">
            <div style="color: var(--primary-light); font-size: 1rem; margin-bottom: 10px; font-weight: 600;">Your Personal Referral Code:</div>
            <div class="code-display" id="personalReferralCode">---</div>
            <button class="btn btn-primary" id="copyCodeBtn">
                <i class="fas fa-copy"></i> Copy Referral Code
            </button>
        </div>

        <!-- Referral Statistics -->
        <div class="game-stats-compact">
            <div class="stat-compact">
                <div class="stat-value" id="referralCount">0</div>
                <div class="stat-label">Total Referrals</div>
            </div>
            <div class="stat-compact">
                <div class="stat-value" id="referralEarnings">0</div>
                <div class="stat-label">Total Earnings</div>
            </div>
        </div>

        <div class="game-stats-compact" style="margin-top: 15px;">
            <div class="stat-compact">
                <div class="stat-value" id="level1Referrals">0</div>
                <div class="stat-label">Level 1 Referrals</div>
            </div>
            <div class="stat-compact">
                <div class="stat-value" id="level2Referrals">0</div>
                <div class="stat-label">Level 2 Referrals</div>
            </div>
        </div>

        <!-- Referral Benefits Section -->
        <div style="background: linear-gradient(135deg, rgba(255,215,0,0.1) 0%, rgba(255,107,0,0.05) 100%); padding: 20px; border-radius: 20px; margin-top: 25px; border: 1px solid rgba(255,215,0,0.3);">
            <h4 style="color: var(--primary); text-align: center; margin-bottom: 15px; font-size: 1.2rem;">
                <i class="fas fa-gift"></i> Referral Benefits
            </h4>
            
            <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                    <i class="fas fa-coins" style="color: var(--primary);"></i>
                    <div>
                        <div style="color: var(--light); font-weight: 600; font-size: 0.9rem;">Signup Bonus</div>
                        <div style="color: var(--gray); font-size: 0.8rem;">Earn 5000 coins when someone signs up with your code</div>
                    </div>
                </div>
                    <div>
                </div>
            </div>
        </div>

        <!-- How it Works -->
        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-top: 20px; border: 1px solid var(--glass-border);">
            <h4 style="color: var(--primary-light); text-align: center; margin-bottom: 15px; font-size: 1.1rem;">
                <i class="fas fa-info-circle"></i> How It Works
            </h4>
            <div style="color: var(--gray); font-size: 0.9rem; line-height: 1.6;">
                <p>1. Share your referral code with friends</p>
                <p>2. They sign up using your code</p>
                <p>3. You earn 5000 coins instantly</p>
            </div>
        </div>
    </div>
</section>

            <!-- Admin Panel Sections -->
            <!-- Admin Dashboard Section -->
            <section id="admin-dashboard-section" class="section admin-section">
                <div class="game-container">
                    <h3 style="color: var(--admin-text); margin-bottom: 15px; text-align: center; font-size: 1.3rem;">
                        <i class="fas fa-crown"></i> پنل مدیریت گلد کوین
                    </h3>
                    
                    <!-- آمار کلی -->
                    <div class="admin-stats-grid">
                        <div class="admin-stat-card">
                            <div class="admin-stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="admin-stat-value" id="adminTotalUsers">0</div>
                            <div class="admin-stat-label">کاربران کل</div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="admin-stat-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="admin-stat-value" id="adminTotalCoins">0</div>
                            <div class="admin-stat-label">سکه‌های کل</div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="admin-stat-icon">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="admin-stat-value" id="adminActiveUsers">0</div>
                            <div class="admin-stat-label">کاربران فعال</div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="admin-stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="admin-stat-value" id="adminTotalCash">0</div>
                            <div class="admin-stat-label">تومان کل</div>
                        </div>
                    </div>

                    <!-- آمار پیشرفته -->
                    <div class="admin-form-section">
                        <div class="admin-section-title">
                            <i class="fas fa-chart-line"></i>
                            آمار پیشرفته سیستم
                        </div>
                        
                        <div class="admin-stats-grid">
                            <div class="admin-stat-card">
                                <div class="admin-stat-icon">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="admin-stat-value" id="adminTodayUsers">0</div>
                                <div class="admin-stat-label">کاربران امروز</div>
                            </div>
                            <div class="admin-stat-card">
                                <div class="admin-stat-icon">
                                    <i class="fas fa-gem"></i>
                                </div>
                                <!-- **تغییر شماره 1: رفع مشکل نمایش تعداد کاربران VIP -->
                                <div class="admin-stat-value" id="adminVipUsers">0</div>
                                <div class="admin-stat-label">کاربران VIP</div>
                            </div>
                            <div class="admin-stat-card">
                                <div class="admin-stat-icon">
                                    <i class="fas fa-share-alt"></i>
                                </div>
                                <div class="admin-stat-value" id="adminReferralCount">0</div>
                                <div class="admin-stat-label">زیرمجموعه‌ها</div>
                            </div>
                            <div class="admin-stat-card">
                                <div class="admin-stat-icon">
                                    <i class="fas fa-exchange-alt"></i>
                                </div>
                                <div class="admin-stat-value" id="adminConversions">0</div>
                                <div class="admin-stat-label">تبدیل‌ها</div>
                            </div>
                        </div>
                    </div>
                    <!-- این رو در پنل مدیریت قرار بده -->
<div class="admin-form-section">
    <div class="admin-section-title">
        <i class="fas fa-bell"></i>
        مدیریت پیام‌ها
    </div>
    
    <div class="admin-control-group">
        <label class="admin-label">
            <i class="fas fa-comment"></i>
            متن پیام جدید
        </label>
        <textarea class="admin-input" id="adminNotificationMessage" 
                  placeholder="متن پیامی که می‌خواهید برای کاربران ارسال کنید..."
                  style="height: 100px; resize: vertical;"></textarea>
    </div>

    <div class="admin-btn-group">
        <button class="admin-btn admin-btn-primary" onclick="sendAdminNotification()">
            <i class="fas fa-paper-plane"></i>
            ارسال پیام
        </button>
        <button class="admin-btn admin-btn-danger" onclick="clearAllNotifications()">
            <i class="fas fa-trash"></i>
            پاک کردن همه
        </button>
    </div>
</div>

                    <!-- عملیات سریع -->
                    <div class="admin-form-section">
                        <div class="admin-section-title">
                            <i class="fas fa-rocket"></i>
                            عملیات سریع
                        </div>
                        
                        <div class="admin-btn-group">
                            <button class="admin-btn admin-btn-success" id="adminAddDailyBonus">
                                <i class="fas fa-gift"></i> پاداش روزانه
                            </button>
                            <button class="admin-btn admin-btn-primary" id="adminAddCoinsToAll">
                                <i class="fas fa-coins"></i> سکه به همه
                            </button>
                        </div>
                    </div>

                    <!-- آمار ماینر -->
                    <div class="admin-form-section miner-admin-panel">
                        <div class="admin-section-title miner-admin-section-title">
                            <i class="fas fa-microchip"></i>
                            آمار سیستم ماینر
                        </div>
                        
                        <div class="miner-admin-stats">
                            <div class="admin-stat-card miner-admin-stat">
                                <div class="admin-stat-icon">
                                    <i class="fas fa-hard-hat"></i>
                                </div>
                                <div class="admin-stat-value" id="adminActiveMiners">0</div>
                                <div class="admin-stat-label">ماینرهای فعال</div>
                            </div>
                            <div class="admin-stat-card miner-admin-stat">
                                <div class="admin-stat-icon">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <div class="admin-stat-value" id="adminMinerEarnings">0</div>
                                <div class="admin-stat-label">درآمد ماینرها</div>
                            </div>
                            <div class="admin-stat-card miner-admin-stat">
                                <div class="admin-stat-icon">
                                    <i class="fas fa-play-circle"></i>
                                </div>
                                <div class="admin-stat-value" id="adminTotalMiningSessions">0</div>
                                <div class="admin-stat-label">Mining sessions</div>
                            </div>
                            <div class="admin-stat-card miner-admin-stat">
                                <div class="admin-stat-icon">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="admin-stat-value" id="adminAvgMinerEfficiency">0%</div>
                                <div class="admin-stat-label">Average efficiency</div>
                            </div>
                        </div>
                    </div>

                    <!-- کنترل ماینر -->
                    <div class="admin-form-section miner-admin-controls">
                        <div class="admin-section-title miner-admin-section-title">
                            <i class="fas fa-cogs"></i>
                            کنترل سیستم ماینر
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-coins"></i>
                                سکه پایه ماینر (در ۱ ساعت)
                            </label>
                            <input type="number" class="admin-input" id="adminMinerBaseReward" placeholder="مقدار فعلی: 1000">
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-clock"></i>
                                مدت زمان استخراج (ساعت)
                            </label>
                            <input type="number" class="admin-input" id="adminMinerDuration" placeholder="مقدار فعلی: 1" step="0.5">
                        </div>

                        <div class="admin-btn-group">
                            <button class="admin-btn admin-btn-success" id="adminUpdateMinerSettings">
                                <i class="fas fa-save"></i> بروزرسانی تنظیمات
                            </button>
                            <button class="admin-btn admin-btn-primary" id="adminResetAllMiners">
                                <i class="fas fa-redo"></i> ریست همه ماینرها
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Admin Users Section -->
            <section id="admin-users-section" class="section admin-section">
                <div class="game-container">
                    <h3 style="color: var(--admin-text); margin-bottom: 15px; text-align: center; font-size: 1.3rem;">
                        <i class="fas fa-users"></i> مدیریت کاربران
                    </h3>

                    <!-- جستجو و ویرایش کاربر -->
                    <div class="admin-form-section">
                        <div class="admin-section-title">
                            <i class="fas fa-search"></i>
                            جستجو و ویرایش کاربر
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-envelope"></i>
                                ایمیل کاربر برای جستجو
                            </label>
                            <input type="email" class="admin-input" id="adminUserEmail" placeholder="ایمیل کاربر را وارد کنید">
                        </div>
                        
                        <div class="admin-btn-group">
                            <button class="admin-btn admin-btn-primary" id="adminFindUser">
                                <i class="fas fa-search"></i> جستجو کاربر
                            </button>
                            <button class="admin-btn admin-btn-danger" id="adminResetUser">
                                <i class="fas fa-redo"></i> ریست کاربر
                            </button>
                        </div>
                    </div>

                    <!-- ویرایش اطلاعات کاربر -->
                    <div class="admin-form-section">
                        <div class="admin-section-title">
                            <i class="fas fa-edit"></i>
                            ویرایش اطلاعات کاربر انتخاب شده
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-coins"></i>
                                تعداد سکه کاربر
                            </label>
                            <input type="number" class="admin-input" id="adminUserCoins" placeholder="تعداد سکه">
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-money-bill-wave"></i>
                                موجودی نقدی کاربر (تومان)
                            </label>
                            <input type="number" class="admin-input" id="adminUserCash" placeholder="تومان">
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-level-up-alt"></i>
                                سطح کاربر
                            </label>
                            <input type="number" class="admin-input" id="adminUserLevel" placeholder="سطح"
                                                    </div>

                        <button class="admin-btn admin-btn-success" id="adminUpdateUser" style="width: 100%; margin-top: 10px;">
                            <i class="fas fa-save"></i> بروزرسانی اطلاعات کاربر
                        </button>
                    </div>

                    <!-- لیست کاربران -->
                    <div class="admin-users-table-container">
                        <div class="admin-section-title">
                            <i class="fas fa-list"></i>
                            لیست کاربران سیستم
                        </div>
                        
                        <div style="max-height: 300px; overflow-y: auto;">
                            <table class="admin-users-table" id="adminUsersTable">
                                <thead>
                                    <tr>
                                        <th>نام کاربر</th>
                                        <th>ایمیل</th>
                                        <th>سکه</th>
                                        <th>تومان</th>
                                        <th>سطح</th>
                                        <th>وضعیت VIP</th>
                                        <th>زیرمجموعه ۱</th>
                                        <th>زیرمجموعه ۲</th>
                                        <th>وضعیت</th>
                                        <th>عملیات</th>
                                    </tr>
                                </thead>
                                <tbody id="adminUsersTableBody">
                                    <!-- ردیف‌های کاربران اینجا ساخته می‌شوند -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Admin Settings Section -->
            <section id="admin-settings-section" class="section admin-section">
                <div class="game-container">
                    <h3 style="color: var(--admin-text); margin-bottom: 15px; text-align: center; font-size: 1.3rem;">
                        <i class="fas fa-cogs"></i> تنظیمات سیستم
                    </h3>
                    
                    
<div class="admin-form-section">
    <div class="admin-section-title">
        <i class="fas fa-clock"></i>
        تنظیمات تایمر ریست VIP
    </div>
    
    <div class="admin-control-group">
        <label class="admin-label">
            <i class="fas fa-crown"></i>
            مدت زمان ریست VIP نقره‌ای (ساعت)
        </label>
        <input type="number" class="admin-input" id="adminVip1ResetHours" placeholder="مقدار فعلی: 20" min="1" max="24">
    </div>
    
    <div class="admin-control-group">
        <label class="admin-label">
            <i class="fas fa-gem"></i>
            مدت زمان ریست VIP طلایی (ساعت)
        </label>
        <input type="number" class="admin-input" id="adminVip2ResetHours" placeholder="مقدار فعلی: 20" min="1" max="24">
    </div>

    <button class="admin-btn admin-btn-primary" id="adminSaveVipTimerSettings">
        <i class="fas fa-save"></i> ذخیره تنظیمات تایمر
    </button>
</div>

<!-- مدیریت توکنومیکس -->
<div class="admin-form-section">
    <div class="admin-section-title">
        <i class="fas fa-coins"></i>
        مدیریت توکنومیکس
    </div>
    
    <div class="admin-control-group">
        <label class="admin-label">
            <i class="fas fa-hashtag"></i>
            عرضه کل سکه‌ها
        </label>
        <input type="number" class="admin-input" id="adminTotalSupply" placeholder="عرضه کل (پیش‌فرض: 30000000000)">
        <div style="color: var(--gray); font-size: 0.7rem; margin-top: 5px;">
            تعداد کل سکه‌های موجود در سیستم
        </div>
    </div>

    <div class="admin-control-group">
        <label class="admin-label">
            <i class="fas fa-gem"></i>
            سکه‌های استخراج شده
        </label>
        <input type="number" class="admin-input" id="adminMinedCoins" placeholder="سکه‌های استخراج شده">
        <div style="color: var(--gray); font-size: 0.7rem; margin-top: 5px;">
            تعداد سکه‌هایی که تاکنون استخراج شده
        </div>
    </div>

    <div class="admin-control-group">
        <label class="admin-label">
            <i class="fas fa-edit"></i>
            متن عنوان توکنومیکس
        </label>
        <input type="text" class="admin-input" id="adminTokenomicsTitle" placeholder="متن عنوان (پیش‌فرض: فاز اول گلد کوین)">
        <div style="color: var(--gray); font-size: 0.7rem; margin-top: 5px;">
            متن نمایش داده شده در بخش توکنومیکس
        </div>
    </div>

    <div class="admin-control-group">
        <label class="admin-label">
            <i class="fas fa-align-left"></i>
            متن توضیحات توکنومیکس
        </label>
        <textarea class="admin-input" id="adminTokenomicsDescription" placeholder="توضیحات توکنومیکس" style="height: 80px; resize: vertical;"></textarea>
        <div style="color: var(--gray); font-size: 0.7rem; margin-top: 5px;">
            توضیحات نمایش داده شده در بخش توکنومیکس
        </div>
    </div>

    <div class="admin-btn-group">
        <button class="admin-btn admin-btn-primary" id="adminLoadTokenomics">
            <i class="fas fa-download"></i> بارگذاری داده‌های فعلی
        </button>
        <button class="admin-btn admin-btn-success" id="adminSaveTokenomics">
            <i class="fas fa-save"></i> ذخیره تغییرات
        </button>
    </div>

    <div class="admin-btn-group" style="margin-top: 15px;">
        <button class="admin-btn admin-btn-warning" id="adminResetTokenomics">
            <i class="fas fa-redo"></i> ریست کامل توکنومیکس
        </button>
        <button class="admin-btn admin-btn-danger" id="adminClearTokenomicsHistory">
            <i class="fas fa-trash"></i> پاک کردن تاریخچه
        </button>
    </div>
</div>
                    <!-- تنظیمات تبدیل سکه -->
                    <div class="admin-form-section">
                        <div class="admin-section-title">
                            <i class="fas fa-exchange-alt"></i>
                            تنظیمات تبدیل سکه
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-coins"></i>
                                نرخ تبدیل سکه (تومان به ازای هر 1 سکه)
                            </label>
                            <input type="number" class="admin-input" id="adminCoinRate" placeholder="مقدار فعلی: 5">
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-dollar-sign"></i>
                                نرخ دلار (تومان)
                            </label>
                            <input type="number" class="admin-input" id="adminDollarRate" placeholder="مقدار فعلی: 50000">
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-ban"></i>
                                محدودیت کاربران معمولی (تعداد سکه)
                            </label>
                            <input type="number" class="admin-input" id="adminRegularLimit" placeholder="مقدار فعلی: 100000">
                        </div>
                    </div>
                    
<div class="admin-form-section">
    <div class="admin-section-title">
        <i class="fas fa-coins"></i>
        تنظیمات نرخ تبدیل سکه
    </div>
    
    <div class="admin-control-group">
        <label class="admin-label">
            <i class="fas fa-exchange-alt"></i>
            نرخ تبدیل سکه به تتر
        </label>
        <input type="number" class="admin-input" id="adminCoinToCryptoRate" 
               placeholder="مقدار فعلی: 0.0001" step="0.0001" min="0.000001" max="1">
        <div style="color: var(--gray); font-size: 0.7rem; margin-top: 5px;">
            هر ۱ سکه = ? USDT (مثال: 0.0001 یعنی هر ۱۰,۰۰۰ سکه = ۱ USDT)
        </div>
    </div>

    <div style="background: rgba(255, 215, 0, 0.1); padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid rgba(255, 215, 0, 0.3);">
        <div style="color: var(--primary); font-size: 0.8rem; font-weight: 600; margin-bottom: 5px;">
            📊 محاسبه نمونه:
        </div>
        <div style="color: var(--light); font-size: 0.75rem;">
            <span id="rateCalculation">هر ۱۰,۰۰۰ سکه = ۱ USDT</span>
        </div>
    </div>

    <button class="admin-btn admin-btn-primary" id="adminUpdateCoinRate" style="width: 100%; margin-top: 10px;">
        <i class="fas fa-save"></i> بروزرسانی نرخ تبدیل
    </button>
</div>

                    <!-- تنظیمات پلن‌های VIP -->
                    <div class="admin-form-section">
                        <div class="admin-section-title">
                            <i class="fas fa-crown"></i>
                            تنظیمات پلن‌های VIP
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-money-bill-wave"></i>
                                قیمت VIP نقره‌ای (Tether)
                            </label>
                            <input type="number" class="admin-input" id="adminVip1Price" placeholder="VIP نقره‌ای">
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-money-bill-wave"></i>
                                قیمت VIP طلایی (Tether)
                            </label>
                            <input type="number" class="admin-input" id="adminVip2Price" placeholder="VIP طلایی">
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-money-bill-wave"></i>
                                قیمت VIP الماس (Tether)
                            </label>
                            <input type="number" class="admin-input" id="adminVip3Price" placeholder="VIP الماس">
                        </div>
                    </div>

                    <!-- تنظیمات سیستم زیرمجموعه‌گیری -->
                    <div class="admin-form-section">
                        <div class="admin-section-title">
                            <i class="fas fa-user-friends"></i>
                            تنظیمات سیستم زیرمجموعه‌گیری
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-percentage"></i>
                                درصد پاداش زیرمجموعه سطح ۱
                            </label>
                            <input type="number" class="admin-input" id="adminReferralLevel1Percent" placeholder="مقدار فعلی: 10%">
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-percentage"></i>
                                درصد پاداش زیرمجموعه سطح ۲
                            </label>
                            <input type="number" class="admin-input" id="adminReferralLevel2Percent" placeholder="مقدار فعلی: 5%">
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-coins"></i>
                                سکه پاداش ثبت‌نام با کد معرف
                            </label>
                            <input type="number" class="admin-input" id="adminReferralSignupBonus" placeholder="مقدار فعلی: 50">
                        </div>
                    </div>

                    <button class="admin-btn admin-btn-primary" id="adminSaveSettings" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-save"></i> ذخیره تمام تنظیمات سیستم
                    </button>
                </div>
            </section>

            <!-- Admin Operations Section -->
            <section id="admin-operations-section" class="section admin-section">
                <div class="game-container">
                    <h3 style="color: var(--admin-text); margin-bottom: 15px; text-align: center; font-size: 1.3rem;">
                        <i class="fas fa-tools"></i> عملیات سیستمی
                    </h3>

                    <!-- عملیات هدیه و پاداش -->
                    <div class="admin-form-section">
                        <div class="admin-section-title">
                            <i class="fas fa-gift"></i>
                            عملیات هدیه و پاداش
                        </div>
                        
                        <div class="admin-control-group">
                            <label class="admin-label">
                                <i class="fas fa-coins"></i>
                                تعداد سکه برای اضافه کردن به همه کاربران
                            </label>
                            <input type="number" class="admin-input" id="adminBonusCoins" placeholder="تعداد سکه" value="1000">
                        </div>
                        
                        <div class="admin-btn-group">
                            <button class="admin-btn admin-btn-success" id="adminAddCoinsToAllOps">
                                <i class="fas fa-coins"></i> اضافه کردن سکه به همه
                            </button>
                            <button class="admin-btn admin-btn-primary" id="adminAddDailyBonusOps">
                                <i class="fas fa-calendar-day"></i> پاداش روزانه
                            </button>
                        </div>
                    </div>

                    <!-- مدیریت داده‌ها -->
                    <div class="admin-form-section">
                        <div class="admin-section-title">
                            <i class="fas fa-database"></i>
                            مدیریت داده‌ها
                        </div>
                        
                        <div class="admin-btn-group">
                            <button class="admin-btn admin-btn-danger" id="adminResetAll">
                                <i class="fas fa-bomb"></i> ریست تمام کاربران
                            </button>
                            <button class="admin-btn admin-btn-primary" id="adminExportData">
                                <i class="fas fa-download"></i> خروجی داده‌ها
                            </button>
                        </div>
                        
                        <div class="admin-control-group" style="margin-top: 15px;">
                            <label class="admin-label">
                                <i class="fas fa-upload"></i>
                                وارد کردن داده‌ها از فایل
                            </label>
                            <input type="file" class="admin-input" id="adminImportFile" accept=".json">
                            <button class="admin-btn admin-btn-success" id="adminImportData" style="width: 100%; margin-top: 8px;">
                                <i class="fas fa-upload"></i> وارد کردن داده‌ها
                            </button>
                        </div>
                    </div>

                    <!-- دکمه خروج از پنل مدیریت -->
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="admin-btn admin-btn-danger" id="adminLogout" style="width: 150px;">
                            <i class="fas fa-sign-out-alt"></i> خروج از پنل مدیریت
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>

<!-- بخش توکنومیکس انگلیسی شده -->
<section id="tokenomics-section" class="section" style="position: absolute; top: 80px; width: 100%; margin: 0; padding: 0;">
    <div class="game-container" style="margin: 0; padding: 20px;">
        <div style="background: var(--glass); backdrop-filter: blur(20px); border-radius: 20px; padding: 25px; border: 1px solid var(--glass-border);">
            
            <div class="tokenomics-header" style="text-align: center; margin-bottom: 25px;">
                <h3 style="color: var(--primary); margin-bottom: 10px; font-size: 1.8rem;">
                    <i class="fas fa-chart-pie"></i> Gold Coin - Phase 1
                </h3>
                <p style="color: var(--gray); font-size: 0.95rem;">
                    Phase 1 supply of Gold Coin: 30 billion coins
                </p>
            </div>

            <!-- Overall Statistics -->
            <div class="game-stats-compact" style="margin-bottom: 25px;">
                <div class="stat-compact">
                    <div class="stat-value" id="totalSupply">30,000,000,000</div>
                    <div class="stat-label">Total Supply</div>
                </div>
                <div class="stat-compact">
                    <div class="stat-value" id="minedCoins">0</div>
                    <div class="stat-label">Mined Coins</div>
                </div>
                <div class="stat-compact">
                    <div class="stat-value" id="remainingCoins">30,000,000,000</div>
                    <div class="stat-label">Remaining Supply</div>
                </div>
                <div class="stat-compact">
                    <div class="stat-value" id="minedPercentage">0%</div>
                    <div class="stat-label">Mined Percentage</div>
                </div>
            </div>

            <!-- Progress Chart -->
            <div class="progress-section" style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px solid var(--glass-border); margin-bottom: 25px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <span style="color: var(--light); font-weight: 600;">Network Mining Progress</span>
                    <span style="color: var(--primary); font-weight: 600;" id="progressPercentage">0%</span>
                </div>
                <div class="progress-bar" style="height: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden;">
                    <div class="progress-fill" id="networkProgress" style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--primary-dark)); border-radius: 10px; width: 0%; transition: width 0.5s ease;"></div>
                </div>
            </div>

            <!-- Network Mining History -->
            <div class="mining-history" style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px solid var(--glass-border);">
                <h4 style="color: var(--light); margin-bottom: 15px; text-align: center;">
                    <i class="fas fa-history"></i> Network Mining History
                </h4>
                <div class="history-list" id="networkHistory" style="max-height: 200px; overflow-y: auto;">
                    <div style="text-align: center; color: var(--gray); padding: 20px;">
                        No mining activity recorded yet
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>
    <!-- Mobile Navigation -->
<nav class="mobile-nav">
    <div class="nav-icons">
        <a href="#miner" class="nav-icon active" data-section="miner-section">
            <i class="fas fa-hard-hat"></i>
            <span>Miner</span>
        </a>
        <a href="#levels" class="nav-icon" data-section="levels-section">
            <i class="fas fa-chart-line"></i>
            <span>Levels</span>
        </a>
        <a href="#convert" class="nav-icon" data-section="conversion-section">
            <i class="fas fa-exchange-alt"></i>
            <span>Convert</span>
        </a>
        <a href="#vip" class="nav-icon" data-section="vip-section">
            <i class="fas fa-crown"></i>
            <span>VIP</span>
        </a>
        <a href="#tokenomics" class="nav-icon" data-section="tokenomics-section">
            <i class="fas fa-chart-pie"></i>
            <span>Token</span>
        </a>
        <a href="#affiliate" class="nav-icon" data-section="affiliate-section">
            <i class="fas fa-users"></i>
            <span>Referral</span>
        </a>
        <a href="#profile" class="nav-icon" data-section="profile-section">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
        <!-- Admin Navigation Items (Only visible when admin is logged in) -->
        <a href="#admin-dashboard" class="nav-icon admin-nav-item" data-section="admin-dashboard-section" style="display: none;">
            <i class="fas fa-crown"></i>
            <span>Admin</span>
        </a>
        <a href="#admin-users" class="nav-icon admin-nav-item" data-section="admin-users-section" style="display: none;">
            <i class="fas fa-users"></i>
            <span>Users</span>
        </a>
        <a href="#admin-settings" class="nav-icon admin-nav-item" data-section="admin-settings-section" style="display: none;">
            <i class="fas fa-cogs"></i>
            <span>Settings</span>
        </a>
        <a href="#admin-operations" class="nav-icon admin-nav-item" data-section="admin-operations-section" style="display: none;">
            <i class="fas fa-tools"></i>
            <span>Operations</span>
        </a>
    </div>
</nav>
<!-- سیستم پرداخت مدرن USDT -->
<div class="modal" id="usdtPaymentModal">
    <div class="modal-content modern-usdt-modal">
        <div class="modal-header">
            <div class="modal-title">
                <div class="usdt-icon">
                    <i class="fab fa-usdt"></i>
                </div>
                <div>
                    <h3>Purchase VIP with USDT</h3>
                    <p>Secure and fast payment</p>
                </div>
            </div>
            <button class="close-modal" onclick="closeUsdtModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <div class="payment-steps">
                <div class="step active" data-step="1">
                    <span class="step-number">1</span>
                    <span class="step-text">Select Plan</span>
                </div>
                <div class="step" data-step="2">
                    <span class="step-number">2</span>
                    <span class="step-text">Payment</span>
                </div>
                <div class="step" data-step="3">
                    <span class="step-number">3</span>
                    <span class="step-text">Confirmation</span>
                </div>
            </div>

            <div id="usdtModalContent" class="compact-payment-content">
                <!-- محتوای داینامیک -->
            </div>
        </div>
    </div>
</div>

<style>
/* سیستم پرداخت مدرن USDT - کاملاً فشرده و مرتب */
.modern-usdt-modal {
    max-width: 420px;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-radius: 20px;
    border: 1px solid rgba(0, 245, 255, 0.3);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    overflow: hidden;
}

.modern-usdt-modal .modal-header {
    background: linear-gradient(135deg, rgba(0, 245, 255, 0.1) 0%, rgba(157, 78, 221, 0.1) 100%);
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.modern-usdt-modal .modal-title {
    display: flex;
    align-items: center;
    gap: 12px;
}

.modern-usdt-modal .usdt-icon {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, #00ff88, #0099ff);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    color: white;
}

.modern-usdt-modal .modal-title h3 {
    margin: 0;
    color: white;
    font-size: 1.2rem;
}

.modern-usdt-modal .modal-title p {
    margin: 4px 0 0 0;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
}

.payment-steps {
    display: flex;
    justify-content: space-between;
    padding: 15px 20px;
    background: rgba(255, 255, 255, 0.05);
    margin-bottom: 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    flex: 1;
    opacity: 0.5;
    transition: all 0.3s ease;
}

.step.active {
    opacity: 1;
}

.step-number {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: bold;
    color: var(--gray);
}

.step.active .step-number {
    background: linear-gradient(135deg, #00ff88, #0099ff);
    border-color: #00ff88;
    color: white;
}

.step-text {
    font-size: 0.65rem;
    color: var(--gray);
    font-weight: 500;
}

.step.active .step-text {
    color: #00ff88;
}

/* محتوای فشرده */
.compact-payment-content {
    max-height: 50vh;
    overflow-y: auto;
    padding: 0;
}

/* خلاصه پلن فشرده */
.compact-plan-summary {
    padding: 15px 20px;
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.05), rgba(0, 153, 255, 0.05));
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
}

.compact-plan-name {
    color: white;
    font-size: 0.95rem;
    margin-bottom: 5px;
    font-weight: 600;
}

.compact-plan-price {
    font-size: 1.4rem;
    font-weight: bold;
    background: linear-gradient(135deg, #00ff88, #0099ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* بخش والت فشرده */
.compact-wallet-section {
    padding: 15px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.compact-wallet-title {
    color: white;
    font-size: 0.85rem;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
}

.compact-address-box {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(0, 245, 255, 0.3);
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 10px;
    position: relative;
}

.compact-address-text {
    font-family: 'Courier New', monospace;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.9);
    word-break: break-all;
    line-height: 1.4;
    text-align: center;
}

.copy-badge {
    position: absolute;
    top: -8px;
    left: 50%;
    transform: translateX(-50%);
    background: #00ff88;
    color: black;
    padding: 3px 10px;
    border-radius: 8px;
    font-size: 0.65rem;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.copy-badge.show {
    opacity: 1;
}

/* هشدار فشرده */
.compact-warning-box {
    background: linear-gradient(135deg, rgba(255, 159, 67, 0.1), rgba(255, 107, 0, 0.05));
    border: 1px solid rgba(255, 159, 67, 0.3);
    border-radius: 8px;
    padding: 12px;
    margin: 12px 0;
}

.compact-warning-title {
    color: #ff9f43;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.compact-warning-text {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.7rem;
    line-height: 1.4;
    margin-bottom: 8px;
}

.compact-warning-list {
    margin: 8px 0;
    padding-right: 12px;
}

.compact-warning-item {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.65rem;
    margin-bottom: 4px;
    display: flex;
    align-items: flex-start;
    gap: 5px;
    line-height: 1.3;
}

.compact-warning-item i {
    color: #ff9f43;
    font-size: 0.55rem;
    margin-top: 2px;
    flex-shrink: 0;
}

/* فرم فشرده */
.compact-form {
    padding: 15px 20px;
}

.compact-form-group {
    margin-bottom: 15px;
}

.compact-form-label {
    display: block;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 6px;
    font-size: 0.8rem;
    font-weight: 500;
}

.compact-form-input {
    width: 100%;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    color: white;
    font-size: 0.8rem;
    transition: all 0.3s ease;
}

.compact-form-input:focus {
    border-color: #00ff88;
    background: rgba(0, 255, 136, 0.05);
    outline: none;
    box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.1);
}

/* دکمه‌های فشرده */
.compact-btn-group {
    padding: 15px 20px;
    background: rgba(255, 255, 255, 0.02);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.compact-copy-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #00ff88, #0099ff);
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.compact-copy-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
}

.compact-submit-btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #00a86b, #00ff88);
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.compact-submit-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
}

.compact-back-btn {
    width: 100%;
    padding: 12px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.compact-back-btn:hover {
    background: rgba(255, 255, 255, 0.15);
}

/* مرحله تایید فشرده */
.compact-confirmation {
    padding: 30px 20px;
    text-align: center;
}

.compact-confirmation-icon {
    font-size: 3rem;
    color: #00ff88;
    margin-bottom: 15px;
}

.compact-confirmation-title {
    color: white;
    font-size: 1.1rem;
    margin-bottom: 10px;
    font-weight: 600;
}

.compact-confirmation-text {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.8rem;
    line-height: 1.5;
    margin-bottom: 20px;
}

/* مرحله اول - انتخاب پلن فشرده */
.compact-plan-selection {
    padding: 20px;
}

.compact-plan-card {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.05), rgba(0, 153, 255, 0.05));
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    border: 1px solid rgba(0, 255, 136, 0.2);
    margin-bottom: 15px;
}

.compact-plan-name-large {
    color: white;
    font-size: 1.1rem;
    margin-bottom: 8px;
    font-weight: 600;
}

.compact-plan-price-large {
    font-size: 1.8rem;
    font-weight: bold;
    background: linear-gradient(135deg, #00ff88, #0099ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 10px 0;
}

.compact-plan-desc {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.8rem;
    line-height: 1.4;
}

/* نوتیفیکیشن فشرده */
.compact-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 15px;
    color: white;
    z-index: 10001;
    display: flex;
    align-items: center;
    gap: 12px;
    transform: translateX(400px);
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    max-width: 320px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
}

.compact-notification.show {
    transform: translateX(0);
}

.compact-notification i {
    font-size: 1.3rem;
    flex-shrink: 0;
}

.compact-notification.success i { color: #00ff88; }
.compact-notification.error i { color: #ff4757; }
.compact-notification.warning i { color: #ffa502; }
.compact-notification.info i { color: #0099ff; }

.compact-notification-content h4 {
    margin: 0 0 4px 0;
    font-size: 0.9rem;
    font-weight: 600;
}

.compact-notification-content p {
    margin: 0;
    font-size: 0.8rem;
    opacity: 0.8;
    line-height: 1.3;
}

/* اسکرول بار زیبا */
.compact-payment-content::-webkit-scrollbar {
    width: 4px;
}

.compact-payment-content::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
}

.compact-payment-content::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #00ff88, #0099ff);
    border-radius: 2px;
}

/* دکمه‌های VIP در کارت‌ها */
.modern-usdt-btn {
    width: 100%;
    padding: 10px;
    background: linear-gradient(135deg, #00a86b, #00ff88);
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.modern-usdt-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
}

/* رسپانسیو برای موبایل */
@media (max-width: 480px) {
    .modern-usdt-modal {
        max-width: 95%;
        margin: 10px;
    }
    
    .compact-payment-content {
        max-height: 55vh;
    }
    
    .payment-steps {
        padding: 12px 15px;
    }
    
    .step-text {
        font-size: 0.6rem;
    }
    
    .compact-plan-summary,
    .compact-wallet-section,
    .compact-form {
        padding: 12px 15px;
    }
}
</style>

<script>
// سیستم پرداخت مدرن USDT - کاملاً فشرده
const compactUsdtPayment = {
    currentStep: 1,
    selectedPlan: null,
    wallet: '0x742d35Cc6634C0532925a3b8Df6A3f7f2Bc9e8D5',
    
    init() {
        this.addModernButtons();
        console.log('✅ سیستم پرداخت فشرده راه‌اندازی شد');
    },

    open(planId) {
        if (!window.userSystem?.currentUser) {
            this.showNotification('Please log in to your account first', 'Please log in to your account first', 'error');
            return;
        }

        this.selectedPlan = planId;
        this.currentStep = 1;
        this.showStep(1);
        document.getElementById('usdtPaymentModal').style.display = 'flex';
    },

    showStep(step) {
        this.currentStep = step;
        
        // آپدیت steps
        document.querySelectorAll('.step').forEach((stepEl, index) => {
            if (index + 1 <= step) {
                stepEl.classList.add('active');
            } else {
                stepEl.classList.remove('active');
            }
        });

        const content = document.getElementById('usdtModalContent');
        content.className = 'compact-payment-content';
        
        switch(step) {
            case 1:
                content.innerHTML = this.getPlanSelectionContent();
                break;
            case 2:
                content.innerHTML = this.getPaymentContent();
                break;
            case 3:
                content.innerHTML = this.getConfirmationContent();
                break;
        }
    },

    getPlanSelectionContent() {
        const plan = this.getPlanData(this.selectedPlan);
        return `
            <div class="compact-plan-selection">
                <div class="compact-plan-card">
                    <div class="compact-plan-name-large">${plan.name}</div>
                    <div class="compact-plan-price-large">${plan.price} USDT</div>
                    <div class="compact-plan-desc">
                        ${plan.description}
                    </div>
                </div>

                <button class="compact-submit-btn" onclick="compactUsdtPayment.showStep(2)">
                    Continue to payment
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
        `;
    },

    getPaymentContent() {
        const plan = this.getPlanData(this.selectedPlan);
        return `
            <div class="compact-plan-summary">
                <div class="compact-plan-name">${plan.name}</div>
                <div class="compact-plan-price">${plan.price} USDT</div>
            </div>

            <div class="compact-wallet-section">
                <div class="compact-wallet-title">
                    <i class="fas fa-wallet"></i>
                    Wallet Address
                </div>
                
                <div class="compact-address-box">
                    <div class="copy-badge" id="copyBadge">Copied</div>
                    <div class="compact-address-text">${this.wallet}</div>
                </div>

                <div class="compact-warning-box">
                    <div class="compact-warning-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        Very Important Notice
                    </div>
                    <div class="compact-warning-text">
                        Please read the following before sending payment
                    </div>
                    <div class="compact-warning-list">
                        <div class="compact-warning-item">
                            <i class="fas fa-circle"></i>
                            <span>Use only <strong>BEP20</strong> use</span>
                        </div>
                        <div class="compact-warning-item">
                            <i class="fas fa-circle"></i>
                            <span>Exact amount <strong>${plan.price} USDT</strong> send</span>
                        </div>
                        <div class="compact-warning-item">
                            <i class="fas fa-circle"></i>
                            <span>Any payment with wrong network is irreversible</span>
                        </div>
                        <div class="compact-warning-item">
                            <i class="fas fa-circle"></i>
                            <span>User is fully responsible for incorrect payments</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="compact-form">
                <div class="compact-form-group">
                    <label class="compact-form-label">
                        <i class="fas fa-receipt"></i>
                        Transaction ID (TXID)
                    </label>
                    <input type="text" class="compact-form-input" id="txidInput" 
                           placeholder="0x..."
                           style="font-family: monospace; font-size: 0.75rem;"
                           dir="ltr">
                    <div style="color: rgba(255,255,255,0.5); font-size: 0.7rem; margin-top: 4px;">
                        Transaction ID starts with 0x
                    </div>
                </div>

                <div class="compact-form-group">
                    <label class="compact-form-label">
                        <i class="fas fa-coins"></i>
                        Payment amount (USDT)
                    </label>
                    <input type="number" class="compact-form-input" id="sentAmount" 
                           value="${plan.price}" step="0.01" min="${plan.price}">
                </div>
            </div>

            <div class="compact-btn-group">
                <button class="compact-copy-btn" onclick="compactUsdtPayment.copyAddress()">
                    <i class="fas fa-copy"></i>
                    Copy address
                </button>
                
                <button class="compact-submit-btn" onclick="compactUsdtPayment.submitPayment()">
                    <i class="fas fa-paper-plane"></i>
                    Submit request
                </button>
                
                <button class="compact-back-btn" onclick="compactUsdtPayment.showStep(1)">
                    <i class="fas fa-arrow-right"></i>
                    Back
                </button>
            </div>
        `;
    },

    getConfirmationContent() {
        return `
            <div class="compact-confirmation">
                <div class="compact-confirmation-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="compact-confirmation-title">Your request has been submitted</div>
                <div class="compact-confirmation-text">
                    After your transaction is confirmed for VIP
                    The purchased plan will be activated as soon as possible
                </div>
                <button class="compact-submit-btn" onclick="compactUsdtPayment.close()">
                    <i class="fas fa-check"></i>
                    Got it
                </button>
            </div>
        `;
    },

    getPlanData(planId) {
        const plans = {
            1: {
                name: "VIP Silver",
                price: 10,
                description: "Access to Silver level premium features"
            },
            2: {
                name: "VIP Gold", 
                price: 18,
                description: "Access to Gold level premium features"
            },
            3: {
                name: "VIP Diamond",
                price: 30,
                description: "Full access to all premium features"
            }
        };
        return plans[planId];
    },

    copyAddress() {
        navigator.clipboard.writeText(this.wallet).then(() => {
            const badge = document.getElementById('copyBadge');
            badge.classList.add('show');
            setTimeout(() => badge.classList.remove('show'), 2000);
        });
    },

    submitPayment() {
        const txid = document.getElementById('txidInput').value.trim();
        const amount = parseFloat(document.getElementById('sentAmount').value);
        const plan = this.getPlanData(this.selectedPlan);

        // اعتبارسنجی TXID - فقط 0x شروع شدن رو چک کن
        if (!txid) {
            this.showNotification('error', ' Please enter transaction ID', 'error');
            return;
        }

        if (!txid.startsWith('0x')) {
            this.showNotification('error TXID', 'Transaction ID starts with 0x', 'error');
            return;
        }

        // اعتبارسنجی مبلغ
        if (!amount || amount < plan.price) {
            this.showNotification('amount', ` Insufficient ${plan.price} USDT`, 'warning');
            return;
        }

        this.savePaymentRequest(txid, amount);
        this.showStep(3);
        this.showNotification('Request submitted successfully', ' VIP ', 'success');
    },

    savePaymentRequest(txid, amount) {
        const request = {
            userId: window.userSystem.currentUser.id,
            userEmail: window.userSystem.currentUser.email,
            userName: window.userSystem.currentUser.name,
            planId: this.selectedPlan,
            planName: this.getPlanData(this.selectedPlan).name,
            txid: txid,
            amount: amount,
            status: 'pending',
            timestamp: Date.now(),
            network: 'BEP20'
        };

        const requests = JSON.parse(localStorage.getItem('usdt_payment_requests') || '[]');
        requests.push(request);
        localStorage.setItem('usdt_payment_requests', JSON.stringify(requests));
    },

    close() {
        document.getElementById('usdtPaymentModal').style.display = 'none';
        this.selectedPlan = null;
        this.currentStep = 1;
    },

    showNotification(title, message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `compact-notification ${type}`;
        notification.innerHTML = `
            <i class="fas fa-${this.getIcon(type)}"></i>
            <div class="compact-notification-content">
                <h4>${title}</h4>
                <p>${message}</p>
            </div>
        `;

        document.body.appendChild(notification);

        setTimeout(() => notification.classList.add('show'), 100);
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 400);
        }, 4000);
    },

    getIcon(type) {
        const icons = {
            success: 'check-circle',
            error: 'exclamation-circle',
            warning: 'exclamation-triangle',
            info: 'info-circle'
        };
        return icons[type] || 'info-circle';
    },

    addModernButtons() {
        setTimeout(() => {
            document.querySelectorAll('.vip-plan').forEach((card, index) => {
                const planId = index + 1;
                const footer = card.querySelector('.vip-plan-footer');
                
                if (footer && !footer.querySelector('.modern-usdt-btn')) {
                    const btn = document.createElement('button');
                    btn.className = 'modern-usdt-btn';
                    btn.innerHTML = `
                        <i class="fab fa-usdt"></i>
                        ${this.getPlanData(planId).price} USDT
                    `;
                    btn.onclick = (e) => {
                        e.stopPropagation();
                        this.open(planId);
                    };
                    
                    footer.appendChild(btn);
                }
            });
        }, 1000);
    }
};

// راه‌اندازی سیستم پرداخت فشرده
document.addEventListener('DOMContentLoaded', () => {
    compactUsdtPayment.init();
});

// آپدیت دکمه‌ها هنگام نمایش بخش VIP
document.querySelector('[data-section="vip-section"]')?.addEventListener('click', () => {
    setTimeout(() => compactUsdtPayment.addModernButtons(), 500);
});

// توابع جهانی
function openUsdtPayment(planId) { compactUsdtPayment.open(planId); }
function closeUsdtModal() { compactUsdtPayment.close(); }
</script>
    <script>
// ==================== توابع ایمن ====================
function safeGetElement(id) {
    const element = document.getElementById(id);
    if (!element) {
        console.warn(`Element with id '${id}' not found`);
    }
    return element;
}

function safeAddEventListener(id, event, handler) {
    const element = safeGetElement(id);
    if (element) {
        element.addEventListener(event, handler);
    }
}

function safeSetText(id, text) {
    const element = safeGetElement(id);
    if (element) {
        element.textContent = text;
    }
}

function safeGetValue(id) {
    const element = safeGetElement(id);
    return element ? element.value : '';
}

function safeSetValue(id, value) {
    const element = safeGetElement(id);
    if (element) {
        element.value = value;
    }
}

// کل cryptoRateSystem رو با این نسخه جایگزین کن:
const cryptoRateSystem = {
    rates: {
        bitcoin: { 
            price: 0, 
            symbol: 'BTC', 
            name: 'بیت‌کوین', 
            icon: 'fab fa-bitcoin' 
        },
        ethereum: { 
            price: 0, 
            symbol: 'ETH', 
            name: 'اتریوم', 
            icon: 'fab fa-ethereum' 
        },
        tether: { 
            price: 1, 
            symbol: 'USDT', 
            name: 'تتر', 
            icon: 'fas fa-coins' 
        }
    },
    coinToCryptoRate: 0.00001,
    lastUpdate: null,

    // 🔥 **تغییر مهم: موجودی‌ها رو بر اساس userId ذخیره می‌کنیم**
    userBalances: {},

    // دریافت نرخ‌های لحظه‌ای از API
    async fetchAllRates() {
        try {
            console.log('📡 در حال دریافت نرخ ارزها از API...');
            
            const response = await fetch(
                'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,tether&vs_currencies=usd',
                {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    timeout: 10000
                }
            );
            
            if (!response.ok) {
                throw new Error(`خطای API: ${response.status}`);
            }
            
            const data = await response.json();

            this.rates.bitcoin.price = data.bitcoin?.usd || 45000;
            this.rates.ethereum.price = data.ethereum?.usd || 2500;
            this.rates.tether.price = data.tether?.usd || 1;

            this.lastUpdate = new Date();
            this.saveToStorage();
            
            console.log('✅ نرخ ارزها با موفقیت دریافت شد');
            
            return true;
            
        } catch (error) {
            console.error('❌ خطا در دریافت نرخ ارزها:', error);
            
            this.rates.bitcoin.price = this.rates.bitcoin.price || 45000;
            this.rates.ethereum.price = this.rates.ethereum.price || 2500;
            this.rates.tether.price = this.rates.tether.price || 1;
            
            this.loadFromStorage();
            return false;
        }
    },

    // 🔥 **اصلاح: گرفتن موجودی کاربر جاری**
    getUserBalances() {
        if (!window.userSystem || !window.userSystem.currentUser) {
            return {
                tether: 0,
                bitcoin: 0,
                ethereum: 0
            };
        }
        
        const userId = window.userSystem.currentUser.id;
        return this.userBalances[userId] || {
            tether: 0,
            bitcoin: 0,
            ethereum: 0
        };
    },

    // 🔥 **اصلاح: تنظیم موجودی برای کاربر جاری**
    setUserBalances(balances) {
        if (!window.userSystem || !window.userSystem.currentUser) return;
        
        const userId = window.userSystem.currentUser.id;
        this.userBalances[userId] = { ...balances };
        this.saveToStorage();
    },

    // محاسبه مقدار هر ارز بر اساس سکه
    calculateCryptoAmount(coinAmount) {
        if (!coinAmount || coinAmount <= 0) {
            return {
                tether: 0,
                bitcoin: 0,
                ethereum: 0
            };
        }
        
        const baseValue = coinAmount * this.coinToCryptoRate;
        
        const bitcoinPrice = this.rates.bitcoin.price || 45000;
        const ethereumPrice = this.rates.ethereum.price || 2500;
        const tetherPrice = this.rates.tether.price || 1;
        
        const amounts = {
            tether: baseValue / tetherPrice,
            bitcoin: baseValue / bitcoinPrice,
            ethereum: baseValue / ethereumPrice
        };
        
        console.log(`💰 محاسبه تبدیل ${coinAmount} سکه:`, amounts);
        return amounts;
    },

    // 🔥 **اصلاح: اضافه کردن به موجودی کاربر جاری**
    addToUserBalance(amounts) {
        if (!amounts || !window.userSystem || !window.userSystem.currentUser) return;
        
        const userId = window.userSystem.currentUser.id;
        const currentBalances = this.getUserBalances();
        
        const newBalances = {
            tether: currentBalances.tether + (amounts.tether || 0),
            bitcoin: currentBalances.bitcoin + (amounts.bitcoin || 0),
            ethereum: currentBalances.ethereum + (amounts.ethereum || 0)
        };
        
        this.setUserBalances(newBalances);
        
        console.log('✅ موجودی کاربر آپدیت شد:', newBalances);
    },

    // 🔥 **اصلاح: تنظیم موجودی اولیه برای کاربران جدید**
    initializeUserBalances() {
        if (!window.userSystem || !window.userSystem.currentUser) {
            return {
                tether: 0,
                bitcoin: 0,
                ethereum: 0
            };
        }
        
        const userId = window.userSystem.currentUser.id;
        const currentBalances = this.getUserBalances();
        
        // فقط اگر کاربر موجودی ندارد، موجودی اولیه تنظیم کن
        if (currentBalances.tether === 0 && currentBalances.bitcoin === 0 && currentBalances.ethereum === 0) {
            console.log('🎁 تنظیم موجودی اولیه برای کاربر جدید...');
            
            const initialBalances = {
                tether: 0.5,
                bitcoin: 0.0001,
                ethereum: 0.01
            };
            
            this.setUserBalances(initialBalances);
            console.log('✅ موجودی اولیه تنظیم شد:', initialBalances);
        }
        
        return this.getUserBalances();
    },

    // 🔥 **اصلاح: پاک کردن موجودی کاربر هنگام خروج**
    clearCurrentUserBalances() {
        if (!window.userSystem || !window.userSystem.currentUser) return;
        
        const userId = window.userSystem.currentUser.id;
        this.userBalances[userId] = {
            tether: 0,
            bitcoin: 0,
            ethereum: 0
        };
        this.saveToStorage();
    },

    // دریافت نرخ‌ها برای نمایش
    getRatesForDisplay() {
        return {
            bitcoin: {
                price: this.rates.bitcoin.price,
                symbol: this.rates.bitcoin.symbol,
                name: this.rates.bitcoin.name
            },
            ethereum: {
                price: this.rates.ethereum.price,
                symbol: this.rates.ethereum.symbol,
                name: this.rates.ethereum.name
            },
            tether: {
                price: this.rates.tether.price,
                symbol: this.rates.tether.symbol,
                name: this.rates.tether.name
            }
        };
    },

    // بررسی اعتبار نرخ‌ها
    areRatesValid() {
        return this.rates.bitcoin.price > 0 && 
               this.rates.ethereum.price > 0 && 
               this.rates.tether.price > 0;
    },

    // 🔥 **اصلاح: ذخیره در localStorage**
    saveToStorage() {
        try {
            const dataToSave = {
                rates: this.rates,
                userBalances: this.userBalances, // 🔥 ذخیره موجودی همه کاربران
                lastUpdate: this.lastUpdate ? this.lastUpdate.getTime() : null,
                coinToCryptoRate: this.coinToCryptoRate
            };
            
            localStorage.setItem('crypto_system_data', JSON.stringify(dataToSave));
            console.log('💾 داده‌های سیستم ارزها ذخیره شد');
            
        } catch (error) {
            console.warn('❌ خطا در ذخیره سازی داده‌ها:', error);
        }
    },

    // 🔥 **اصلاح: بارگذاری از localStorage**
    loadFromStorage() {
        try {
            const saved = localStorage.getItem('crypto_system_data');
            if (saved) {
                const data = JSON.parse(saved);
                
                this.rates = data.rates || this.rates;
                this.userBalances = data.userBalances || {}; // 🔥 لود موجودی همه کاربران
                this.coinToCryptoRate = data.coinToCryptoRate || this.coinToCryptoRate;
                
                if (data.lastUpdate) {
                    this.lastUpdate = new Date(data.lastUpdate);
                }
                
                console.log('📂 داده‌های ذخیره شده بارگذاری شد');
                return true;
            }
        } catch (error) {
            console.warn('❌ خطا در خواندن داده‌های ذخیره شده:', error);
        }
        
        return false;
    },

    // ریست کردن موجودی کاربر جاری
    resetCurrentUserBalances() {
        if (confirm('⚠️ آیا از ریست کردن موجودی ارزهای خود اطمینان دارید؟')) {
            this.clearCurrentUserBalances();
            console.log('🔄 موجودی ارزهای کاربر ریست شد');
            return true;
        }
        return false;
    }
};

// ==================== مدیریت وضعیت صفحات ====================
function cleanupAllAnimations() {
    // توقف الماس ماینر
    const diamondLogo = safeGetElement('minerDiamondLogo');
    if (diamondLogo) {
        diamondLogo.classList.remove('mining-active');
        diamondLogo.style.animation = 'none';
    }
    
    // توقف تمام interval ها
    if (window.gameState && window.gameState.autoClickInterval) {
        clearInterval(window.gameState.autoClickInterval);
        window.gameState.autoClickInterval = null;
    }
    
    if (window.gameState && window.gameState.activeTimers) {
        window.gameState.activeTimers.forEach(timer => clearInterval(timer));
        window.gameState.activeTimers.clear();
    }
    
    // پاکسازی particle ها
    document.querySelectorAll('.particle, [style*="position: fixed"]').forEach(el => {
        if (el.id !== 'celebrationAnimation') el.remove();
    });
}

function stopSectionAnimations(sectionId) {
    switch(sectionId) {
        case 'miner-section':
            // توقف انیمیشن‌های ماینر
            const minerDiamond = safeGetElement('minerDiamondLogo');
            if (minerDiamond) {
                minerDiamond.style.animationPlayState = 'paused';
            }
            break;
        // اضافه کردن برای سایر بخش‌ها اگر نیاز باشد
    }
}

function initializeSectionAnimations(sectionId) {
    switch(sectionId) {
        case 'miner-section':
            // راه‌اندازی انیمیشن‌های ماینر
            const minerDiamond = safeGetElement('minerDiamondLogo');
            if (minerDiamond) {
                minerDiamond.style.animationPlayState = 'running';
            }
            if (window.minerSystem) {
                window.minerSystem.updateMinerDisplay();
            }
            break;
        case 'levels-section':
            generateLevelCards();
            break;
        case 'conversion-section':
            updateConversionAmount();
            break;
        case 'vip-section':
            generateVipPlans();
            updateVipStatus();
            break;
        case 'profile-section':
            updateUserInterface();
            break;
        case 'affiliate-section':
            updateAffiliateStats();
            break;
    }
}

// ==================== سیستم ماینر جدید - کامل ====================
const minerSystem = {
    settings: {
        baseReward: 1000,
        duration: 1 * 60 * 60 * 1000,
        maxActiveMiners: 1000,
        globalMultiplier: 1.0
    },

    userMiners: {},

    init() {
        this.loadSettings();
        this.setupEventListeners();
    },

    setupEventListeners() {
        safeAddEventListener('startMinerBtn', 'click', () => this.startMining());
        safeAddEventListener('harvestMinerBtn', 'click', () => this.harvestMining());
        
        safeAddEventListener('adminUpdateMinerSettings', 'click', () => this.updateAdminSettings());
        safeAddEventListener('adminResetAllMiners', 'click', () => this.resetAllMiners());
    },

    startMining() {
        if (!window.userSystem || !window.userSystem.currentUser) {
            showNotification('Please log in to your account first', 'error');
            return;
        }

        const userId = window.userSystem.currentUser.id;
        const userMiner = this.getUserMiner(userId);

        if (userMiner.isActive) {
            showNotification('Your miner is currently active', 'info');
            return;
        }

        userMiner.isActive = true;
        userMiner.startTime = Date.now();
        userMiner.endTime = Date.now() + this.settings.duration;
        userMiner.collectedCoins = 0;
        userMiner.totalSessions = (userMiner.totalSessions || 0) + 1;

        this.saveUserMiner(userId, userMiner);
        this.updateMinerDisplay();
        
        const hours = this.settings.duration / (1000 * 60 * 60);
        let timeText;
        if (hours === 1) {
            timeText = '1 hour';
        } else if (hours === 0.5) {
            timeText = '30 minutes';
        } else if (hours < 1) {
            const minutes = Math.floor(hours * 60);
            timeText = `${minutes} minutes`;
        } else {
            timeText = `${hours} 
            hour`;
        }

        showNotification(`⛏️ Auto mining started! After ${timeText} you can withdraw coins.`, 'success');
    },

    harvestMining() {
        if (!window.userSystem || !window.userSystem.currentUser) {
            showNotification('Please log in to your account first', 'error');
            return;
        }

        const userId = window.userSystem.currentUser.id;
        const userMiner = this.getUserMiner(userId);

        if (!userMiner.isActive) {
            showNotification('Your miner is not active', 'error');
            return;
        }

        const earnedCoins = this.calculateEarnedCoins(userMiner);
        
        if (earnedCoins <= 0) {
            showNotification('No coins available for withdrawal yet', 'info');
            return;
        }
        showNetworkConfirmation(earnedCoins);
        // بررسی محدودیت و محاسبه مقدار قابل برداشت
        const harvestResult = this.checkMinerLimit(earnedCoins);
        
        if (harvestResult === false) {
            return; // هیچ سکه‌ای قابل برداشت نیست
        }

        const actualCoinsToHarvest = harvestResult === true ? earnedCoins : harvestResult;

        if (actualCoinsToHarvest <= 0) {
            showNotification('Withdrawal limit reached', 'warning');
            return;
        }

        // اعمال برداشت
        window.gameState.coinCount += actualCoinsToHarvest;
        userMiner.totalEarnings = (userMiner.totalEarnings || 0) + actualCoinsToHarvest;
        
        if (window.tokenomicsSystem) {
    window.tokenomicsSystem.addMinedCoins(actualCoinsToHarvest, userId);
}
        // اعمال محدودیت
        this.applyMinerLimit(actualCoinsToHarvest);
        
        if (!userMiner.history) userMiner.history = [];
        userMiner.history.unshift({
            amount: actualCoinsToHarvest,
            timestamp: Date.now(),
            session: userMiner.totalSessions
        });

        if (userMiner.history.length > 10) {
            userMiner.history = userMiner.history.slice(0, 10);
        }

        userMiner.isActive = false;
        userMiner.startTime = null;
        userMiner.endTime = null;
        userMiner.collectedCoins = 0;

        this.saveUserMiner(userId, userMiner);
        this.updateMinerDisplay();
        updateAllDisplays();
        if (window.userSystem) {
            window.userSystem.saveUserData(window.gameState, window.levelSystem);
        }
        
        if (actualCoinsToHarvest < earnedCoins) {
            showNotification(`🎉 ${actualCoinsToHarvest.toLocaleString()} (Coin ${earnedCoins.toLocaleString()} Coins withdrawn successfully`, 'success');
        } else {
            showNotification(`🎉 ${actualCoinsToHarvest.toLocaleString()} Coins withdrawn successfully`, 'success');
        }
    },

    checkMinerLimit(earnedCoins) {
        if (!window.userSystem || !window.userSystem.currentUser) return false;

        // کاربران VIP الماس محدودیتی ندارند
        if (window.vipSystem && window.vipSystem.currentVip && window.vipSystem.currentVip.id === 3) {
            return true;
        }

        let currentLimit, collected, limitType;

        if (!window.vipSystem || !window.vipSystem.currentVip) {
            // کاربران معمولی - محدودیت کل
            currentLimit = window.vipSystem.maxRegularLimit;
            collected = window.vipSystem.totalCollected;
            limitType = 'Total';
        } else if (window.vipSystem.currentVip.id === 1 || window.vipSystem.currentVip.id === 2) {
            // کاربران VIP نقره‌ای و طلایی - محدودیت روزانه
            currentLimit = window.vipSystem.currentVip.dailyLimit;
            collected = window.vipSystem.dailyCollected;
            limitType = 'Dayli';
        } else {
            return true;
        }

        // اگر محدودیت نامحدود است
        if (currentLimit === -1) return true;

        // محاسبه مقدار قابل برداشت
        const remainingLimit = currentLimit - collected;
        
        if (remainingLimit <= 0) {
            // هیچ سکه‌ای برای برداشت باقی نمانده
            showLimitReachedModal(limitType);
            return false;
        }

        if (earnedCoins > remainingLimit) {
            // فقط تا سقف محدودیت اجازه برداشت بده
            showNotification(
                `You can only ${remainingLimit.toLocaleString()} more coins due to limit (Limit ${limitType})`, 
                'warning'
            );
            // مقدار قابل برداشت را برگردان
            return remainingLimit;
        }

        return true;
    },

    applyMinerLimit(earnedCoins) {
        if (!window.userSystem || !window.userSystem.currentUser) return;

        if (!window.vipSystem || !window.vipSystem.currentVip) {
            window.vipSystem.totalCollected += earnedCoins;
        } else if (window.vipSystem.currentVip.id === 1 || window.vipSystem.currentVip.id === 2) {
            window.vipSystem.dailyCollected += earnedCoins;
        }

        if (window.saveVipData) saveVipData();
        if (window.updateLimitDisplay) updateLimitDisplay();
    },

    calculateEarnedCoins(userMiner) {
        if (!userMiner.isActive || !userMiner.startTime) return 0;

        const now = Date.now();
        const timeLeft = userMiner.endTime - now;
        const elapsed = this.settings.duration - timeLeft;
        
        const progress = Math.min(elapsed / this.settings.duration, 1);
        const baseCoins = Math.floor(this.settings.baseReward * progress);
        
        const levelMultiplier = 1 + ((window.levelSystem ? window.levelSystem.currentLevel : 1) * 0.05);
        const finalCoins = Math.floor(baseCoins * levelMultiplier * this.settings.globalMultiplier);

        return Math.max(0, finalCoins);
    },

    updateMinerDisplay() {
        // فقط اگر بخش ماینر فعال است آپدیت شود
        const minerSection = safeGetElement('miner-section');
        if (!minerSection || !minerSection.classList.contains('active')) {
            return;
        }

        if (!window.userSystem || !window.userSystem.currentUser) {
            this.showGuestMinerDisplay();
            return;
        }

        const userId = window.userSystem.currentUser.id;
        const userMiner = this.getUserMiner(userId);
        
        const collectedElement = safeGetElement('minerCollected');
        const timeLeftElement = safeGetElement('minerTimeLeft');
        const progressFillElement = safeGetElement('minerProgressFill');
        const progressPercentElement = safeGetElement('minerProgressPercent');
        const statusElement = safeGetElement('minerStatus');
        const startBtn = safeGetElement('startMinerBtn');
        const harvestBtn = safeGetElement('harvestMinerBtn');

        if (userMiner.isActive) {
            const earnedCoins = this.calculateEarnedCoins(userMiner);
            const timeLeft = userMiner.endTime - Date.now();
            
            if (collectedElement) collectedElement.textContent = earnedCoins.toLocaleString();
            
            if (timeLeft > 0) {
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                if (timeLeftElement) {
                    timeLeftElement.textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                
                const progress = ((this.settings.duration - timeLeft) / this.settings.duration) * 100;
                if (progressFillElement) progressFillElement.style.width = `${progress}%`;
                if (progressPercentElement) progressPercentElement.textContent = `${Math.floor(progress)}%`;
            } else {
                if (timeLeftElement) timeLeftElement.textContent = 'Ready for withdrawal';
                if (progressFillElement) progressFillElement.style.width = '100%';
                if (progressPercentElement) progressPercentElement.textContent = '100%';
            }
            
            if (statusElement) {
                statusElement.textContent = 'Active';
                statusElement.className = 'miner-status status-active';
            }
            
            if (startBtn) startBtn.disabled = true;
            if (harvestBtn) harvestBtn.disabled = timeLeft > 0;
        } else {
            if (collectedElement) collectedElement.textContent = '۰';
            if (timeLeftElement) timeLeftElement.textContent = '۰:۰۰:۰۰';
            if (progressFillElement) progressFillElement.style.width = '0%';
            if (progressPercentElement) progressPercentElement.textContent = '۰٪';
            
            if (statusElement) {
                statusElement.textContent = 'Disabled';
                statusElement.className = 'miner-status status-inactive';
            }
            
            if (startBtn) startBtn.disabled = false;
            if (harvestBtn) harvestBtn.disabled = true;
        }

        this.updateMinerHistory(userMiner);
    },

    showGuestMinerDisplay() {
        const collectedElement = safeGetElement('minerCollected');
        const timeLeftElement = safeGetElement('minerTimeLeft');
        const progressFillElement = safeGetElement('minerProgressFill');
        const progressPercentElement = safeGetElement('minerProgressPercent');
        const statusElement = safeGetElement('minerStatus');
        const startBtn = safeGetElement('startMinerBtn');
        const harvestBtn = safeGetElement('harvestMinerBtn');

        if (collectedElement) collectedElement.textContent = '۰';
        if (timeLeftElement) timeLeftElement.textContent = '۰:۰۰:۰۰';
        if (progressFillElement) progressFillElement.style.width = '0%';
        if (progressPercentElement) progressPercentElement.textContent = '۰٪';
        
        if (statusElement) {
            statusElement.textContent = 'Login required';
            statusElement.className = 'miner-status status-inactive';
        }
        
        if (startBtn) startBtn.disabled = true;
        if (harvestBtn) harvestBtn.disabled = true;
    },

    updateMinerHistory(userMiner) {
        const historyList = safeGetElement('minerHistoryList');
        if (!historyList) return;

        if (!userMiner.history || userMiner.history.length === 0) {
            historyList.innerHTML = '<div style="text-align: center; color: var(--gray); padding: 20px;">No mining activity yet</div>';
            return;
        }

        historyList.innerHTML = userMiner.history.map(item => `
            <div class="history-item">
                <span class="history-amount">+${item.amount.toLocaleString()} coins</span>
                <span class="history-time">${this.formatTime(item.timestamp)}</span>
            </div>
        `).join('');
    },

    formatTime(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diff = now - date;
        
        if (diff < 60 * 60 * 1000) {
            const minutes = Math.floor(diff / (60 * 1000));
            return `${minutes} minutes ago`;
        } else if (diff < 24 * 60 * 60 * 1000) {
            const hours = Math.floor(diff / (60 * 60 * 1000));
            return `${hours} hours ago`;
        } else {
            return date.toLocaleDateString('fa-IR');
        }
    },

    getUserMiner(userId) {
        if (!this.userMiners[userId]) {
            this.userMiners[userId] = this.loadUserMiner(userId) || {
                isActive: false,
                startTime: null,
                endTime: null,
                collectedCoins: 0,
                totalEarnings: 0,
                totalSessions: 0,
                history: []
            };
        }
        return this.userMiners[userId];
    },

    loadUserMiner(userId) {
        return StorageManager.getItem(`miner_${userId}`);
    },

    saveUserMiner(userId, minerData) {
        this.userMiners[userId] = minerData;
        StorageManager.setItem(`miner_${userId}`, minerData);
    },

    updateAdminMinerStats() {
        if (!window.adminSystem || !window.adminSystem.isLoggedIn) return;

        const activeMiners = Object.values(this.userMiners).filter(miner => miner.isActive).length;
        const totalEarnings = Object.values(this.userMiners).reduce((sum, miner) => sum + (miner.totalEarnings || 0), 0);
        const totalSessions = Object.values(this.userMiners).reduce((sum, miner) => sum + (miner.totalSessions || 0), 0);
        
        const usersWithSessions = Object.values(this.userMiners).filter(miner => miner.totalSessions > 0).length;
        const avgEfficiency = usersWithSessions > 0 ? Math.min(100, (totalSessions / usersWithSessions) * 20) : 0;

        safeSetText('adminActiveMiners', activeMiners.toLocaleString());
        safeSetText('adminMinerEarnings', totalEarnings.toLocaleString());
        safeSetText('adminTotalMiningSessions', totalSessions.toLocaleString());
        safeSetText('adminAvgMinerEfficiency', `${Math.round(avgEfficiency)}%`);
    },

    updateAdminSettings() {
        const baseReward = parseInt(safeGetValue('adminMinerBaseReward')) || 1000;
        const durationHours = parseFloat(safeGetValue('adminMinerDuration')) || 1;
        
        const oldDuration = this.settings.duration;
        this.settings.baseReward = baseReward;
        this.settings.duration = durationHours * 60 * 60 * 1000;
        
        this.updateAllActiveMiners(oldDuration);
        
        this.saveSettings();
        if (window.adminSystem) {
            window.adminSystem.showAdminNotification(`✅ تنظیمات ماینر بروزرسانی شد (${durationHours} ساعت - ${baseReward} سکه)`, 'success');
        }
    },

    updateAllActiveMiners(oldDuration) {
        const durationChanged = oldDuration !== this.settings.duration;
        const rewardChanged = this.settings.baseReward !== this.baseReward;
        
        Object.keys(this.userMiners).forEach(userId => {
            const userMiner = this.userMiners[userId];
            
            if (userMiner.isActive && userMiner.startTime && userMiner.endTime) {
                if (durationChanged) {
                    const elapsed = Date.now() - userMiner.startTime;
                    const progress = Math.min(elapsed / oldDuration, 1);
                    
                    userMiner.endTime = userMiner.startTime + (this.settings.duration * progress);
                }
                
                if (rewardChanged) {
                    const earnedCoins = this.calculateEarnedCoins(userMiner);
                    userMiner.collectedCoins = earnedCoins;
                }
                
                this.saveUserMiner(userId, userMiner);
            }
        });
        
        if (window.userSystem && window.userSystem.currentUser) {
            this.updateMinerDisplay();
            showNotification('⏰ تنظیمات ماینر به‌روزرسانی شد!', 'info');
        }
    },

    resetAllMiners() {
        if (confirm('⚠️ آیا از ریست کردن همه ماینرها اطمینان دارید؟')) {
            this.userMiners = {};
            
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('miner_')) {
                    localStorage.removeItem(key);
                }
            });
            
            this.updateMinerDisplay();
            if (window.adminSystem) {
                window.adminSystem.showAdminNotification('✅ همه ماینرها ریست شدند', 'success');
            }
        }
    },

    loadSettings() {
        const saved = StorageManager.getItem('miner_settings');
        if (saved) {
            this.settings = { ...this.settings, ...saved };
        }
        
        safeSetValue('adminMinerBaseReward', this.settings.baseReward);
        safeSetValue('adminMinerDuration', this.settings.duration / (60 * 60 * 1000));
    },

    saveSettings() {
        StorageManager.setItem('miner_settings', this.settings);
    }
};

// ==================== مدیریت الماس ماینر ====================
const minerDiamond = {
    init() {
        this.setupEventListeners();
        this.updateMinerDiamondDisplay();
    },

    setupEventListeners() {
        safeAddEventListener('minerDiamondLogo', 'click', () => this.handleDiamondClick());
        
        // مشاهده تغییرات وضعیت بخش
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'class') {
                    const minerSection = safeGetElement('miner-section');
                    if (minerSection && minerSection.classList.contains('active')) {
                        this.updateMinerDiamondDisplay();
                    } else {
                        // اگر بخش ماینر غیرفعال است، انیمیشن‌ها رو متوقف کن
                        this.stopMiningAnimation();
                    }
                }
            });
        });
        
        const minerSection = safeGetElement('miner-section');
        if (minerSection) {
            observer.observe(minerSection, { attributes: true });
        }
    },

    handleDiamondClick() {
        if (!window.userSystem || !window.userSystem.currentUser) {
            showNotification('Please log in to your account to start mining', 'info');
            const registerModal = safeGetElement('registerModal');
            if (registerModal) registerModal.style.display = 'flex';
            return;
        }

        const userMiner = minerSystem.getUserMiner(window.userSystem.currentUser.id);
        
        if (!userMiner.isActive) {
            minerSystem.startMining();
            this.startMiningAnimation();
        } else {
            showNotification('Your miner is currently active', 'info');
        }
    },

    startMiningAnimation() {
        const diamondLogo = safeGetElement('minerDiamondLogo');
        const minerSection = safeGetElement('miner-section');
        
        if (diamondLogo && minerSection && minerSection.classList.contains('active')) {
            diamondLogo.classList.add('mining-active');
            this.createMiningParticles();
        }
    },

    stopMiningAnimation() {
        const diamondLogo = safeGetElement('minerDiamondLogo');
        if (diamondLogo) {
            diamondLogo.classList.remove('mining-active');
        }
    },

    createMiningParticles() {
        const diamondLogo = safeGetElement('minerDiamondLogo');
        if (!diamondLogo) return;

        for (let i = 0; i < 8; i++) {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.innerHTML = '✨';
                particle.style.position = 'absolute';
                particle.style.fontSize = '20px';
                particle.style.color = '#ffd700';
                particle.style.pointerEvents = 'none';
                particle.style.zIndex = '5';
                
                const rect = diamondLogo.getBoundingClientRect();
                const startX = rect.left + rect.width / 2;
                const startY = rect.top + rect.height / 2;
                
                particle.style.left = `${startX}px`;
                particle.style.top = `${startY}px`;
                
                document.body.appendChild(particle);
                
                const angle = (i / 8) * Math.PI * 2;
                const distance = 120 + Math.random() * 80;
                
                particle.animate([
                    { 
                        transform: 'translate(0, 0) scale(1) rotate(0deg)',
                        opacity: 1 
                    },
                    { 
                        transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0.5) rotate(180deg)`,
                        opacity: 0 
                    }
                ], {
                    duration: 1200 + Math.random() * 600,
                    easing: 'cubic-bezier(0.2, 0, 0.8, 1)'
                }).onfinish = () => {
                    if (particle.parentNode) particle.remove();
                };
            }, i * 150);
        }
    },

    updateMinerDiamondDisplay() {
        const diamondLogo = safeGetElement('minerDiamondLogo');
        const loginRequiredText = safeGetElement('minerLoginRequired');
        const minerSection = safeGetElement('miner-section');
        
        if (!diamondLogo || !loginRequiredText || !minerSection) return;

        // فقط اگر بخش ماینر فعال است آپدیت شود
        if (!minerSection.classList.contains('active')) {
            this.stopMiningAnimation();
            return;
        }

        if (!window.userSystem || !window.userSystem.currentUser) {
            diamondLogo.classList.add('login-required');
            diamondLogo.classList.remove('mining-active');
            loginRequiredText.style.display = 'block';
            loginRequiredText.textContent = 'Please login to start mining';
        } else {
            diamondLogo.classList.remove('login-required');
            loginRequiredText.style.display = 'none';
            
            const userMiner = minerSystem.getUserMiner(window.userSystem.currentUser.id);
            if (userMiner.isActive) {
                this.startMiningAnimation();
                loginRequiredText.style.display = 'block';
                loginRequiredText.textContent = '⛏️ Mining in progress...';
                loginRequiredText.style.color = 'var(--primary)';
            } else {
                this.stopMiningAnimation();
                loginRequiredText.style.display = 'block';
                loginRequiredText.textContent = 'Click to start mining';
                loginRequiredText.style.color = 'var(--gray)';
            }
        }
    }
};

// ==================== سیستم مدیریت ====================
const adminSystem = {
    isLoggedIn: false,
    secretCode: "67393967",
    currentCode: "",
    settings: {
        coinRate: 5,
        dollarRate: 50000,
        regularLimit: 100000,
        vipPrices: {
            1: 50000,
            2: 200000,  
            3: 500000
        },
        referralSettings: {
            level1Percent: 10,
            level2Percent: 5,
            signupBonus: 50
        }
    },

    init() {
        this.loadSettings();
        this.setupEventListeners();
        this.setupGemAccess();
        this.updateRateDisplays();
    },

    setupEventListeners() {
        document.querySelectorAll('.keyboard-key').forEach(key => {
            key.addEventListener('click', (e) => {
                const keyValue = e.target.getAttribute('data-key');
                this.handleKeyPress(keyValue);
            });
        });
        // مدیریت توکنومیکس
safeAddEventListener('adminLoadTokenomics', 'click', () => this.loadTokenomicsData());
safeAddEventListener('adminSaveTokenomics', 'click', () => this.saveTokenomicsData());
safeAddEventListener('adminResetTokenomics', 'click', () => this.resetTokenomicsData());
safeAddEventListener('adminClearTokenomicsHistory', 'click', () => this.clearTokenomicsHistory());

        safeAddEventListener('adminLoginBtn', 'click', () => this.login());
        safeAddEventListener('adminLoginCancel', 'click', () => this.hideAdminLogin());
        safeAddEventListener('adminLogout', 'click', () => this.logout());
        
        safeAddEventListener('adminFindUser', 'click', () => this.findUser());
        safeAddEventListener('adminResetUser', 'click', () => this.resetUser());
        safeAddEventListener('adminUpdateUser', 'click', () => this.updateUser());
        
        safeAddEventListener('adminSaveSettings', 'click', () => this.saveSettings());
        
        safeAddEventListener('adminAddCoinsToAll', 'click', () => this.addCoinsToAll());
        // در setupEventListeners سیستم مدیریت:
safeAddEventListener('adminUpdateCoinRate', 'click', function() {
    const newRate = parseFloat(safeGetValue('adminCoinToCryptoRate'));
    
    if (newRate && newRate > 0 && newRate <= 1) {
        // ذخیره در localStorage
        localStorage.setItem('coin_to_crypto_rate', newRate.toString());
        
        // آپدیت در سیستم
        cryptoRateSystem.coinToCryptoRate = newRate;
        
        // نمایش پیام
        if (window.adminSystem) {
            window.adminSystem.showAdminNotification(`✅ نرخ تبدیل به ${newRate} ذخیره شد`, 'success');
        }
        
        console.log('نرخ جدید ذخیره شد:', newRate);
    } else {
        if (window.adminSystem) {
            window.adminSystem.showAdminNotification('❌ نرخ باید بین ۰.۰۰۰۰۰۱ تا ۱ باشد', 'error');
        }
    }
});
        safeAddEventListener('adminAddDailyBonus', 'click', () => this.addDailyBonus());
        safeAddEventListener('adminAddCoinsToAllOps', 'click', () => this.addCoinsToAll());
        safeAddEventListener('adminAddDailyBonusOps', 'click', () => this.addDailyBonus());
        safeAddEventListener('adminResetAll', 'click', () => this.resetAllUsers());
        safeAddEventListener('adminExportData', 'click', () => this.exportData());
        safeAddEventListener('adminImportData', 'click', () => this.importData());
        
        safeAddEventListener('adminDollarRate', 'input', () => this.updateRateDisplays());
        safeAddEventListener('adminCoinRate', 'input', () => this.updateRateDisplays());
safeAddEventListener('adminUpdateCoinRate', 'click', function() {
    const newRate = parseFloat(safeGetValue('adminCoinToCryptoRate'));
    if (newRate && newRate > 0 && newRate <= 1) {
        cryptoRateSystem.coinToCryptoRate = newRate;
        cryptoRateSystem.saveToStorage();
        
        // آپدیت نمایش
        updateRateCalculationDisplay();
        if (safeGetElement('conversion-section')?.classList.contains('active')) {
            updateConversionAmount();
        }
        
        if (window.adminSystem) {
            window.adminSystem.showAdminNotification(`✅ نرخ تبدیل به ${newRate} USDT بروزرسانی شد`, 'success');
        }
    } else {
        if (window.adminSystem) {
            window.adminSystem.showAdminNotification('❌ نرخ باید بین ۰.۰۰۰۰۰۱ تا ۱ باشد', 'error');
        }
    }
});

// event listener برای نمایش محاسبه لحظه‌ای
safeAddEventListener('adminCoinToCryptoRate', 'input', function() {
    updateRateCalculationDisplay();
});
        safeAddEventListener('adminSaveVipTimerSettings', 'click', () => this.saveVipTimerSettings());
    },

    setupGemAccess() {
        let clickCount = 0;
        let lastClickTime = 0;
        const clickTimeout = 2000;

        safeAddEventListener('adminGemAccess', 'click', (e) => {
            const currentTime = Date.now();
            
            if (currentTime - lastClickTime > clickTimeout) {
                clickCount = 0;
            }
            
            clickCount++;
            lastClickTime = currentTime;
            
            if (clickCount === 5) {
                this.showAdminLogin();
                clickCount = 0;
            }
        });
    },

    handleKeyPress(key) {
        if (key === 'clear') {
            this.currentCode = "";
        } else if (this.currentCode.length < 8) {
            this.currentCode += key;
        }
        
        this.updateCodeDisplay();
    },

    updateCodeDisplay() {
        const display = safeGetElement('adminCodeDisplay');
        if (!display) return;
        
        let displayText = "";
        
        for (let i = 0; i < 8; i++) {
            if (i < this.currentCode.length) {
                displayText += this.currentCode[i];
            } else {
                displayText += "_";
            }
        }
        
        display.textContent = displayText;
    },

    login() {
        if (this.currentCode === this.secretCode) {
            this.isLoggedIn = true;
            this.hideAdminLogin();
            this.showAdminPanel();
            this.updateAdminStats();
            this.loadUsersTable();
        } else {
            this.currentCode = "";
            this.updateCodeDisplay();
        }
    },

    logout() {
        this.isLoggedIn = false;
        this.hideAdminPanel();
        this.currentCode = "";
        this.updateCodeDisplay();
    },

    showAdminLogin() {
        const modal = safeGetElement('adminLoginModal');
        if (modal) modal.classList.add('active');
    },

    hideAdminLogin() {
        const modal = safeGetElement('adminLoginModal');
        if (modal) modal.classList.remove('active');
        this.currentCode = "";
        this.updateCodeDisplay();
    },

    showAdminPanel() {
        const userSections = [
            'miner-section', 'levels-section', 'conversion-section', 
            'vip-section', 'affiliate-section', 'profile-section'
        ];
        
        userSections.forEach(sectionId => {
            const section = safeGetElement(sectionId);
            if (section) section.classList.remove('active');
        });
        
        const userNavIcons = document.querySelectorAll('.nav-icon:not(.admin-nav-item)');
        userNavIcons.forEach(icon => {
            icon.style.display = 'none';
        });
        
        const adminSections = document.querySelectorAll('.admin-section');
        const adminNavItems = document.querySelectorAll('.admin-nav-item');
        
        adminSections.forEach(section => section.classList.remove('active'));
        adminNavItems.forEach(item => item.style.display = 'flex');
        
        const adminDashboard = safeGetElement('admin-dashboard-section');
        if (adminDashboard) adminDashboard.classList.add('active');
        
        const firstAdminNav = document.querySelector('.admin-nav-item');
        if (firstAdminNav) firstAdminNav.classList.add('active');
        
        this.updateAdminStats();
    },

    hideAdminPanel() {
        const adminNavItems = document.querySelectorAll('.admin-nav-item');
        const adminSections = document.querySelectorAll('.admin-section');
        
        adminNavItems.forEach(item => item.style.display = 'none');
        adminSections.forEach(section => section.classList.remove('active'));
        
        const userNavIcons = document.querySelectorAll('.nav-icon:not(.admin-nav-item)');
        userNavIcons.forEach(icon => {
            icon.style.display = 'flex';
        });
        
        const minerSection = safeGetElement('miner-section');
        if (minerSection) minerSection.classList.add('active');
        
        const navIcons = document.querySelectorAll('.nav-icon');
        navIcons.forEach(icon => icon.classList.remove('active'));
        const minerNav = document.querySelector('[data-section="miner-section"]');
        if (minerNav) minerNav.classList.add('active');
    },

    updateAdminStats() {
        if (!window.userSystem) return;
        
        const totalUsers = Object.keys(window.userSystem.users).length;
        const totalCoins = Object.values(window.userSystem.userData).reduce((sum, data) => sum + (data.coinCount || 0), 0);
        const totalCash = Object.values(window.userSystem.userData).reduce((sum, data) => sum + (data.cashBalance || 0), 0);
        const activeUsers = Object.keys(window.userSystem.users).length;
        
        const vipUsers = Object.values(window.userSystem.userData).filter(data => {
            return data.vipStatus && data.vipStatus.isActive === true;
        }).length;
        
        const todayUsers = Object.values(window.userSystem.users).filter(user => {
            const regDate = new Date(user.registrationDate);
            const today = new Date();
            return regDate.toDateString() === today.toDateString();
        }).length;
        const referralCount = Object.values(window.userSystem.referrals).reduce((sum, ref) => sum + (ref.totalReferrals || 0), 0);
        const conversions = Object.values(window.userSystem.userData).filter(data => data.cashBalance > 0).length;

        safeSetText('adminTotalUsers', totalUsers.toLocaleString());
        safeSetText('adminTotalCoins', totalCoins.toLocaleString());
        safeSetText('adminTotalCash', totalCash.toLocaleString());
        safeSetText('adminActiveUsers', activeUsers.toLocaleString());
        safeSetText('adminVipUsers', vipUsers.toLocaleString());
        safeSetText('adminTodayUsers', todayUsers.toLocaleString());
        safeSetText('adminReferralCount', referralCount.toLocaleString());
        safeSetText('adminConversions', conversions.toLocaleString());

        minerSystem.updateAdminMinerStats();
    },

    loadUsersTable() {
        const tableBody = safeGetElement('adminUsersTableBody');
        if (!tableBody || !window.userSystem) return;
        
        const users = Object.values(window.userSystem.users);
        
        tableBody.innerHTML = users.map(user => {
            const userData = window.userSystem.userData[user.id] || window.userSystem.getDefaultUserData();
            const referralData = window.userSystem.referrals[user.id] || {
                level1: [],
                level2: [],
                earnings: 0,
                totalReferrals: 0
            };
            
            const isVip = userData.vipStatus && userData.vipStatus.isActive;
            const vipStatus = isVip ? userData.vipStatus.name : 'معمولی';
            const isActive = userData.lastSave > Date.now() - 24 * 60 * 60 * 1000;
            
            return `
                <tr data-user-id="${user.id}">
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 35px; height: 35px; border-radius: 50%; background: linear-gradient(135deg, var(--admin), var(--admin-light)); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.7rem;">
                                ${user.name.charAt(0)}
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 0.7rem;">${user.name}</div>
                            </div>
                        </div>
                    </td>
                    <td style="font-size: 0.65rem;">${user.email}</td>
                    <td style="font-weight: bold; color: var(--admin-text); font-size: 0.65rem;">${(userData.coinCount || 0).toLocaleString()}</td>
                    <td style="font-weight: bold; color: var(--admin-text); font-size: 0.65rem;">${(userData.cashBalance || 0).toLocaleString()}</td>
                    <td>
                        <div style="background: linear-gradient(135deg, var(--admin), var(--admin-light)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; font-size: 0.65rem;">
                            ${userData.currentLevel || '1'}
                        </div>
                    </td>
                    <td>
                        <span class="user-status ${isVip ? 'status-active' : 'status-inactive'}" style="font-size: 0.6rem;">
                            ${vipStatus}
                        </span>
                    </td>
                    <td style="font-weight: bold; color: var(--info); font-size: 0.65rem;">${referralData.level1.length}</td>
                    <td style="font-weight: bold; color: var(--info); font-size: 0.65rem;">${referralData.level2.length}</td>
                    <td>
                        <span class="user-status ${isActive ? 'status-active' : 'status-inactive'}">
                            ${isActive ? 'Active' : 'Disabled'}
                        </span>
                    </td>
                    <td>
                        <div style="display: flex; gap: 3px; justify-content: center;">
                            <button class="user-action-btn user-edit-btn" onclick="adminSystem.editUser('${user.email}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="user-action-btn user-delete-btn" onclick="adminSystem.deleteUser('${user.email}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    },

    editUser(email) {
        if (!window.userSystem) return;
        
        const user = window.userSystem.users[email];
        if (user) {
            safeSetValue('adminUserEmail', email);
            this.findUser();
            this.showAdminNotification(`📝 کاربر ${user.name} برای ویرایش انتخاب شد`, 'info');
        }
    },

    deleteUser(email) {
        if (!window.userSystem) return;
        
        if (confirm(`⚠️ آیا از حذف کاربر ${email} اطمینان دارید؟ این عمل غیرقابل بازگشت است!`)) {
            const user = window.userSystem.users[email];
            if (user) {
                delete window.userSystem.users[email];
                delete window.userSystem.userData[user.id];
                delete window.userSystem.referrals[user.id];
                
                this.loadUsersTable();
                this.updateAdminStats();
                this.showAdminNotification(`✅ کاربر ${email} با موفقیت حذف شد`, 'success');
            }
        }
    },

    findUser() {
        if (!window.userSystem) return;
        
        const email = safeGetValue('adminUserEmail');
        const user = window.userSystem.users[email];
        
        if (user) {
            const userData = window.userSystem.userData[user.id] || window.userSystem.getDefaultUserData();
            const referralData = window.userSystem.referrals[user.id] || {
                level1: [],
                level2: [],
                earnings: 0,
                totalReferrals: 0
            };
            
            safeSetValue('adminUserCoins', userData.coinCount || 0);
            safeSetValue('adminUserCash', userData.cashBalance || 0);
            safeSetValue('adminUserLevel', userData.currentLevel || 1);
            
            this.showAdminNotification(`✅ کاربر ${user.name} یافت شد`, 'success');
        } else {
            this.showAdminNotification('❌ کاربر یافت نشد', 'error');
        }
    },

    resetUser() {
        if (!window.userSystem) return;
        
        const email = safeGetValue('adminUserEmail');
        const user = window.userSystem.users[email];
        
        if (user) {
            window.userSystem.userData[user.id] = window.userSystem.getDefaultUserData();
            window.userSystem.referrals[user.id] = {
                level1: [],
                level2: [],
                earnings: 0,
                totalReferrals: 0
            };
            
            if (window.userSystem.currentUser && window.userSystem.currentUser.email === email) {
                window.userSystem.loadUserDataIntoGame();
            }
            
            safeSetValue('adminUserCoins', 0);
            safeSetValue('adminUserCash', 0);
            safeSetValue('adminUserLevel', 1);
            
            this.showAdminNotification(`✅ کاربر ${user.name} ریست شد`, 'success');
            this.updateAdminStats();
            this.loadUsersTable();
        } else {
            this.showAdminNotification('❌ کاربر یافت نشد', 'error');
        }
    },

    updateUser() {
        if (!window.userSystem) return;
        
        const email = safeGetValue('adminUserEmail');
        const user = window.userSystem.users[email];
        
        if (user) {
            const coins = parseInt(safeGetValue('adminUserCoins')) || 0;
            const cash = parseInt(safeGetValue('adminUserCash')) || 0;
            const level = parseInt(safeGetValue('adminUserLevel')) || 1;
            
            window.userSystem.userData[user.id] = {
                ...window.userSystem.userData[user.id],
                coinCount: coins,
                cashBalance: cash,
                currentLevel: level
            };
            
            if (window.userSystem.currentUser && window.userSystem.currentUser.email === email) {
                window.userSystem.loadUserDataIntoGame();
            }
            
            this.showAdminNotification(`✅ اطلاعات کاربر ${user.name} بروزرسانی شد`, 'success');
            this.updateAdminStats();
            this.loadUsersTable();
        } else {
            this.showAdminNotification('❌ کاربر یافت نشد', 'error');
        }
    },

    saveSettings() {
    this.settings.coinRate = parseInt(safeGetValue('adminCoinRate')) || 5;
    this.settings.dollarRate = parseInt(safeGetValue('adminDollarRate')) || 50000;
    this.settings.regularLimit = parseInt(safeGetValue('adminRegularLimit')) || 100000;
    this.settings.vipPrices[1] = parseInt(safeGetValue('adminVip1Price')) || 50000;
    this.settings.vipPrices[2] = parseInt(safeGetValue('adminVip2Price')) || 200000;
    this.settings.vipPrices[3] = parseInt(safeGetValue('adminVip3Price')) || 500000;
    
    this.settings.referralSettings.level1Percent = parseInt(safeGetValue('adminReferralLevel1Percent')) || 10;
    this.settings.referralSettings.level2Percent = parseInt(safeGetValue('adminReferralLevel2Percent')) || 5;
    this.settings.referralSettings.signupBonus = parseInt(safeGetValue('adminReferralSignupBonus')) || 50;
    
    // 🔥 فقط این ۴ خط رو داشته باش (بقیه رو حذف کن):
    const globalSettings = StorageManager.getItem('global_settings') || {};
    globalSettings.maxRegularLimit = this.settings.regularLimit;
    StorageManager.setItem('global_settings', globalSettings);
    
    this.saveSettingsToStorage();
    this.updateVipPrices();
    this.updateRateDisplays();
    
    const limitElement = document.getElementById('dailyLimitText');
    const remainingElement = document.getElementById('remainingText');
    
    if (limitElement) {
        limitElement.textContent = `${this.settings.regularLimit.toLocaleString()} سکه`;
    }
    
    if (remainingElement) {
        const globalSettings = StorageManager.getItem('global_settings') || {};
        const currentLimit = globalSettings.maxRegularLimit || 100000;
        const collected = window.vipSystem ? window.vipSystem.totalCollected : 0;
        const remaining = currentLimit - collected;
        remainingElement.textContent = `${Math.max(0, remaining).toLocaleString()} سکه باقیمانده`;
    }
    
    this.showAdminNotification('✅ تنظیمات سیستم ذخیره شد', 'success');
},

    updateRateDisplays() {
        const coinRate = parseInt(safeGetValue('adminCoinRate')) || this.settings.coinRate;
        const dollarRate = parseInt(safeGetValue('adminDollarRate')) || this.settings.dollarRate;
        
        const dollarPerCoin = (coinRate / dollarRate).toFixed(4);
        
        safeSetText('tomanRateDisplay', `هر ۱ سکه = ${coinRate.toLocaleString()} تومان`);
        safeSetText('dollarRateDisplay', `هر ۱ سکه = ${dollarPerCoin} دلار`);
        
        if (safeGetElement('conversion-section')) {
            updateConversionAmount();
        }
    },

    loadSettings() {
    const saved = StorageManager.getItem('admin_settings');
    if (saved) {
        this.settings = { ...this.settings, ...saved };
    }
    
    safeSetValue('adminCoinRate', this.settings.coinRate);
    safeSetValue('adminDollarRate', this.settings.dollarRate);
    safeSetValue('adminRegularLimit', this.settings.regularLimit);
    safeSetValue('adminVip1Price', this.settings.vipPrices[1]);
    safeSetValue('adminVip2Price', this.settings.vipPrices[2]);
    safeSetValue('adminVip3Price', this.settings.vipPrices[3]);
    
    safeSetValue('adminReferralLevel1Percent', this.settings.referralSettings.level1Percent);
    safeSetValue('adminReferralLevel2Percent', this.settings.referralSettings.level2Percent);
    safeSetValue('adminReferralSignupBonus', this.settings.referralSettings.signupBonus);
    safeSetValue('adminVip1ResetHours', window.vipSystem.settings.vip1ResetHours);
    safeSetValue('adminVip2ResetHours', window.vipSystem.settings.vip2ResetHours);
    
    // 🔥 فقط این ۱ خط رو اینجا اضافه کن:
    if (window.vipSystem) window.vipSystem.maxRegularLimit = this.settings.regularLimit;
    
    const savedRate = localStorage.getItem('coin_to_crypto_rate');
    if (savedRate) {
        safeSetValue('adminCoinToCryptoRate', savedRate);
    } else {
        safeSetValue('adminCoinToCryptoRate', '0.0001'); // مقدار پیش فرض
    }
    this.updateVipPrices();
    this.updateRateDisplays();
},

    saveSettingsToStorage() {
        StorageManager.setItem('admin_settings', this.settings);
    },
    
    // این تابع جدید رو به سیستم مدیریت اضافه کن
saveVipTimerSettings() {
    const vip1Hours = parseInt(safeGetValue('adminVip1ResetHours')) || 20;
    const vip2Hours = parseInt(safeGetValue('adminVip2ResetHours')) || 20;
    
    if (window.vipSystem) {
        window.vipSystem.settings.vip1ResetHours = vip1Hours;
        window.vipSystem.settings.vip2ResetHours = vip2Hours;
        window.vipSystem.saveSettings();
        
        // آپدیت تایمر برای کاربران فعال
        if (window.vipSystem.currentVip) {
            window.vipSystem.nextResetDate = null;
            window.vipSystem.updateResetTimerDisplay();
        }
        
        this.showAdminNotification(`✅ تنظیمات تایمر VIP ذخیره شد (نقره‌ای: ${vip1Hours}h, طلایی: ${vip2Hours}h)`, 'success');
    }
},
// مدیریت توکنومیکس
loadTokenomicsData() {
    if (!window.tokenomicsSystem) {
        this.showAdminNotification('❌ سیستم توکنومیکس یافت نشد', 'error');
        return;
    }

    safeSetValue('adminTotalSupply', window.tokenomicsSystem.totalSupply);
    safeSetValue('adminMinedCoins', window.tokenomicsSystem.minedCoins);
    
    // بارگذاری متن‌های نمایشی
    const titleElement = document.querySelector('.tokenomics-header h3');
    const descElement = document.querySelector('.tokenomics-header p');
    
    if (titleElement) {
        safeSetValue('adminTokenomicsTitle', titleElement.textContent.replace('⛏️', '').trim());
    }
    
    if (descElement) {
        safeSetValue('adminTokenomicsDescription', descElement.textContent);
    }
    
    this.showAdminNotification('✅ داده‌های توکنومیکس بارگذاری شد', 'success');
},

saveTokenomicsData() {
    if (!window.tokenomicsSystem) {
        this.showAdminNotification('❌ سیستم توکنومیکس یافت نشد', 'error');
        return;
    }

    const totalSupply = parseInt(safeGetValue('adminTotalSupply')) || 30000000000;
    const minedCoins = parseInt(safeGetValue('adminMinedCoins')) || 0;
    const title = safeGetValue('adminTokenomicsTitle') || 'Gold Coin - Phase 1';
    const description = safeGetValue('adminTokenomicsDescription') || 'Phase 1 supply of Gold Coin: 30 billion coins';

    // اعتبارسنجی
    if (minedCoins > totalSupply) {
        this.showAdminNotification('❌ Mined coins cannot exceed total supply', 'error');
        return;
    }

    // اعمال تغییرات
    window.tokenomicsSystem.totalSupply = totalSupply;
    window.tokenomicsSystem.minedCoins = minedCoins;

    // آپدیت متن‌های نمایشی
    const titleElement = document.querySelector('.tokenomics-header h3');
    const descElement = document.querySelector('.tokenomics-header p');
    
    if (titleElement) {
        titleElement.innerHTML = `<i class="fas fa-chart-pie"></i> ${title}`;
    }
    
    if (descElement) {
        descElement.textContent = description;
    }

    // ذخیره‌سازی
    window.tokenomicsSystem.saveToStorage();
    window.tokenomicsSystem.updateDisplay();

    this.showAdminNotification('✅ تغییرات توکنومیکس ذخیره شد', 'success');
},

resetTokenomicsData() {
    if (confirm('⚠️ آیا از ریست کامل توکنومیکس اطمینان دارید؟\nهمه داده‌ها به حالت اولیه بازمی‌گردند!')) {
        if (window.tokenomicsSystem) {
            window.tokenomicsSystem.totalSupply = 30000000000;
            window.tokenomicsSystem.minedCoins = 0;
            window.tokenomicsSystem.networkHistory = [];
            
            // بازگرداندن متن‌های پیش‌فرض
            const titleElement = document.querySelector('.tokenomics-header h3');
            const descElement = document.querySelector('.tokenomics-header p');
            
            if (titleElement) {
                titleElement.innerHTML = '<i class="fas fa-chart-pie"></i> Gold Coin - Phase 1';
            }
            
            if (descElement) {
                descElement.textContent = 'Phase 1 supply of Gold Coin: 30 billion coins';
            }

            // آپدیت فرم
            safeSetValue('adminTotalSupply', 30000000000);
            safeSetValue('adminMinedCoins', 0);
            safeSetValue('adminTokenomicsTitle', 'Gold Coin - Phase 1');
            safeSetValue('adminTokenomicsDescription', 'Phase 1 supply of Gold Coin: 30 billion coins');

            window.tokenomicsSystem.saveToStorage();
            window.tokenomicsSystem.updateDisplay();

            this.showAdminNotification('✅ توکنومیکس با موفقیت ریست شد', 'success');
        }
    }
},

clearTokenomicsHistory() {
    if (confirm('⚠️ آیا از پاک کردن تاریخچه استخراج اطمینان دارید؟')) {
        if (window.tokenomicsSystem) {
            window.tokenomicsSystem.networkHistory = [];
            window.tokenomicsSystem.saveToStorage();
            window.tokenomicsSystem.updateDisplay();
            this.showAdminNotification('✅ تاریخچه استخراج پاک شد', 'success');
        }
    }
},

    updateVipPrices() {
        if (!window.vipSystem) return;
        
        window.vipSystem.levels[0].price = this.settings.vipPrices[1];
        window.vipSystem.levels[1].price = this.settings.vipPrices[2];
        window.vipSystem.levels[2].price = this.settings.vipPrices[3];
        
        if (safeGetElement('vip-section')?.classList.contains('active')) {
            generateVipPlans();
        }
    },

    addCoinsToAll() {
        if (!window.userSystem) return;
        
        const amount = parseInt(safeGetValue('adminBonusCoins')) || 1000;
        Object.keys(window.userSystem.userData).forEach(userId => {
            window.userSystem.userData[userId].coinCount += amount;
        });
        
        if (window.userSystem.currentUser) {
            window.userSystem.loadUserDataIntoGame();
        }
        
        this.showAdminNotification(`✅ ${amount.toLocaleString()} سکه به همه کاربران اضافه شد`, 'success');
        this.updateAdminStats();
        this.loadUsersTable();
    },

    addDailyBonus() {
        if (!window.userSystem) return;
        
        const amount = 500;
        Object.keys(window.userSystem.userData).forEach(userId => {
            window.userSystem.userData[userId].coinCount += amount;
        });
        
        if (window.userSystem.currentUser) {
            window.userSystem.loadUserDataIntoGame();
        }
        
        this.showAdminNotification(`✅ پاداش روزانه ${amount} سکه به همه کاربران اضافه شد`, 'success');
        this.updateAdminStats();
        this.loadUsersTable();
    },

    resetAllUsers() {
    if (confirm('⚠️ آیا از پاک کردن کامل تمام داده‌های سایت اطمینان دارید؟')) {
        try {
            // لیست تمام key هایی که باید پاک شوند
            const keysToRemove = [
                'users',
                'userData', 
                'referrals',
                'currentUser',
                'usdt_payment_requests',
                'gameState',
                'levelData',
                'vip_data',
                'miner_data'
            ];
            
            // پاک کردن از localStorage
            keysToRemove.forEach(key => {
                localStorage.removeItem(key);
            });
            
            // پاک کردن keyهای پویا
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (
                    key.startsWith('user_') || 
                    key.startsWith('miner_') || 
                    key.startsWith('vip_data_') ||
                    key.includes('usdt') ||
                    key.includes('payment') ||
                    key.includes('request')
                )) {
                    localStorage.removeItem(key);
                }
            }
            
            // ریست کامل تمام سیستم‌ها
            if (window.userSystem) {
                window.userSystem.users = {};
                window.userSystem.userData = {};
                window.userSystem.referrals = {};
                window.userSystem.currentUser = null;
            }
            
            if (window.minerSystem) {
                window.minerSystem.userMiners = {};
            }
            
            if (window.vipSystem) {
                window.vipSystem.currentVip = null;
                window.vipSystem.totalCollected = 0;
                window.vipSystem.dailyCollected = 0;
            }
            
            if (window.gameState) {
                window.gameState.coinCount = 0;
                window.gameState.cashBalance = 0;
                window.gameState.liveEarnings = 0;
            }
            
            if (window.levelSystem) {
                window.levelSystem.currentLevel = 1;
                window.levelSystem.currentXP = 0;
                window.levelSystem.coinsCollected = 0;
                window.levelSystem.purchasedLevels = new Set([1, 2]);
            }
            
            // ریست درخواست‌های USDT
            if (window.usdtAdminSystem) {
                localStorage.removeItem('usdt_payment_requests');
            }
            
            // ریست ارزهای دیجیتال
            if (window.cryptoRateSystem) {
                window.cryptoRateSystem.userBalances = {};
                // فقط user balances رو پاک کن، نه نرخ‌ها
                const cryptoData = localStorage.getItem('crypto_system_data');
                if (cryptoData) {
                    const data = JSON.parse(cryptoData);
                    data.userBalances = {};
                    localStorage.setItem('crypto_system_data', JSON.stringify(data));
                }
            }
            
            this.showAdminNotification('✅ تمام داده‌های سایت پاک شدند', 'success');
            
            // رفرش صفحه
            setTimeout(() => {
                location.reload();
            }, 1500);
            
        } catch (error) {
            console.error('Error:', error);
            this.showAdminNotification('❌ خطا در پاک کردن داده‌ها', 'error');
        }
    }
},

    exportData() {
        if (!window.userSystem) return;
        
        const data = {
            users: window.userSystem.users,
            userData: window.userSystem.userData,
            referrals: window.userSystem.referrals,
            adminSettings: this.settings,
            minerSettings: minerSystem.settings,
            userMiners: minerSystem.userMiners,
            exportDate: new Date().toISOString()
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `goldcoin_export_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        this.showAdminNotification('✅ داده‌ها با موفقیت export شدند', 'success');
    },

    importData() {
        if (!window.userSystem) return;
        
        const fileInput = safeGetElement('adminImportFile');
        const file = fileInput.files[0];
        
        if (!file) {
            this.showAdminNotification('❌ لطفاً یک فایل انتخاب کنید', 'error');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const data = JSON.parse(e.target.result);
                
                if (data.users) window.userSystem.users = data.users;
                if (data.userData) window.userSystem.userData = data.userData;
                if (data.referrals) window.userSystem.referrals = data.referrals;
                if (data.adminSettings) {
                    this.settings = { ...this.settings, ...data.adminSettings };
                    this.loadSettings();
                }
                if (data.minerSettings) {
                    minerSystem.settings = { ...minerSystem.settings, ...data.minerSettings };
                    minerSystem.loadSettings();
                }
                if (data.userMiners) {
                    minerSystem.userMiners = { ...minerSystem.userMiners, ...data.userMiners };
                }
                
                if (window.userSystem.currentUser) {
                    window.userSystem.loadUserDataIntoGame();
                }
                
                this.updateAdminStats();
                this.loadUsersTable();
                minerSystem.updateMinerDisplay();
                this.showAdminNotification('✅ داده‌ها با موفقیت وارد شدند', 'success');
            } catch (error) {
                this.showAdminNotification('❌ خطا در خواندن فایل', 'error');
            }
        };
        reader.readAsText(file);
    },

    showAdminNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `admin-notification ${type}`;
        notification.innerHTML = `
            <div class="admin-notification-content">
                <div class="admin-notification-icon">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                </div>
                <div style="color: var(--light); font-size: 0.95rem; font-weight: 500;">${message}</div>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => notification.classList.add('show'), 100);
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) notification.remove();
            }, 300);
        }, 3000);
    }
};

// ==================== سیستم سطح‌بندی ====================
const levelSystem = {
    levels: [
        { level: 1, name: "Beginner", xpRequired: 0, coinBonus: 0, price: 0, type: "free" },
        { level: 2, name: "Collector", xpRequired: 50, coinBonus: 20, price: 0, type: "free" },
        { level: 3, name: "Professional", xpRequired: 0, coinBonus: 40, price: 500, type: "premium" },
        { level: 4, name: "Master", xpRequired: 0, coinBonus: 70, price: 1000, type: "premium" },
        { level: 5, name: "Legend", xpRequired: 0, coinBonus: 100, price: 2000, type: "premium" },
        { level: 6, name: "Gold King", xpRequired: 0, coinBonus: 140, price: 3500, type: "premium" },
        { level: 7, name: "Emperor", xpRequired: 0, coinBonus: 190, price: 5000, type: "premium" },
        { level: 8, name: "Myth", xpRequired: 0, coinBonus: 250, price: 7500, type: "premium" },
        { level: 9, name: "Deity", xpRequired: 0, coinBonus: 320, price: 10000, type: "premium" },
        { level: 10, name: "Ultimate Legend", xpRequired: 0, coinBonus: 400, price: 15000, type: "premium" }
    ],
    currentLevel: 1,
    currentXP: 0,
    coinsCollected: 0,
    xpPerCoin: 1,
    purchasedLevels: new Set([1, 2])
};

// ==================== سیستم VIP با تایمر ریست ====================
const vipSystem = {
    levels: [
        {
            id: 1,
            name: "Silver VIP",
            price: 50000,
            dailyLimit: 100000,
            duration: 20,
            features: [
                "💎 Mining up to 100,000 coins in 20 hours",
                "🚀 20% more coin rewards",
                "🎁 Daily gift of 500 coins",
                "⏰ Auto reset every 20 hours"
            ],
            color: "linear-gradient(135deg, #bdc3c7, #95a5a6)",
            icon: "fas fa-crown"
        },
        {
            id: 2,
            name: "Gold VIP", 
            price: 200000,
            dailyLimit: 500000,
            duration: 20,
            features: [
                "💎 Mining up to 500,000 coins in 20 hours", 
                "🚀 30% more coin rewards",
                "🎁 Daily gift of 1,000 coins",
                "⚡ Free daily multiplier",
                "⏰ Auto reset every 20 hours"
            ],
            color: "linear-gradient(135deg, #ffd700, #ff6b00)",
            icon: "fas fa-gem"
        },
        {
            id: 3,
            name: "Diamond VIP",
            price: 500000,
            dailyLimit: -1,
            duration: -1,
            features: [
                "💎 Completely unlimited mining",
                "🚀 50% more coin rewards",
                "🎁 Daily gift of 2,000 coins", 
                "⚡ All boosters free",
                "👑 Special profile design"
            ],
            color: "linear-gradient(135deg, #00ff88, #00b3ff)",
            icon: "fas fa-diamond"
        }
    ],
    currentVip: null,
    expiryDate: null,
    totalCollected: 0,
    dailyCollected: 0,
    maxRegularLimit: 100000,
    get maxRegularLimit() {
        const adminSettings = StorageManager.getItem('admin_settings');
        return (adminSettings && adminSettings.regularLimit) || 100000;
    },
    
    // 🔥 این setter رو اضافه کن:
    set maxRegularLimit(value) {
        // فقط مقدار رو در admin_settings ذخیره کن
        const adminSettings = StorageManager.getItem('admin_settings') || {};
        adminSettings.regularLimit = value;
        StorageManager.setItem('admin_settings', adminSettings);
    },
    lastResetDate: Date.now(),
    nextResetDate: null,
    resetTimer: null,

    // تنظیمات از پنل مدیریت
    settings: {
        vip1ResetHours: 20,
        vip2ResetHours: 20
    },

    init() {
        this.loadSettings();
        this.loadVipData();
        this.startResetTimer();
        this.updateResetTimerDisplay();
    },

    // تایمر ریست
    startResetTimer() {
        if (this.resetTimer) {
            clearInterval(this.resetTimer);
        }

        this.resetTimer = setInterval(() => {
            this.checkAndResetLimit();
            this.updateResetTimerDisplay();
        }, 1000); // هر ثانیه آپدیت کن
    },

    // بررسی و ریست محدودیت
    checkAndResetLimit() {
        if (!this.currentVip || this.currentVip.id === 3) return;

        const now = Date.now();
        const resetHours = this.currentVip.id === 1 ? this.settings.vip1ResetHours : this.settings.vip2ResetHours;
        
        if (!this.nextResetDate) {
            this.nextResetDate = this.lastResetDate + (resetHours * 60 * 60 * 1000);
        }

        if (now >= this.nextResetDate) {
            this.performReset();
        }
    },

    // انجام ریست
performReset() {
    console.log('🔄 ریست محدودیت VIP انجام شد');
    
    this.dailyCollected = 0;
    this.lastResetDate = Date.now();
    
    const resetHours = this.currentVip.id === 1 ? this.settings.vip1ResetHours : this.settings.vip2ResetHours;
    this.nextResetDate = this.lastResetDate + (resetHours * 60 * 60 * 1000);
    
    this.saveVipData();
    this.updateResetTimerDisplay();
    this.updateLimitDisplay(); // این خط رو اضافه کن
    
    showNotification('🔄 محدودیت شما ریست شد! اکنون می‌توانید مجدداً استخراج کنید.', 'success');
},

    // آپدیت نمایش تایمر
    // آپدیت نمایش تایمر
updateResetTimerDisplay() {
    const timerElement = document.getElementById('vipResetTimer');
    if (!timerElement) {
        console.log('❌ المان تایمر پیدا نشد!');
        return;
    }

    if (!this.currentVip || this.currentVip.id === 3) {
        timerElement.style.display = 'none';
        return;
    }

    if (!this.nextResetDate) {
        const resetHours = this.currentVip.id === 1 ? this.settings.vip1ResetHours : this.settings.vip2ResetHours;
        this.nextResetDate = this.lastResetDate + (resetHours * 60 * 60 * 1000);
    }

    const now = Date.now();
    const timeLeft = this.nextResetDate - now;

    if (timeLeft <= 0) {
        timerElement.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px; color: var(--success);">
                <i class="fas fa-sync-alt fa-spin"></i>
                <span>در حال ریست...</span>
            </div>
            <div style="color: var(--gray); font-size: 0.8rem; margin-top: 5px; text-align: center;">
                محدودیت در حال ریست شدن است
            </div>
        `;
        timerElement.style.display = 'block';
        this.performReset();
        return;
    }

    const hours = Math.floor(timeLeft / (1000 * 60 * 60));
    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

    timerElement.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; gap: 10px; color: var(--primary);">
            <i class="fas fa-clock"></i>
            <span>Next reset ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}</span>
        </div>
        <div style="color: var(--gray); font-size: 0.8rem; margin-top: 5px; text-align: center;">
            ⏰ Limit resets every 20 hours
        </div>
    `;
    timerElement.style.display = 'block';
},

    // خرید VIP
    purchaseVip(planId) {
        if (!window.userSystem || !window.userSystem.currentUser) {
            showNotification('Please log in to your account first', 'error');
            return false;
        }
        
        const plan = this.levels.find(p => p.id === planId);
        if (!plan) {
            showNotification('پلن مورد نظر یافت نشد!', 'error');
            return false;
        }
        
        if (window.gameState.cashBalance < plan.price) {
            showNotification(`موجودی نقدی کافی نیست! برای خرید این پلن ${plan.price.toLocaleString()} تومان نیاز دارید.`, 'error');
            return false;
        }
        
        window.gameState.cashBalance -= plan.price;
        this.currentVip = {
            ...plan,
            userId: window.userSystem.currentUser.id,
            isActive: true,
            purchaseDate: new Date().toISOString()
        };
        
        // ریست محدودیت هنگام خرید VIP
        this.dailyCollected = 0;
        this.lastResetDate = Date.now();
        this.nextResetDate = null;
        
        // ذخیره در اطلاعات کاربر
        window.userSystem.userData[window.userSystem.currentUser.id].vipStatus = this.currentVip;
        
        showNotification(`🎉 plan ${plan.name} activated successfully`, 'success');
        
        // نمایش مودال فعال شدن VIP
        if (safeGetElement('vipModalTitle') && safeGetElement('vipModalMessage')) {
            safeSetText('vipModalTitle', `Congratulations ${plan.name} severely`);
            safeSetText('vipModalMessage', `You now have access to premium features ${plan.name} have access to`);
            const modal = safeGetElement('vipActivatedModal');
            if (modal) modal.style.display = 'flex';
        }
        
        this.updateResetTimerDisplay();
        updateAllDisplays();
        generateVipPlans();
        this.saveVipData();
        
        return true;
    },

    // ذخیره داده‌های VIP
    saveVipData() {
        if (!window.userSystem || !window.userSystem.currentUser) return;
        
        const vipData = {
            currentVip: this.currentVip,
            expiryDate: this.expiryDate,
            totalCollected: this.totalCollected,
            dailyCollected: this.dailyCollected,
            lastResetDate: this.lastResetDate,
            nextResetDate: this.nextResetDate,
            maxRegularLimit: this.maxRegularLimit,
            maxRegularLimit: this.maxRegularLimit,
            settings: this.settings
        };
        
        StorageManager.setItem(`vip_data_${window.userSystem.currentUser.id}`, vipData);
    },

    // بارگذاری داده‌های VIP
    loadVipData() {
    if (!window.userSystem || !window.userSystem.currentUser) return;
    
    const data = StorageManager.getItem(`vip_data_${window.userSystem.currentUser.id}`);
    
    // 🔥 اول از global_settings چک کن
    const globalSettings = StorageManager.getItem('global_settings');
    if (globalSettings && globalSettings.maxRegularLimit) {
        this.maxRegularLimit = globalSettings.maxRegularLimit;
    } else {
        // اگر global_settings نبود، از admin_settings چک کن
        const adminSettings = StorageManager.getItem('admin_settings');
        if (adminSettings && adminSettings.regularLimit) {
            this.maxRegularLimit = adminSettings.regularLimit;
        } else {
            this.maxRegularLimit = 100000;
        }
    }
    
    if (data) {
        this.currentVip = data.currentVip;
        this.expiryDate = data.expiryDate ? new Date(data.expiryDate) : null;
        this.totalCollected = data.totalCollected || 0;
        this.dailyCollected = data.dailyCollected || 0;
        this.lastResetDate = data.lastResetDate || Date.now();
        this.nextResetDate = data.nextResetDate || null;
        this.settings = data.settings || this.settings;
        
        // 🔥 maxRegularLimit رو از data نگیر، از global_settings بگیر
        // this.maxRegularLimit از بالا ست شده
    }
},

    // بارگذاری تنظیمات از پنل مدیریت
    loadSettings() {
        const saved = StorageManager.getItem('vip_timer_settings');
        if (saved) {
            this.settings = { ...this.settings, ...saved };
        }
    },

    // ذخیره تنظیمات
    saveSettings() {
        StorageManager.setItem('vip_timer_settings', this.settings);
    },

    // آپدیت نمایش محدودیت
    updateLimitDisplay() {
        let userLimit, collected, limitType;
        
        if (!this.currentVip) {
            userLimit = this.maxRegularLimit;
            collected = this.totalCollected;
            limitType = 'کل';
            if (safeGetElement('limitTitle')) {
                safeSetText('limitTitle', 'Total Coin Limit:');
            }
        } else {
            userLimit = this.currentVip.dailyLimit;
            collected = this.dailyCollected;
            limitType = `${this.currentVip.duration} ساعته`;
            if (safeGetElement('limitTitle')) {
                safeSetText('limitTitle', `محدودیت سکه (${this.currentVip.duration} ساعته):`);
            }
        }
        
        const progress = userLimit === -1 ? 0 : (collected / userLimit) * 100;
        
        const progressBar = safeGetElement('limitProgress');
        if (progressBar) {
            progressBar.style.width = `${Math.min(progress, 100)}%`;
        }
        
        if (safeGetElement('collectedText')) {
            safeSetText('collectedText', `${collected.toLocaleString()} Coins Collected`);
        }
        
        if (safeGetElement('dailyLimitText')) {
            if (userLimit === -1) {
                safeSetText('dailyLimitText', 'نامحدود');
            } else {
                safeSetText('dailyLimitText', `${userLimit.toLocaleString()} سکه`);
            }
        }
        
        if (safeGetElement('remainingText')) {
            if (userLimit === -1) {
                safeSetText('remainingText', 'استخراج نامحدود');
            } else {
                safeSetText('remainingText', `${Math.max(0, userLimit - collected).toLocaleString()} سکه باقیمانده`);
            }
        }
    }
};

// ==================== سیستم کاربران ====================
class UserSystem {
    constructor() {
        this.currentUser = null;
        this.users = {};
        this.userData = {};
        this.referrals = {};
    }

    generateReferralId() {
        return Math.floor(100000 + Math.random() * 900000).toString();
    }

    generateUserId() {
        return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    register(name, email, password, referralCode = null) {
    // اعتبارسنجی ایمیل
    if (!email || email.trim() === '') {
        throw new Error('Email is required');
    }
    
    if (this.users[email]) {
        throw new Error('This email is already registered');
    }

        const userId = this.generateUserId();
        const referralId = this.generateReferralId();
        
        this.users[email] = {
            id: userId,
            name: name,
            email: email,
            password: password,
            referralId: referralId,
            registrationDate: new Date().toISOString()
        };

        this.userData[userId] = {
            userId: userId,
            coinCount: 0,
            cashBalance: 0,
            currentLevel: 1,
            currentXP: 0,
            coinsCollected: 0,
            purchasedLevels: [1, 2],
            vipStatus: null,
            lastSave: Date.now()
        };
        
        this.referrals[userId] = {
            referralId: referralId,
            level1: [],
            level2: [],
            earnings: 0,
            totalReferrals: 0
        };
        
        if (referralCode && referralCode.trim() !== '') {
            this.processReferral(referralCode, userId);
        }
        
        return this.users[email];
    }
    
  
giveSignupBonus() {
    if (!this.currentUser) return;
    
    const bonusAmount = 10000;
    window.gameState.coinCount += bonusAmount;
    
    // ذخیره اطلاعات
    this.saveUserData(window.gameState, window.levelSystem);
    
    // 🔥 اینجا درستش کن:
    setTimeout(() => {
        if (typeof showSignupBonusNotification === 'function') {
            showSignupBonusNotification();
        } else {
            // اگر تابع پیدا نشد، پیام ساده نمایش بده
            showNotification('🎉 جایزه ثبت‌نام: ۱۰,۰۰۰ سکه دریافت کردید!', 'success');
        }
    }, 1000);
    
    updateAllDisplays();
}
    login(email, password) {
    if (!email || email.trim() === '') {
        throw new Error('Email is required');
    }
    
    const user = this.users[email];
    if (!user || user.password !== password) {
        throw new Error('Invalid email or password');
    }

        this.currentUser = user;
        this.loadUserDataIntoGame();
        if (!user.hasReceivedSignupBonus) {
        this.giveSignupBonus();
        user.hasReceivedSignupBonus = true;
    }
        return user;
    }

    logout() {
        this.currentUser = null;
        this.resetGameState();
    }

    // در UserSystem
loadUserDataIntoGame() {
    if (!this.currentUser) {
        // اگر کاربری لاگین نیست، state رو ریست کن
        this.resetGameState();
        return;
    }
    
    const userData = this.loadUserData();
    if (userData) {
        window.gameState.coinCount = userData.coinCount || 0;
        window.gameState.cashBalance = userData.cashBalance || 0;
        window.levelSystem.currentLevel = userData.currentLevel || 1;
        window.levelSystem.currentXP = userData.currentXP || 0;
        window.levelSystem.coinsCollected = userData.coinsCollected || 0;
        window.levelSystem.purchasedLevels = new Set(userData.purchasedLevels || [1, 2]);
        
        if (userData.vipStatus) {
            window.vipSystem.currentVip = userData.vipStatus;
        }
        
        // 🔥 **لود کردن اطلاعات ارزهای دیجیتال برای کاربر جاری**
        if (window.cryptoRateSystem) {
            window.cryptoRateSystem.loadFromStorage();
        }
        
        if (window.loadVipData) loadVipData();
        if (window.updateAllDisplays) updateAllDisplays();
        if (window.minerSystem) minerSystem.updateMinerDisplay();
    }
}

  
resetGameState() {
    if (!window.gameState) return;
    
    // ریست کردن تمام stateهای بازی
    window.gameState.coinCount = 0;
    window.gameState.cashBalance = 0;
    window.gameState.coinMultiplier = 1;
    window.gameState.autoClicker = false;
    window.gameState.liveEarnings = 0;
    
    window.levelSystem.currentLevel = 1;
    window.levelSystem.currentXP = 0;
    window.levelSystem.coinsCollected = 0;
    window.levelSystem.purchasedLevels = new Set([1, 2]);
    
    window.vipSystem.currentVip = null;
    window.vipSystem.totalCollected = 0;
    window.vipSystem.dailyCollected = 0;
    
if (window.cryptoRateSystem) {
        window.cryptoRateSystem.clearCurrentUserBalances();
    }
    
    this.clearAllCoins();
    if (window.gameState.activeTimers) {
        window.gameState.activeTimers.forEach(timer => clearInterval(timer));
        window.gameState.activeTimers.clear();
    }
    
    // ریست کردن نمایش‌ها
    const multiplierTimer = safeGetElement('multiplierTimer');
    const autoClickerStatus = document.querySelector('#autoClicker .booster-status');
    
    if (multiplierTimer) multiplierTimer.style.display = 'none';
    if (autoClickerStatus) {
        autoClickerStatus.textContent = 'خاموش';
        autoClickerStatus.style.color = 'var(--gray)';
    }
    
    const multiplierBooster = safeGetElement('multiplierBooster');
    const autoClickerBooster = safeGetElement('autoClicker');
    
    if (multiplierBooster) multiplierBooster.classList.remove('active');
    if (autoClickerBooster) autoClickerBooster.classList.remove('active');
    
    if (window.updateAllDisplays) updateAllDisplays();
    if (window.minerSystem) minerSystem.updateMinerDisplay();
}

    clearAllCoins() {
        if (!window.gameState) return;
        
        window.gameState.coins.forEach(coin => {
            if (coin.parentNode) coin.remove();
        });
        window.gameState.coins.clear();
    }

    processReferral(referralCode, newUserId) {
        const referrer = Object.values(this.users).find(user => 
            user.referralId === referralCode
        );
        
        if (referrer) {
            const referrerId = referrer.id;
            
            if (!this.referrals[referrerId].level1.includes(newUserId)) {
                this.referrals[referrerId].level1.push(newUserId);
                this.referrals[referrerId].totalReferrals++;
                this.addReferralEarnings(referrerId, window.adminSystem ? window.adminSystem.settings.referralSettings.signupBonus : 50);
                
                const level2Referrer = Object.values(this.users).find(user => 
                    this.referrals[user.id]?.level1.includes(referrerId)
                );
                
                if (level2Referrer && level2Referrer.id !== referrerId) {
                    if (!this.referrals[level2Referrer.id].level2.includes(newUserId)) {
                        this.referrals[level2Referrer.id].level2.push(newUserId);
                        this.referrals[level2Referrer.id].totalReferrals++;
                        this.addReferralEarnings(level2Referrer.id, Math.floor((window.adminSystem ? window.adminSystem.settings.referralSettings.signupBonus : 50) / 2));
                    }
                }
            }
        }
    }

    addReferralEarnings(userId, amount) {
        if (this.referrals[userId]) {
            this.referrals[userId].earnings += amount;
            if (this.userData[userId]) {
                this.userData[userId].coinCount += amount;
            }
        }
    }

    addReferralActivityEarnings(referrerId, coinsEarnedByReferral) {
        if (!referrerId || !this.referrals[referrerId]) return;
        
        const commission = Math.floor(coinsEarnedByReferral * ((window.adminSystem ? window.adminSystem.settings.referralSettings.level1Percent : 10) / 100));
        
        if (commission > 0) {
            this.referrals[referrerId].earnings += commission;
            
            if (this.userData[referrerId]) {
                this.userData[referrerId].coinCount += commission;
                
                if (this.currentUser && this.currentUser.id === referrerId) {
    showNotification(
        `You received ${commission} coins from your referral's activity!`,
        'success'
    );
}
            }
        }
    }

    findReferrer(userId) {
        for (const [referrerId, referralData] of Object.entries(this.referrals)) {
            if (referralData.level1.includes(userId)) {
                return referrerId;
            }
        }
        return null;
    }

    getDefaultUserData() {
        return {
            coinCount: 0,
            cashBalance: 0,
            currentLevel: 1,
            currentXP: 0,
            coinsCollected: 0,
            purchasedLevels: [1, 2],
            vipStatus: null,
            lastSave: Date.now()
        };
    }

    saveUserData(gameState, levelSystem) {
        if (!this.currentUser) return;

        this.userData[this.currentUser.id] = {
            userId: this.currentUser.id,
            coinCount: gameState.coinCount,
            cashBalance: gameState.cashBalance,
            currentLevel: levelSystem.currentLevel,
            currentXP: levelSystem.currentXP,
            coinsCollected: levelSystem.coinsCollected,
            purchasedLevels: Array.from(levelSystem.purchasedLevels),
            vipStatus: window.vipSystem.currentVip,
            lastSave: Date.now()
        };
    }

    loadUserData() {
        if (!this.currentUser) return null;
        return this.userData[this.currentUser.id] || this.getDefaultUserData();
    }

    getUserReferralStats() {
        if (!this.currentUser) return null;
        
        const userId = this.currentUser.id;
        const userReferrals = this.referrals[userId] || {
            level1: [],
            level2: [],
            earnings: 0,
            totalReferrals: 0
        };
        
        return {
            referralCount: userReferrals.totalReferrals,
            referralEarnings: userReferrals.earnings,
            level1Count: userReferrals.level1.length,
            level2Count: userReferrals.level2.length,
            referralLink: `${window.location.origin}${window.location.pathname}?ref=${this.currentUser.referralId}`
        };
    }
}

// ==================== سیستم اصلی بازی ====================
const userSystem = new UserSystem();

const gameState = {
    coinCount: 0,
    cashBalance: 0,
    coinMultiplier: 1,
    autoClicker: false,
    coins: new Set(),
    maxCoins: 6,
    activeTimers: new Map(),
    liveEarnings: 0,
    autoClickInterval: null
};

// ==================== سیستم توکنومیکس با اصلاحات کامل ====================
const tokenomicsSystem = {
    totalSupply: 30000000000,
    minedCoins: 0,
    networkHistory: [],
    isMinerDisabled: false,
    eventBlockingEnabled: false,

    init() {
        this.loadFromStorage();
        this.updateDisplay();
        this.startRealTimeUpdates();
        this.loadTextsFromStorage();
        this.setupMinerListener();
        this.setupGlobalEventBlocking();
    },

    setupGlobalEventBlocking() {
        if (this.eventBlockingEnabled) return;
        
        document.addEventListener('click', (e) => {
            if (this.isMinerDisabled) {
                const minerElements = [
                    '#minerDiamondLogo',
                    '#startMinerBtn', 
                    '#harvestMinerBtn',
                    '#coinsCard',
                    '#timeCard',
                    '.miner-stat-card-modern',
                    '.miner-controls',
                    '.miner-progress-modern'
                ];
                
                const isMinerElement = minerElements.some(selector => {
                    const element = e.target.closest(selector);
                    return element && element.offsetParent !== null;
                });
                
                if (isMinerElement) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    
                    const target = e.target.closest('#minerDiamondLogo') || 
                                  e.target.closest('#startMinerBtn') || 
                                  e.target.closest('#harvestMinerBtn');
                    
                    if (target) {
                        target.style.transform = 'translateX(10px)';
                        setTimeout(() => {
                            target.style.transform = 'translateX(0)';
                        }, 200);
                    }
                    
                    showNotification('⛔ موجودی سکه تموم شد! فاز بعدی به زودی راه‌اندازی می‌شود.', 'error');
                    return false;
                }
            }
        }, true);

        this.eventBlockingEnabled = true;
    },

    setupMinerListener() {
        const minerSection = document.getElementById('miner-section');
        if (minerSection) {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.attributeName === 'class') {
                        if (minerSection.classList.contains('active')) {
                            this.handleMinerSectionOpen();
                        }
                    }
                });
            });
            observer.observe(minerSection, { attributes: true });
        }
    },

    handleMinerSectionOpen() {
        const remaining = this.getRemainingCoins();
        
        if (remaining <= 0) {
            this.showPhaseCompleteMessage();
            this.disableMinerCompletely();
        } else {
            // 🔥 اصلاح: اگر موجودی پر شده، ماینر رو فعال کن
            this.enableMiner();
        }
    },

    addMinedCoins(amount, userId = 'system') {
        if (amount <= 0) return;

        const remaining = this.totalSupply - this.minedCoins;
        
        if (remaining <= 0) {
            this.disableMinerCompletely();
            this.showPhaseCompleteMessage();
            return;
        }

        const actualAmount = Math.min(amount, remaining);
        this.minedCoins += actualAmount;
        
        // 🔥 اصلاح: اگر موجودی پر شده بود و الان دوباره سکه اضافه شده
        if (this.isMinerDisabled && this.getRemainingCoins() > 0) {
            this.enableMiner();
        }

        this.networkHistory.unshift({
            amount: actualAmount,
            userId: userId,
            timestamp: Date.now(),
            type: 'mining'
        });

        if (this.networkHistory.length > 20) {
            this.networkHistory = this.networkHistory.slice(0, 20);
        }

        this.saveToStorage();
        this.updateDisplay();
    },

    disableMinerCompletely() {
        if (this.isMinerDisabled) return;
        
        this.isMinerDisabled = true;
        console.log('🔴 غیرفعال کردن کامل ماینر - حالت قطعی فعال شد');

        const diamondLogo = document.getElementById('minerDiamondLogo');
        if (diamondLogo) {
            diamondLogo.style.opacity = '0.4';
            diamondLogo.style.cursor = 'not-allowed';
            diamondLogo.style.pointerEvents = 'none';
            diamondLogo.style.filter = 'grayscale(100%) brightness(0.5)';
            diamondLogo.style.animation = 'none';
            diamondLogo.style.background = 'linear-gradient(135deg, #666, #333)';
            diamondLogo.style.border = '2px solid #ff4757';
            
            // فقط اگر قبلاً قفل نداشت اضافه کن
            if (!diamondLogo.querySelector('.miner-lock-icon')) {
                const lockIcon = document.createElement('div');
                lockIcon.className = 'miner-lock-icon';
                lockIcon.innerHTML = '🔒';
                lockIcon.style.position = 'absolute';
                lockIcon.style.top = '50%';
                lockIcon.style.left = '50%';
                lockIcon.style.transform = 'translate(-50%, -50%)';
                lockIcon.style.fontSize = '3rem';
                lockIcon.style.zIndex = '10';
                lockIcon.style.textShadow = '0 0 20px rgba(255,71,87,0.8)';
                diamondLogo.appendChild(lockIcon);
            }
        }

        const startMinerBtn = document.getElementById('startMinerBtn');
        if (startMinerBtn) {
            startMinerBtn.disabled = true;
            startMinerBtn.innerHTML = '<i class="fas fa-ban"></i> متوقف شده';
            startMinerBtn.style.background = 'linear-gradient(135deg, #ff4757, #ff2e4e)';
            startMinerBtn.style.cursor = 'not-allowed';
            startMinerBtn.style.opacity = '0.7';
            startMinerBtn.style.color = 'white';
            startMinerBtn.style.border = '2px solid #ff4757';
        }

        const harvestMinerBtn = document.getElementById('harvestMinerBtn');
        if (harvestMinerBtn) {
            harvestMinerBtn.disabled = true;
            harvestMinerBtn.innerHTML = '<i class="fas fa-ban"></i> Disabled';
            harvestMinerBtn.style.background = 'linear-gradient(135deg, #666, #888)';
            harvestMinerBtn.style.cursor = 'not-allowed';
            harvestMinerBtn.style.opacity = '0.7';
            harvestMinerBtn.style.color = 'white';
        }

        const coinsCard = document.getElementById('coinsCard');
        const timeCard = document.getElementById('timeCard');
        
        [coinsCard, timeCard].forEach(card => {
            if (card) {
                card.style.opacity = '0.6';
                card.style.cursor = 'not-allowed';
                card.style.pointerEvents = 'none';
                card.style.filter = 'grayscale(100%)';
                card.style.border = '2px solid #ff4757';
            }
        });

        const loginRequiredText = document.getElementById('minerLoginRequired');
        if (loginRequiredText) {
            loginRequiredText.innerHTML = '⛔ <strong style="color: #ff4757; font-size: 1.1rem;">Coin supply exhausted</strong><br><small style="color: #888;">Next phase coming soon</small>';
            loginRequiredText.style.color = '#ff4757';
            loginRequiredText.style.fontWeight = 'bold';
            loginRequiredText.style.textAlign = 'center';
            loginRequiredText.style.padding = '15px';
            loginRequiredText.style.background = 'rgba(255,71,87,0.1)';
            loginRequiredText.style.borderRadius = '10px';
            loginRequiredText.style.border = '1px solid rgba(255,71,87,0.3)';
        }

        const statusElement = document.getElementById('minerStatus');
        if (statusElement) {
            statusElement.textContent = 'متوقف شده';
            statusElement.className = 'miner-status status-inactive';
            statusElement.style.background = 'linear-gradient(135deg, #ff4757, #ff2e4e)';
            statusElement.style.color = 'white';
            statusElement.style.border = '2px solid #ff4757';
            statusElement.style.fontWeight = 'bold';
        }

        const progressFill = document.getElementById('minerProgressFill');
        if (progressFill) {
            progressFill.style.background = 'linear-gradient(90deg, #ff4757, #ff2e4e)';
        }

        this.addProtectiveOverlay();
        console.log('🔴 ماینر کاملاً غیرفعال شد');
        this.saveToStorage();
    },

    enableMiner() {
        this.isMinerDisabled = false;
        console.log('🟢 فعال کردن ماینر - بازنشانی کامل');

        // حذف overlay محافظ
        const overlay = document.getElementById('minerProtectiveOverlay');
        if (overlay) overlay.remove();

        const diamondLogo = document.getElementById('minerDiamondLogo');
        if (diamondLogo) {
            // 🔥 اصلاح: حذف آیکون قفل با کلاس مشخص
            const lockIcon = diamondLogo.querySelector('.miner-lock-icon');
            if (lockIcon) {
                lockIcon.remove();
            }
            
            // بازنشانی کامل استایل الماس
            diamondLogo.style.opacity = '1';
            diamondLogo.style.cursor = 'pointer';
            diamondLogo.style.pointerEvents = 'auto';
            diamondLogo.style.filter = 'none';
            diamondLogo.style.animation = 'goldenDiamondPulse 3s ease-in-out infinite';
            diamondLogo.style.background = 'linear-gradient(135deg, #ffd700, #ff6b00, #ffd700)';
            diamondLogo.style.border = '4px solid rgba(255, 215, 0, 0.8)';
            diamondLogo.style.boxShadow = '0 0 80px rgba(255, 215, 0, 0.9), inset 0 0 50px rgba(255, 255, 255, 0.5)';
            
            // نمایش آیکون الماس
            const gemIcon = diamondLogo.querySelector('i');
            if (gemIcon) {
                gemIcon.style.display = 'block';
            }
        }

        const startMinerBtn = document.getElementById('startMinerBtn');
        if (startMinerBtn) {
            startMinerBtn.disabled = false;
            startMinerBtn.innerHTML = '<i class="fas fa-play"></i> Start Mining';
            startMinerBtn.style.background = 'linear-gradient(135deg, var(--miner-accent), var(--miner-purple))';
            startMinerBtn.style.cursor = 'pointer';
            startMinerBtn.style.opacity = '1';
            startMinerBtn.style.color = 'white';
            startMinerBtn.style.border = 'none';
            startMinerBtn.style.boxShadow = '0 8px 25px rgba(0, 245, 255, 0.4)';
        }

        const harvestMinerBtn = document.getElementById('harvestMinerBtn');
        if (harvestMinerBtn) {
            harvestMinerBtn.disabled = false;
            harvestMinerBtn.innerHTML = '<i class="fas fa-coins"></i> Withdraw Coins';
            harvestMinerBtn.style.background = 'linear-gradient(135deg, var(--success), #00cc6a)';
            harvestMinerBtn.style.cursor = 'pointer';
            harvestMinerBtn.style.opacity = '1';
            harvestMinerBtn.style.color = 'white';
            harvestMinerBtn.style.boxShadow = '0 8px 25px rgba(0, 255, 136, 0.4)';
        }

        const coinsCard = document.getElementById('coinsCard');
        const timeCard = document.getElementById('timeCard');
        
        [coinsCard, timeCard].forEach(card => {
            if (card) {
                card.style.opacity = '1';
                card.style.cursor = 'pointer';
                card.style.pointerEvents = 'auto';
                card.style.filter = 'none';
                card.style.border = '1px solid rgba(255, 215, 0, 0.3)';
                card.style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)';
                card.style.boxShadow = '0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)';
            }
        });

        const loginRequiredText = document.getElementById('minerLoginRequired');
        if (loginRequiredText) {
            if (window.userSystem && window.userSystem.currentUser) {
                loginRequiredText.textContent = 'Please login to start mining';
                loginRequiredText.style.color = 'var(--gray)';
                loginRequiredText.style.fontWeight = 'normal';
                loginRequiredText.style.textAlign = 'center';
                loginRequiredText.style.background = 'none';
                loginRequiredText.style.border = 'none';
                loginRequiredText.style.padding = '0';
            } else {
                loginRequiredText.textContent = 'Please login to start mining';
                loginRequiredText.style.color = 'var(--gray)';
                loginRequiredText.style.fontWeight = 'normal';
                loginRequiredText.style.textAlign = 'center';
                loginRequiredText.style.background = 'none';
                loginRequiredText.style.border = 'none';
                loginRequiredText.style.padding = '0';
            }
        }

        const statusElement = document.getElementById('minerStatus');
        if (statusElement) {
            statusElement.textContent = 'Disabled';
            statusElement.className = 'miner-status status-inactive';
            statusElement.style.background = 'rgba(255, 71, 87, 0.2)';
            statusElement.style.color = 'var(--danger)';
            statusElement.style.border = '1px solid rgba(255, 71, 87, 0.4)';
            statusElement.style.fontWeight = '600';
        }

        const progressFill = document.getElementById('minerProgressFill');
        if (progressFill) {
            progressFill.style.background = 'linear-gradient(90deg, var(--miner-accent), var(--miner-purple), var(--miner-accent))';
        }

        const miningHammer = document.querySelector('.mining-hammer');
        if (miningHammer) {
            miningHammer.style.display = 'block';
        }

        // 🔥 اصلاح: آپدیت سیستم ماینر
        if (window.minerSystem) {
            window.minerSystem.updateMinerDisplay();
        }

        if (window.minerDiamond) {
            window.minerDiamond.updateMinerDiamondDisplay();
        }

        console.log('🟢 ماینر کاملاً فعال شد');
        this.saveToStorage();
        
    },

    addProtectiveOverlay() {
        const existingOverlay = document.getElementById('minerProtectiveOverlay');
        if (existingOverlay) existingOverlay.remove();

        const minerSection = document.getElementById('miner-section');
        if (!minerSection) return;

        const overlay = document.createElement('div');
        overlay.id = 'minerProtectiveOverlay';
        overlay.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 25px;
            pointer-events: auto;
            cursor: not-allowed;
        `;

        const message = document.createElement('div');
        message.style.cssText = `
            background: linear-gradient(135deg, #ff4757, #ff2e4e);
            color: white;
            padding: 25px 35px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 10px 30px rgba(255,71,87,0.5);
            border: 3px solid white;
            max-width: 80%;
        `;
        message.innerHTML = `
    ⛔<br>
    <strong>Coin supply exhausted</strong><br>
    <small style="font-size: 0.9rem; opacity: 0.9;">Next phase coming soon</small>
`;

        overlay.appendChild(message);
        minerSection.style.position = 'relative';
        minerSection.appendChild(overlay);
    },

    showPhaseCompleteMessage() {
        if (document.getElementById('phaseCompleteModal')) {
            return;
        }

        const messageOverlay = document.createElement('div');
        messageOverlay.id = 'phaseCompleteModal';
        messageOverlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        `;

        const messageBox = document.createElement('div');
        messageBox.style.cssText = `
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 3px solid #ff4757;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 450px;
            width: 90%;
            color: white;
            box-shadow: 0 25px 50px rgba(255, 71, 87, 0.4);
        `;

        messageBox.innerHTML = `
    <button onclick="tokenomicsSystem.closePhaseCompleteMessage()" 
            style="position: absolute; top: 15px; left: 15px; background: rgba(255,71,87,0.2); border: none; color: #ff4757; font-size: 1.5rem; cursor: pointer; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
        ×
    </button>
    <div style="font-size: 4rem; margin-bottom: 20px;">⛔</div>
    <h3 style="color: #ff4757; margin-bottom: 15px; font-size: 1.6rem;">
        Phase 1 Completed!
    </h3>
    <p style="color: #ffffff; margin-bottom: 25px; line-height: 1.7;">
        Phase 1 mining has been successfully completed.<br>
        <strong style="color: #ffd700;">Phase 2 coming soon!</strong>
    </p>
    <div style="background: rgba(255, 71, 87, 0.1); padding: 20px; border-radius: 12px; margin: 25px 0;">
        <div style="color: #ffd700; font-weight: bold;">📊 Phase 1 Statistics:</div>
        <div style="color: #ffffff; margin-top: 8px;">${this.minedCoins.toLocaleString()} coins mined</div>
    </div>
    <button onclick="tokenomicsSystem.closePhaseCompleteMessage()" 
            style="background: linear-gradient(135deg, #ff4757, #ff2e4e); border: none; padding: 14px 35px; border-radius: 12px; color: white; font-weight: bold; cursor: pointer;">
        Got it
    </button>
`;

        messageOverlay.appendChild(messageBox);
        document.body.appendChild(messageOverlay);
    },

    closePhaseCompleteMessage() {
        const messageOverlay = document.getElementById('phaseCompleteModal');
        if (messageOverlay) {
            messageOverlay.remove();
        }
    },

    getRemainingCoins() {
        const remaining = this.totalSupply - this.minedCoins;
        return Math.max(0, remaining);
    },

    updateDisplay() {
        const remaining = this.getRemainingCoins();

        safeSetText('totalSupply', this.formatLargeNumber(this.totalSupply));
        safeSetText('minedCoins', this.formatLargeNumber(this.minedCoins));
        safeSetText('remainingCoins', this.formatLargeNumber(remaining));
        
        const percentage = this.getMinedPercentage();
        safeSetText('minedPercentage', percentage.toFixed(2) + '%');
        safeSetText('progressPercentage', percentage.toFixed(2) + '%');

        const progressBar = safeGetElement('networkProgress');
        if (progressBar) {
            progressBar.style.width = `${percentage}%`;
        }

        this.updateHistoryDisplay();

        // 🔥 اصلاح: بررسی وضعیت ماینر بر اساس موجودی
        if (remaining <= 0 && !this.isMinerDisabled) {
            this.disableMinerCompletely();
            this.showPhaseCompleteMessage();
        } else if (remaining > 0 && this.isMinerDisabled) {
            this.enableMiner();
        }
    },

    getMinedPercentage() {
        const percentage = (this.minedCoins / this.totalSupply) * 100;
        return Math.min(100, percentage);
    },

    formatLargeNumber(num) {
        if (num >= 1000000000) {
            return (num / 1000000000).toFixed(2) + 'B';
        } else if (num >= 1000000) {
            return (num / 1000000).toFixed(2) + 'M';
        } else if (num >= 1000) {
            return (num / 1000).toFixed(1) + 'K';
        }
        return num.toLocaleString();
    },

    updateHistoryDisplay() {
    const historyContainer = safeGetElement('networkHistory');
    if (!historyContainer) return;

    if (this.networkHistory.length === 0) {
        historyContainer.innerHTML = '<div style="text-align: center; color: var(--gray); padding: 20px;">No mining activity recorded in the network yet</div>';
        return;
    }

    historyContainer.innerHTML = this.networkHistory.map(record => `
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-hard-hat" style="color: var(--primary);"></i>
                <div>
                    <div style="color: var(--light); font-size: 0.9rem; font-weight: 600;">+${record.amount.toLocaleString()} coins</div>
                    <div style="color: var(--gray); font-size: 0.7rem;">${this.formatTime(record.timestamp)}</div>
                </div>
            </div>
            <div style="color: var(--primary); font-size: 0.8rem; font-weight: 600;">Mining</div>
        </div>
    `).join('');
},

    formatTime(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diff = now - date;
        
        if (diff < 60 * 60 * 1000) {
            const minutes = Math.floor(diff / (60 * 1000));
            return `${minutes} minutes ago`;
        } else if (diff < 24 * 60 * 60 * 1000) {
            const hours = Math.floor(diff / (60 * 60 * 1000));
            return `${hours} hours ago`;
        } else {
            return date.toLocaleDateString('En-US');
        }
    },

    startRealTimeUpdates() {
        setInterval(() => {
            this.updateDisplay();
        }, 5000);
    },

    saveToStorage() {
        const data = {
            totalSupply: this.totalSupply,
            minedCoins: this.minedCoins,
            networkHistory: this.networkHistory,
            isMinerDisabled: this.isMinerDisabled,
            lastUpdate: Date.now()
        };
        localStorage.setItem('tokenomics_data', JSON.stringify(data));
    },

    loadFromStorage() {
        try {
            const saved = localStorage.getItem('tokenomics_data');
            if (saved) {
                const data = JSON.parse(saved);
                this.totalSupply = data.totalSupply || 30000000000;
                this.minedCoins = data.minedCoins || 0;
                this.networkHistory = data.networkHistory || [];
                this.isMinerDisabled = data.isMinerDisabled || false;
                
                // 🔥 اصلاح: اگر موجودی پر شده بود، ماینر رو غیرفعال کن
                if (this.getRemainingCoins() <= 0) {
                    this.isMinerDisabled = true;
                }
            }
        } catch (error) {
            console.warn('خطا در بارگذاری توکنومیکس:', error);
        }
    },

    saveTextsToStorage(title, description) {
        const texts = {
            title: title,
            description: description,
            savedAt: Date.now()
        };
        localStorage.setItem('tokenomics_texts', JSON.stringify(texts));
    },

    loadTextsFromStorage() {
        try {
            const saved = localStorage.getItem('tokenomics_texts');
            if (saved) {
                const texts = JSON.parse(saved);
                const titleElement = document.querySelector('.tokenomics-header h3');
                const descElement = document.querySelector('.tokenomics-header p');
                
                if (titleElement && texts.title) {
                    titleElement.innerHTML = `<i class="fas fa-chart-pie"></i> ${texts.title}`;
                }
                
                if (descElement && texts.description) {
                    descElement.textContent = texts.description;
                }
            }
        } catch (error) {
            console.warn('خطا در بارگذاری متن‌های توکنومیکس:', error);
        }
    }
};
// ==================== ابزارهای کمکی ====================
const StorageManager = {
    setItem(key, value) {
        try {
            localStorage.setItem(key, JSON.stringify(value));
        } catch (e) {
            console.warn('LocalStorage full, clearing old data...');
            this.clearOldData();
            localStorage.setItem(key, JSON.stringify(value));
        }
    },
    
    getItem(key) {
        try {
            return JSON.parse(localStorage.getItem(key));
        } catch (e) {
            return null;
        }
    },
    
    clearOldData() {
        const oneWeekAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith('user_') || key.startsWith('miner_')) {
                const data = this.getItem(key);
                if (data && data.lastSave < oneWeekAgo) {
                    localStorage.removeItem(key);
                }
            }
        });
    }
};

// ==================== توابع اصلی بازی ====================
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <div class="notification-icon">
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            </div>
            <div style="color: var(--light); font-size: 0.95rem; font-weight: 500;">${message}</div>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => notification.classList.add('show'), 100);
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) notification.remove();
        }, 300);
    }, 3000);
}

function showFormNotification(message, type = 'info', formId) {
    const notificationId = formId === 'login' ? 'loginFormNotification' : 'registerFormNotification';
    const notification = safeGetElement(notificationId);
    
    if (!notification) return;
    
    notification.className = `form-notification ${type}`;
    notification.innerHTML = `
        <div class="form-notification-content">
            <div class="form-notification-icon">
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            </div>
            <div style="color: var(--light); font-size: 0.9rem; font-weight: 500;">${message}</div>
        </div>
    `;
    
    notification.classList.add('show');
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 3000);
}

function initGame() {
    // مقداردهی اولیه سیستم‌های جهانی
    window.userSystem = userSystem;
    window.gameState = gameState;
    window.levelSystem = levelSystem;
    window.vipSystem = vipSystem;
    window.minerSystem = minerSystem;
    window.adminSystem = adminSystem;
    window.tokenomicsSystem = tokenomicsSystem;
tokenomicsSystem.init();
tokenomicsSystem.init();

    const savedRate = localStorage.getItem('coin_to_crypto_rate');
    if (savedRate) {
        cryptoRateSystem.coinToCryptoRate = parseFloat(savedRate);
        console.log('نرخ ذخیره شده لود شد:', savedRate);
    }
    updateUserInterface();
    updateConversionAmount();
    generateLevelCards();
    checkReferralParameter();
    setupPasswordToggles();
    
    loadVipData();
    checkDailyLimit();
    generateVipPlans();
    updateVipStatus();
    
    startMinerRealTimeUpdates();
    
    minerSystem.init();
    adminSystem.init();
    minerDiamond.init();
    
    if (window.vipSystem && window.vipSystem.init) {
        window.vipSystem.init();
    }
    
    safeAddEventListener('coinAmount', 'input', updateConversionAmount);
    
    // راه‌اندازی سیستم نرخ ارزها
    cryptoRateSystem.fetchAllRates().then(() => {
        updateRateInfoDisplay();
        updateConversionAmount();
    });
    
    // بروزرسانی هر 5 دقیقه
    setInterval(() => {
        cryptoRateSystem.fetchAllRates().then(() => {
            updateRateInfoDisplay();
            updateConversionAmount();
        });
    }, 5 * 60 * 1000);
    
    // راه‌اندازی اولیه برای بخش فعال
    initializeSectionAnimations('miner-section');
    
    window.addEventListener('beforeunload', () => {
        cleanupAllAnimations();
    });
}

// تابع برای آپدیت نمایش نرخ‌ها
function updateRateInfoDisplay() {
    const btcRateDisplay = safeGetElement('btcRateDisplay');
    const ethRateDisplay = safeGetElement('ethRateDisplay');
    const usdtRateDisplay = safeGetElement('usdtRateDisplay');
    const lastUpdateElement = safeGetElement('lastRatesUpdate');
    
    if (btcRateDisplay) {
        btcRateDisplay.textContent = `$${cryptoRateSystem.rates.bitcoin.price.toLocaleString()}`;
    }
    if (ethRateDisplay) {
        ethRateDisplay.textContent = `$${cryptoRateSystem.rates.ethereum.price.toLocaleString()}`;
    }
    if (usdtRateDisplay) {
        usdtRateDisplay.textContent = `$${cryptoRateSystem.rates.tether.price.toFixed(2)}`;
    }
    if (lastUpdateElement && cryptoRateSystem.lastUpdate) {
        lastUpdateElement.textContent = `Last update: ${cryptoRateSystem.lastUpdate.toLocaleTimeString('fa-IR')}`;
    }
}

function updateAllDisplays() {
    updateDisplays();
    generateLevelCards();
    updateAffiliateStats();
    updateConversionAmount();
    updateUserLevelBadge();
    updateVipStatus();
    generateVipPlans();
    updateLimitDisplay();
    minerSystem.updateMinerDisplay();
    updateAdvancedStats();
}

function updateDisplays() {
    if (userSystem.currentUser) {
        safeSetText('coinCount', gameState.coinCount.toLocaleString());
        safeSetText('headerCoinCount', gameState.coinCount.toLocaleString());
        
        safeSetText('profileLevel', levelSystem.currentLevel);
        safeSetText('profileCoins', gameState.coinCount.toLocaleString());
        safeSetText('profileXP', levelSystem.currentXP.toLocaleString() + ' XP');
        
        // 🔥 **اصلاح: نمایش موجودی ارزهای دیجیتال کاربر جاری**
        const balances = cryptoRateSystem.getUserBalances();
        safeSetText('profileTether', balances.tether.toFixed(6) + ' USDT');
        safeSetText('profileBitcoin', balances.bitcoin.toFixed(8) + ' BTC');
        safeSetText('profileEthereum', balances.ethereum.toFixed(6) + ' ETH');
        
        const currentLevelData = levelSystem.levels.find(l => l.level === levelSystem.currentLevel);
        safeSetText('profileBonus', `+${currentLevelData ? currentLevelData.coinBonus : 0}٪`);
        
        safeSetText('userName', userSystem.currentUser.name);
        safeSetText('userEmail', userSystem.currentUser.email);
        
        updateLevelProgress();
    }
}

function updateUserInterface() {
    const user = userSystem.currentUser;
    
    if (user) {
        safeSetText('userName', user.name);
        safeSetText('userEmail', user.email);
        
        const profileLoginBtn = safeGetElement('profileLoginBtn');
        if (profileLoginBtn) profileLoginBtn.textContent = 'Logout';
        
        updateAllDisplays();
    } else {
        safeSetText('userName', 'Please login');
        safeSetText('userEmail', '-');
        
        const profileLoginBtn = safeGetElement('profileLoginBtn');
        if (profileLoginBtn) profileLoginBtn.textContent = 'Login / Register';
        
        // 🔥 **اضافه کردن ریست کامل برای حالت مهمان**
        resetGuestDisplay();
        
        // ریست کردن اطلاعات ارزها در پروفایل
        safeSetText('profileTether', '0 USDT');
        safeSetText('profileBitcoin', '0 BTC'); 
        safeSetText('profileEthereum', '0 ETH');
    }
}

function updateAdvancedStats() {
    if (!userSystem.currentUser) return;
    
    // آمار پیشرفته
    const userMiner = minerSystem.getUserMiner(userSystem.currentUser.id);
    const referralStats = userSystem.getUserReferralStats();
    
    safeSetText('totalMined', (userMiner.totalEarnings || 0).toLocaleString());
    safeSetText('referralCount', (referralStats?.referralCount || 0).toLocaleString());
    safeSetText('achievements', '۰/۱۰'); // می‌تونی بعداً کاملش کنی
    safeSetText('sessionTime', '۱h'); // می‌تونی بعداً کاملش کنی
    
    // روزهای فعال
    const regDate = new Date(userSystem.currentUser.registrationDate);
    const today = new Date();
    const diffTime = Math.abs(today - regDate);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    safeSetText('activeDays', diffDays);
    
    // رتبه کاربر (نمونه)
    safeSetText('userRank', '#140');
}

function resetGuestDisplay() {
    safeSetText('coinCount', '0');
    safeSetText('headerCoinCount', '0');
    
    safeSetText('profileLevel', '-');
    safeSetText('profileCoins', '-');
    safeSetText('profileXP', '-');
    safeSetText('profileCash', '-');
    safeSetText('profileDollar', '-');
    safeSetText('profileBonus', '-');
    
    // 🔥 **ریست کردن اطلاعات ارزهای دیجیتال**
    safeSetText('profileTether', '۰ USDT');
    safeSetText('profileBitcoin', '۰ BTC');
    safeSetText('profileEthereum', '۰ ETH');
    
    safeSetText('currentLevel', '-');
    safeSetText('currentXP', '-');
    safeSetText('requiredXP', '-');
    
    const progressFill = safeGetElement('levelProgressFill');
    if (progressFill) progressFill.style.width = '0%';
    
    // ریست کردن اطلاعات VIP
    if (window.vipSystem) {
        window.vipSystem.currentVip = null;
        window.vipSystem.totalCollected = 0;
        window.vipSystem.dailyCollected = 0;
    }
}

function updateLevelProgress() {
    const currentLevelData = levelSystem.levels.find(l => l.level === levelSystem.currentLevel);
    
    if (!currentLevelData || currentLevelData.type !== "free") {
        safeSetText('currentLevel', levelSystem.currentLevel);
        safeSetText('currentXP', 'MAX');
        safeSetText('requiredXP', 'MAX');
        
        const progressFill = safeGetElement('levelProgressFill');
        if (progressFill) progressFill.style.width = '100%';
        return;
    }
    
    const nextLevelData = levelSystem.levels.find(l => l.level === levelSystem.currentLevel + 1 && l.type === "free");
    
    if (nextLevelData) {
        const xpForNextLevel = nextLevelData.xpRequired - currentLevelData.xpRequired;
        const xpInCurrentLevel = levelSystem.currentXP - currentLevelData.xpRequired;
        const progressPercentage = Math.min(Math.max((xpInCurrentLevel / xpForNextLevel) * 100, 0), 100);
        
        safeSetText('currentLevel', levelSystem.currentLevel);
        safeSetText('currentXP', xpInCurrentLevel);
        safeSetText('requiredXP', xpForNextLevel);
        
        const progressFill = safeGetElement('levelProgressFill');
        if (progressFill) progressFill.style.width = `${progressPercentage}%`;
    } else {
        safeSetText('currentLevel', levelSystem.currentLevel);
        safeSetText('currentXP', 'MAX');
        safeSetText('requiredXP', 'MAX');
        
        const progressFill = safeGetElement('levelProgressFill');
        if (progressFill) progressFill.style.width = '100%';
    }
}

// تابع آپدیت نمایش مقادیر تبدیل - فقط ارزهای دیجیتال
async function updateConversionAmount() {
    const coinAmountInput = safeGetElement('coinAmount');
    const availableCoinsElement = safeGetElement('availableCoins');
    const conversionRateElement = safeGetElement('conversionRate');
    const tetherAmountElement = safeGetElement('tetherAmount');
    const bitcoinAmountElement = safeGetElement('bitcoinAmount');
    const ethereumAmountElement = safeGetElement('ethereumAmount');
    
    if (coinAmountInput) {
        const coins = parseInt(coinAmountInput.value) || 1;
        
        // آپدیت سکه‌های قابل تبدیل
        if (availableCoinsElement) {
            availableCoinsElement.textContent = gameState.coinCount.toLocaleString();
        }
        
        // آپدیت نرخ تبدیل
        if (conversionRateElement) {
            conversionRateElement.textContent = cryptoRateSystem.coinToCryptoRate;
        }
        
        try {
            // دریافت نرخ‌های به‌روز
            await cryptoRateSystem.fetchAllRates();
            
            // محاسبه مقادیر برای هر ارز
            const amounts = cryptoRateSystem.calculateCryptoAmount(coins);
            
            // آپدیت نمایش همه ارزها
            if (tetherAmountElement) tetherAmountElement.textContent = amounts.tether.toFixed(6);
            if (bitcoinAmountElement) bitcoinAmountElement.textContent = amounts.bitcoin.toFixed(8);
            if (ethereumAmountElement) ethereumAmountElement.textContent = amounts.ethereum.toFixed(6);
            
            // آپدیت اطلاعات نرخ‌ها
            updateRateInfoDisplay();
            
        } catch (error) {
            console.warn('استفاده از نرخ‌های پیش‌فرض به دلیل خطا:', error);
        }
    }
}

// تابع برای آپدیت نمایش نرخ‌ها
function updateRateInfoDisplay() {
    const btcRateDisplay = safeGetElement('btcRateDisplay');
    const ethRateDisplay = safeGetElement('ethRateDisplay');
    const usdtRateDisplay = safeGetElement('usdtRateDisplay');
    const lastUpdateElement = safeGetElement('lastRatesUpdate');
    
    if (btcRateDisplay) {
        btcRateDisplay.textContent = `$${cryptoRateSystem.rates.bitcoin.price.toLocaleString()}`;
    }
    if (ethRateDisplay) {
        ethRateDisplay.textContent = `$${cryptoRateSystem.rates.ethereum.price.toLocaleString()}`;
    }
    if (usdtRateDisplay) {
        usdtRateDisplay.textContent = `$${cryptoRateSystem.rates.tether.price.toFixed(2)}`;
    }
    if (lastUpdateElement && cryptoRateSystem.lastUpdate) {
        lastUpdateElement.textContent = `Last update: ${cryptoRateSystem.lastUpdate.toLocaleTimeString('en-US')}`;
    }
}

// تابع جدید برای تنظیم سایز فونت
function adjustFontSizeBasedOnLength(element, value) {
    if (!element) return;
    
    const textLength = value.toString().replace(/,/g, '').length; // حذف کاما برای شمارش دقیق
    
    // تنظیم سایز فونت بر اساس طول عدد
    if (textLength <= 6) {
        element.style.fontSize = '1.3rem';
        element.style.lineHeight = '1.2';
    } else if (textLength <= 8) {
        element.style.fontSize = '1.1rem';
        element.style.lineHeight = '1.1';
    } else if (textLength <= 10) {
        element.style.fontSize = '0.95rem';
        element.style.lineHeight = '1';
    } else if (textLength <= 12) {
        element.style.fontSize = '0.85rem';
        element.style.lineHeight = '1';
    } else {
        element.style.fontSize = '0.75rem';
        element.style.lineHeight = '1';
    }
}

// event listener برای دکمه‌های مقدار سریع
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('btn-quick-amount')) {
        const amount = e.target.getAttribute('data-amount');
        const coinAmountInput = safeGetElement('coinAmount');
        if (coinAmountInput) {
            coinAmountInput.value = amount;
            updateConversionAmount();
            
            // افکت روی دکمه کلیک شده
            e.target.style.transform = 'scale(0.95)';
            e.target.style.background = 'rgba(255,215,0,0.3)';
            setTimeout(() => {
                e.target.style.transform = 'scale(1)';
                e.target.style.background = 'rgba(255,215,0,0.1)';
            }, 150);
        }
    }
});

function updateAffiliateStats() {
    if (!userSystem.currentUser) {
        safeSetText('personalReferralCode', '---');
        
        safeSetText('referralCount', '۰');
        safeSetText('referralEarnings', '۰');
        safeSetText('level1Referrals', '۰');
        safeSetText('level2Referrals', '۰');
        return;
    }
    
    const referralStats = userSystem.getUserReferralStats();
    if (referralStats) {
        safeSetText('personalReferralCode', userSystem.currentUser.referralId);
        
        safeSetText('referralCount', referralStats.referralCount.toLocaleString());
        safeSetText('referralEarnings', referralStats.referralEarnings.toLocaleString());
        safeSetText('level1Referrals', referralStats.level1Count.toLocaleString());
        safeSetText('level2Referrals', referralStats.level2Count.toLocaleString());
    }
}

function generateLevelCards() {
    const levelsContainer = safeGetElement('levelsContainer');
    if (!levelsContainer) return;
    
    // Update top stats
    safeSetText('currentLevelDisplay', levelSystem.currentLevel);
    safeSetText('totalXpDisplay', levelSystem.currentXP.toLocaleString());
    
    const currentLevelData = levelSystem.levels.find(l => l.level === levelSystem.currentLevel);
    const nextLevelData = levelSystem.levels.find(l => l.level === levelSystem.currentLevel + 1);
    
    if (nextLevelData && nextLevelData.type === "free") {
        safeSetText('nextLevelXp', (nextLevelData.xpRequired - levelSystem.currentXP).toLocaleString());
    } else {
        safeSetText('nextLevelXp', 'MAX');
    }
    
    safeSetText('levelBonus', `+${currentLevelData ? currentLevelData.coinBonus : 0}%`);
    
    // Generate level cards
    levelsContainer.innerHTML = '';
    
    levelSystem.levels.forEach(level => {
        const levelCard = document.createElement('div');
        levelCard.className = 'level-card';
        
        const isCurrentLevel = level.level === levelSystem.currentLevel;
        const isPurchased = levelSystem.purchasedLevels.has(level.level);
        const isFreeLevel = level.type === "free";
        const canPurchase = !isPurchased && level.type === "premium";
        const isUnlocked = isFreeLevel ? levelSystem.currentXP >= level.xpRequired : isPurchased;
        
        if (isCurrentLevel) {
            levelCard.classList.add('current');
        } else if (isPurchased) {
            levelCard.classList.add('unlocked');
        } else if (canPurchase) {
            levelCard.classList.add('purchasable');
        } else {
            levelCard.classList.add('locked');
        }
        
        let statusText = '';
        let statusClass = '';
        
        if (isCurrentLevel) {
            statusText = '🎯 Current Level';
            statusClass = 'status-current';
        } else if (isPurchased) {
            statusText = '✅ Purchased';
            statusClass = 'status-unlocked';
        } else if (canPurchase) {
            statusText = '💰 Can Purchase';
            statusClass = 'status-purchasable';
        } else if (isFreeLevel) {
            if (levelSystem.currentXP >= level.xpRequired) {
                statusText = '🔓 Unlocked';
                statusClass = 'status-unlocked';
            } else {
                statusText = `🔐 Required: ${(level.xpRequired - levelSystem.currentXP).toLocaleString()} XP`;
                statusClass = 'status-locked';
            }
        } else {
            statusText = '🔒 Locked';
            statusClass = 'status-locked';
        }
        
        levelCard.innerHTML = `
            <div class="level-header">
                <div class="level-title">Level ${level.level}</div>
                <div class="level-bonus">+${level.coinBonus}%</div>
            </div>
            
            <div style="text-align: center; margin: 10px 0;">
                <strong style="color: var(--light);">${level.name}</strong>
            </div>
            
            <div class="level-requirements">
                ${level.type === "premium" ? 
                    `<span>💰 ${level.price.toLocaleString()} coins</span>` : 
                    `<span>📊 ${level.xpRequired.toLocaleString()} XP</span>`
                }
            </div>
            
            ${canPurchase ? 
                `<button class="btn btn-warning purchase-level-btn" data-level="${level.level}" 
                        style="font-size: 0.8rem; padding: 8px 15px; margin: 8px 0; width: 100%;">
                    <i class="fas fa-shopping-cart"></i>
                    Purchase
                </button>` : 
                ''
            }
            
            <div class="level-status ${statusClass}" style="font-size: 0.75rem;">
                ${statusText}
            </div>
        `;
        
        levelsContainer.appendChild(levelCard);
    });
    
    document.querySelectorAll('.purchase-level-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const level = parseInt(this.getAttribute('data-level'));
            purchaseLevel(level);
        });
    });
}

function checkReferralParameter() {
    const urlParams = new URLSearchParams(window.location.search);
    const refCode = urlParams.get('ref');
    
    if (refCode) {
    showNotification(`Referral code ${refCode} detected. You will receive bonus after registration.`, 'info');
}
}

function purchaseLevel(level) {
    if (!userSystem.currentUser) {
        showNotification('Please log in to your account first', 'error');
        return false;
    }

    const levelData = levelSystem.levels.find(l => l.level === level);
    
    if (!levelData) {
        showNotification('سطح مورد نظر یافت نشد!', 'error');
        return false;
    }

    if (levelSystem.purchasedLevels.has(level)) {
        showNotification('شما قبلاً این سطح را خریداری کرده‌اید!', 'info');
        return false;
    }

    if (gameState.coinCount < levelData.price) {
        showNotification(`Insufficient balance to purchase this level ${levelData.price} coins required`, 'error');
        return false;
    }

    gameState.coinCount -= levelData.price;
    levelSystem.purchasedLevels.add(level);
    
    if (level > levelSystem.currentLevel) {
        const oldLevel = levelSystem.currentLevel;
        levelSystem.currentLevel = level;
        
        updateUserLevelBadge();
        
        showNotification(
            `🎉 سطح ${level} با موفقیت خریداری شد! شما اکنون ${levelData.name} هستید.`,
            'success'
        );
        
        showLevelUpNotification(level);
    } else {
        showNotification(
            `✅ سطح ${level} با موفقیت خریداری شد!`,
            'success'
        );
    }

    updateAllDisplays();
    userSystem.saveUserData(gameState, levelSystem);
    
    return true;
}

function checkLevelUp() {
    const oldLevel = levelSystem.currentLevel;
    let highestReachableLevel = oldLevel;
    
    for (let i = 0; i < levelSystem.levels.length; i++) {
        const levelData = levelSystem.levels[i];
        
        if (levelData.type === "free") {
            if (levelSystem.currentXP >= levelData.xpRequired) {
                highestReachableLevel = Math.max(highestReachableLevel, levelData.level);
            }
        }
    }
    
    for (let i = 0; i < levelSystem.levels.length; i++) {
        const levelData = levelSystem.levels[i];
        
        if (levelData.type === "premium" && levelSystem.purchasedLevels.has(levelData.level)) {
            highestReachableLevel = Math.max(highestReachableLevel, levelData.level);
        }
    }
    
    if (highestReachableLevel > oldLevel) {
        levelSystem.currentLevel = highestReachableLevel;
        showLevelUpNotification(highestReachableLevel);
        updateAllDisplays();
        return true;
    }
    
    return false;
}

function showLevelUpNotification(level) {
    const newLevelData = levelSystem.levels.find(l => l.level === level);
    if (!newLevelData) return;
    
    const oldLevelData = levelSystem.levels.find(l => l.level === level - 1);
    const bonusIncrease = newLevelData.coinBonus - (oldLevelData ? oldLevelData.coinBonus : 0);
    
    safeSetText('newLevel', level);
    safeSetText('levelUpTitle', ` Congratulations! You level ${level} reached`);
    safeSetText('levelUpMessage', `You are now ${newLevelData.name} You`);
    safeSetText('bonusPercent', bonusIncrease);
    
    updateUserLevelBadge();
    
    const notification = safeGetElement('levelUpNotification');
    if (notification) {
        notification.classList.add('show');
    }
    showCelebrationAnimation();
    
    for (let i = 0; i < 15; i++) {
        setTimeout(() => createCelebrationParticle(), i * 100);
    }
    
    showNotification(`🎉 up ${level} leveled up to ${newLevelData.name}`, 'success');
}

function closeLevelUp() {
    const notification = safeGetElement('levelUpNotification');
    if (notification) {
        notification.classList.remove('show');
    }
}

function createCelebrationParticle() {
    const particle = document.createElement('div');
    particle.style.position = 'fixed';
    particle.style.fontSize = '20px';
    particle.style.zIndex = '2999';
    particle.style.pointerEvents = 'none';
    particle.innerHTML = '✨';
    
    const startX = Math.random() * window.innerWidth;
    particle.style.left = `${startX}px`;
    particle.style.top = '100vh';
    
    document.body.appendChild(particle);
    
    const animation = particle.animate([
        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
        { transform: `translateY(-${window.innerHeight}px) rotate(360deg)`, opacity: 0 }
    ], {
        duration: 2000,
        easing: 'cubic-bezier(0.2, 0, 0.8, 1)'
    });
    
    animation.onfinish = () => {
        if (particle.parentNode) particle.remove();
    };
}

function updateUserLevelBadge() {
    const userLevelBadge = safeGetElement('userLevelBadge');
    if (userLevelBadge) {
        userLevelBadge.textContent = levelSystem.currentLevel;
        userLevelBadge.style.transform = 'scale(1.3)';
        setTimeout(() => {
            userLevelBadge.style.transform = 'scale(1)';
        }, 300);
    }
}

function setupPasswordToggles() {
    safeAddEventListener('toggleLoginPassword', 'click', function() {
        const passwordInput = safeGetElement('loginPassword');
        if (passwordInput) {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        }
    });

    safeAddEventListener('toggleRegisterPassword', 'click', function() {
        const passwordInput = safeGetElement('registerPassword');
        if (passwordInput) {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        }
    });

    safeAddEventListener('toggleConfirmPassword', 'click', function() {
        const passwordInput = safeGetElement('registerConfirmPassword');
        if (passwordInput) {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        }
    });
}

// ==================== توابع VIP ====================
function checkDailyLimit() {
    if (vipSystem.currentVip) {
        const warningElement = safeGetElement('limitWarning');
        if (warningElement) {
            warningElement.style.display = 'none';
        }
        updateLimitDisplay();
        return true;
    }
    
    const remaining = vipSystem.maxRegularLimit - vipSystem.totalCollected;
    
    if (vipSystem.totalCollected >= vipSystem.maxRegularLimit) {
        showLimitReachedModal('کل');
        return false;
    }
    
    if (vipSystem.totalCollected >= vipSystem.maxRegularLimit * 0.8) {
        showLimitWarning();
    }
    
    updateLimitDisplay();
    return true;
}

function showLimitWarning() {
    if (!vipSystem.currentVip) {
        const warningElement = safeGetElement('limitWarning');
        if (warningElement) {
            warningElement.style.display = 'block';
            warningElement.style.animation = 'pulse 2s infinite';
        }
    }
}

function updateLimitDisplay() {
    let userLimit, collected, limitType;
    
    if (!vipSystem.currentVip) {
        userLimit = vipSystem.maxRegularLimit;
        collected = vipSystem.totalCollected;
        limitType = 'کل';
        safeSetText('limitTitle', 'Total Coin Limit:');
    } else {
        userLimit = vipSystem.currentVip.dailyLimit;
        collected = vipSystem.dailyCollected;
        limitType = 'روزانه';
        safeSetText('limitTitle', 'Coin limit (daily)');
    }
    
    const progress = userLimit === -1 ? 0 : (collected / userLimit) * 100;
    
    const progressBar = safeGetElement('limitProgress');
    if (progressBar) {
        progressBar.style.width = `${Math.min(progress, 100)}%`;
    }
    
    safeSetText('collectedText', `${collected.toLocaleString()} Coins Collected`);
    
    if (userLimit === -1) {
        safeSetText('dailyLimitText', 'نامحدود');
        safeSetText('remainingText', 'استخراج نامحدود');
    } else {
        safeSetText('dailyLimitText', `${userLimit.toLocaleString()} Coins`);
        safeSetText('remainingText', `${Math.max(0, userLimit - collected).toLocaleString()} Coins Left`);
    }
}

function purchaseVip(planId) {
    if (!userSystem.currentUser) {
        showNotification('Please log in to your account first', 'error');
        return false;
    }
    
    const plan = vipSystem.levels.find(p => p.id === planId);
    if (!plan) {
        showNotification('پلن مورد نظر یافت نشد!', 'error');
        return false;
    }
    
    if (gameState.cashBalance < plan.price) {
        showNotification(`موجودی نقدی کافی نیست! برای خرید این پلن ${plan.price.toLocaleString()} تومان نیاز دارید.`, 'error');
        return false;
    }
    
    gameState.cashBalance -= plan.price;
    vipSystem.currentVip = {
        ...plan,
        userId: userSystem.currentUser.id,
        isActive: true
    };
    vipSystem.expiryDate = null;
    vipSystem.dailyCollected = 0;
    
    userSystem.userData[userSystem.currentUser.id].vipStatus = vipSystem.currentVip;
    
    showNotification(`🎉 پلن ${plan.name} با موفقیت فعال شد!`, 'success');
    showVipActivatedModal(plan);
    
    updateAllDisplays();
    generateVipPlans();
    saveVipData();
    
    return true;
}

function generateVipPlans() {
    const container = safeGetElement('vipPlansContainer');
    if (!container) return;
    
    container.innerHTML = '';
    
    vipSystem.levels.forEach(plan => {
        const isCurrentPlan = vipSystem.currentVip && vipSystem.currentVip.id === plan.id;
        const canPurchase = !isCurrentPlan && gameState.cashBalance >= plan.price;
        
        const planElement = document.createElement('div');
        planElement.className = 'vip-plan';
        planElement.innerHTML = `
            <div class="vip-plan-header" style="background: ${plan.color}; padding: 20px; border-radius: 15px 15px 0 0; text-align: center;">
                <i class="${plan.icon}" style="font-size: 2.5rem; margin-bottom: 10px;"></i>
                <h4 style="color: white; margin-bottom: 5px; font-size: 1.3rem;">${plan.name}</h4>
                <div style="color: white; opacity: 0.9; font-size: 0.9rem;">Unlimited Validity</div>
            </div>
            
            <div class="vip-plan-features" style="padding: 20px; background: var(--glass);">
                ${plan.features.map(feature => `
                    <div style="display: flex; align-items: center; margin-bottom: 10px; font-size: 0.85rem;">
                        <i class="fas fa-check" style="color: var(--success); margin-left: 8px;"></i>
                        <span style="color: var(--light);">${feature}</span>
                    </div>
                `).join('')}
            </div>
            
            <div class="vip-plan-footer" style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 0 0 15px 15px; text-align: center;">
                <div style="margin-bottom: 15px;">
                    <div style="color: var(--primary); font-size: 1.5rem; font-weight: bold;">${plan.price.toLocaleString()} Tether</div>
                    <div style="color: var(--gray); font-size: 0.8rem;">One-time Payment</div>
                </div>
                
                ${isCurrentPlan ? `
                    <button class="btn btn-success" style="font-size: 0.9rem;" disabled>
                        <i class="fas fa-check"></i> Active
                    </button>
                ` : `
                    <button class="btn ${canPurchase ? 'btn-primary' : 'btn-outline'} purchase-vip-btn" 
                            data-plan="${plan.id}" style="font-size: 0.9rem;"
                            ${!canPurchase ? 'disabled' : ''}>
                        ${canPurchase ? 'خرید پلن' : 'Not Enough Funds'}
                    </button>
                `}
            </div>
        `;
        
        planElement.style.cssText = `
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid ${isCurrentPlan ? 'var(--success)' : 'var(--glass-border)'};
            transition: all 0.3s ease;
            overflow: hidden;
        `;
        
        if (isCurrentPlan) {
            planElement.style.boxShadow = '0 0 30px rgba(0, 255, 136, 0.3)';
        }
        
        container.appendChild(planElement);
    });
    
    document.querySelectorAll('.purchase-vip-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const planId = parseInt(this.getAttribute('data-plan'));
            purchaseVip(planId);
        });
    });
}

function updateVipStatus() {
    const statusElement = safeGetElement('currentVipStatus');
    const expiryElement = safeGetElement('vipExpiry');
    const profileVipBadge = safeGetElement('profileVipBadge');
    
    if (!statusElement || !expiryElement) return;
    
    if (vipSystem.currentVip) {
        statusElement.textContent = vipSystem.currentVip.name;
        statusElement.style.background = vipSystem.currentVip.color;
        statusElement.style.webkitBackgroundClip = 'text';
        statusElement.style.webkitTextFillColor = 'transparent';
        
        expiryElement.textContent = 'Unlimited Validity';
        expiryElement.style.color = 'var(--success)';
        
        if (profileVipBadge) {
            profileVipBadge.style.display = 'flex';
        }
    } else {
        statusElement.textContent = 'Regular User';
        statusElement.style.background = 'linear-gradient(135deg, var(--gray), #95a5a6)';
        statusElement.style.webkitBackgroundClip = 'text';
        statusElement.style.webkitTextFillColor = 'transparent';
        expiryElement.textContent = 'Upgrade to VIP for more features';
        expiryElement.style.color = 'var(--gray)';
        
        if (profileVipBadge) {
            profileVipBadge.style.display = 'none';
        }
    }
}

function saveVipData() {
    if (!userSystem.currentUser) return;
    
    StorageManager.setItem(`vip_data_${userSystem.currentUser.id}`, {
        currentVip: vipSystem.currentVip,
        expiryDate: vipSystem.expiryDate,
        totalCollected: vipSystem.totalCollected,
        dailyCollected: vipSystem.dailyCollected,
        lastResetDate: vipSystem.lastResetDate
    });
}

function loadVipData() {
    if (!userSystem.currentUser) return;
    
    const data = StorageManager.getItem(`vip_data_${userSystem.currentUser.id}`);
    if (data) {
        vipSystem.currentVip = data.currentVip;
        vipSystem.expiryDate = data.expiryDate ? new Date(data.expiryDate) : null;
        vipSystem.totalCollected = data.totalCollected || 0;
        vipSystem.dailyCollected = data.dailyCollected || 0;
        vipSystem.lastResetDate = data.lastResetDate || new Date().toDateString();
    }
}

function showVipActivatedModal(plan) {
    safeSetText('vipModalTitle', `تبریک! ${plan.name} شدید`);
    safeSetText('vipModalMessage', `شما اکنون از امکانات ویژه ${plan.name} برخوردار هستید!`);
    const modal = safeGetElement('vipActivatedModal');
    if (modal) modal.style.display = 'flex';
}

function closeVipModal() {
    const modal = safeGetElement('vipActivatedModal');
    if (modal) modal.style.display = 'none';
}

function showLimitReachedModal(limitType) {
    safeSetText('limitType', limitType);
    const modal = safeGetElement('limitReachedModal');
    if (modal) modal.style.display = 'flex';
}

function closeLimitModal() {
    const modal = safeGetElement('limitReachedModal');
    if (modal) modal.style.display = 'none';
}

function goToVipSection() {
    closeLimitModal();
    sections.forEach(section => section.classList.remove('active'));
    const vipSection = safeGetElement('vip-section');
    if (vipSection) vipSection.classList.add('active');
    
    navIcons.forEach(icon => icon.classList.remove('active'));
    const vipNav = document.querySelector('[data-section="vip-section"]');
    if (vipNav) vipNav.classList.add('active');
    
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showCelebrationAnimation() {
    const celebration = safeGetElement('celebrationAnimation');
    if (celebration) {
        celebration.style.display = 'block';
        setTimeout(() => {
            celebration.style.display = 'none';
        }, 3000);
    }
}
// تابع نمایش نوتیفیکیشن جایزه ثبت‌نام - انگلیسی
function showSignupBonusNotification() {
    const notification = document.createElement('div');
    notification.className = 'signup-bonus-notification';
    notification.innerHTML = `
        <div class="bonus-confetti" id="bonusConfetti"></div>
        <div class="bonus-header">
            <div class="bonus-icon">
                <i class="fas fa-gem"></i>
            </div>
            <h2 class="bonus-title">Congratulations! 🎉</h2>
            <p class="bonus-subtitle">Special registration bonus activated</p>
        </div>
        
        <div class="bonus-body">
            <div class="bonus-amount">+10,000</div>
            <p class="bonus-message">
                Welcome to the <strong>Gold Coin</strong> family!<br>
                Your registration bonus has been successfully credited to your account
            </p>
            
            <div class="bonus-features">
                <div class="bonus-feature">
                    <i class="fas fa-coins"></i>
                    <span>Free Coins</span>
                </div>
                <div class="bonus-feature">
                    <i class="fas fa-rocket"></i>
                    <span>Fast Start</span>
                </div>
                <div class="bonus-feature">
                    <i class="fas fa-shield-alt"></i>
                    <span>Secure Account</span>
                </div>
                <div class="bonus-feature">
                    <i class="fas fa-gift"></i>
                    <span>Special Bonus</span>
                </div>
            </div>
        </div>
        
        <div class="bonus-footer">
            <button class="bonus-button" onclick="closeBonusNotification(this)">
                <i class="fas fa-check"></i>
                Start Mining Now
            </button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // ایجاد کانفی
    createConfetti();
    
    // نمایش با انیمیشن
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // پخش صدای جایزه
    playBonusSound();
}

// تابع بستن نوتیفیکیشن
function closeBonusNotification(button) {
    const notification = button.closest('.signup-bonus-notification');
    if (notification) {
        notification.style.opacity = '0';
        notification.style.transform = 'translate(-50%, -50%) scale(0.9)';
        setTimeout(() => {
            notification.remove();
        }, 400);
    }
}

// ایجاد افکت کانفی
function createConfetti() {
    const confettiContainer = document.getElementById('bonusConfetti');
    if (!confettiContainer) return;
    
    const colors = ['#ffd700', '#ff6b00', '#ffa502', '#ff6348', '#ff4757'];
    
    for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti-piece';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 5 + 's';
        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
        confettiContainer.appendChild(confetti);
    }
}

// پخش صدای جایزه
function playBonusSound() {
    try {
        // ایجاد صدای ساده با Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // نت C
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 1);
    } catch (e) {
        // اگر Web Audio API پشتیبانی نشد، هیچ کاری نکن
    }
}
// تابع نمایش پروسه تأیید شبکه - انگلیسی
function showNetworkConfirmation(amount) {
    // ایجاد overlay
    const overlay = document.createElement('div');
    overlay.className = 'network-overlay';
    document.body.appendChild(overlay);
    
    // ایجاد محتوای تأیید
    const confirmation = document.createElement('div');
    confirmation.className = 'network-confirmation';
    confirmation.innerHTML = `
        <div class="confirmation-header">
            <div class="confirmation-icon">
                <i class="fas fa-link"></i>
            </div>
            <h3 class="confirmation-title">Network Confirmation</h3>
            <p class="confirmation-subtitle">Please wait while we process your transaction...</p>
        </div>
        
        <div class="confirmation-progress">
            <div class="progress-steps">
                <div class="progress-step active" id="step1">1</div>
                <div class="progress-step" id="step2">2</div>
                <div class="progress-step" id="step3">3</div>
                <div class="progress-step" id="step4">4</div>
                <div class="progress-step" id="step5">5</div>
                <div class="progress-step" id="step6">✅</div>
            </div>
            <div class="progress-labels">
                <div class="progress-label">Submit</div>
                <div class="progress-label">Broadcast</div>
                <div class="progress-label">Confirm 1</div>
                <div class="progress-label">Confirm 2</div>
                <div class="progress-label">Confirm 3</div>
                <div class="progress-label">Complete</div>
            </div>
        </div>
        
        <div class="confirmation-details">
            <div class="detail-item">
                <span class="detail-label">Withdrawal Amount:</span>
                <span class="detail-value">${amount.toLocaleString()} coins</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Network:</span>
                <span class="detail-value">GOLD Chain</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Transaction ID:</span>
                <span class="detail-value">0x${Math.random().toString(16).substr(2, 12)}...</span>
            </div>
        </div>
        
        <div class="confirmation-timer" id="confirmationTimer">
            Completing in: <span id="timerCount">6</span> seconds
        </div>
        
        <div class="confirmation-footer">
            <button class="confirmation-button" id="confirmCloseBtn" disabled>
                <i class="fas fa-spinner fa-spin"></i>
                Processing...
            </button>
        </div>
    `;
    
    document.body.appendChild(confirmation);
    
    // نمایش با انیمیشن
    setTimeout(() => {
        overlay.classList.add('show');
        confirmation.classList.add('show');
    }, 100);
    
    // شروع پروسه تأیید
    startConfirmationProcess(confirmation, overlay, amount);
}

// شروع پروسه تأیید شبکه - انگلیسی
function startConfirmationProcess(confirmation, overlay, amount) {
    const steps = [1, 2, 3, 4, 5, 6];
    let currentStep = 0;
    const timerElement = document.getElementById('timerCount');
    const closeBtn = document.getElementById('confirmCloseBtn');
    let timerValue = 6;
    
    // آپدیت تایمر
    const timerInterval = setInterval(() => {
        timerValue--;
        timerElement.textContent = timerValue;
        
        if (timerValue <= 0) {
            clearInterval(timerInterval);
        }
    }, 1000);
    
    // پیشرفت مراحل
    const stepInterval = setInterval(() => {
        if (currentStep > 0) {
            const prevStep = document.getElementById(`step${steps[currentStep - 1]}`);
            prevStep.classList.remove('active');
            prevStep.classList.add('completed');
        }
        
        if (currentStep < steps.length) {
            const currentStepElement = document.getElementById(`step${steps[currentStep]}`);
            currentStepElement.classList.add('active');
            currentStep++;
        }
        
        if (currentStep >= steps.length) {
            clearInterval(stepInterval);
            clearInterval(timerInterval);
            
            // تکمیل پروسه
            setTimeout(() => {
                closeBtn.disabled = false;
                closeBtn.innerHTML = '<i class="fas fa-check"></i> Withdrawal Completed';
                closeBtn.onclick = function() { closeConfirmation(this); };
                
                // آپدیت پیام
                const timerElement = document.querySelector('.confirmation-timer');
                timerElement.innerHTML = '✅ Withdrawal completed successfully';
                timerElement.style.color = '#00ff88';
                
                // آپدیت آیکون
                const icon = document.querySelector('.confirmation-icon');
                icon.innerHTML = '<i class="fas fa-check-circle"></i>';
                icon.style.animation = 'none';
                icon.style.color = '#00ff88';
                
                // آپدیت عنوان
                const title = document.querySelector('.confirmation-title');
                title.textContent = 'Withdrawal Complete!';
                
                const subtitle = document.querySelector('.confirmation-subtitle');
                subtitle.textContent = 'Coins have been successfully withdrawn';
                
            }, 500);
        }
    }, 1000);
}

// تابع بستن پروسه تأیید
function closeConfirmation(button) {
    const confirmation = button.closest('.network-confirmation');
    const overlay = document.querySelector('.network-overlay');
    
    if (confirmation) {
        confirmation.style.opacity = '0';
        confirmation.style.transform = 'translate(-50%, -50%) scale(0.9)';
    }
    
    if (overlay) {
        overlay.style.opacity = '0';
    }
    
    setTimeout(() => {
        if (confirmation) confirmation.remove();
        if (overlay) overlay.remove();
    }, 400);
}
// این رو در بخش توابع اصلی بازی اضافه کن (پایین توابع موجود)
function startMinerRealTimeUpdates() {
    setInterval(() => {
        if (window.minerSystem && window.userSystem?.currentUser) {
            minerSystem.updateMinerDisplay();
            
            const diamondLogo = document.getElementById('minerDiamondLogo');
            const hammer = document.querySelector('.mining-hammer');
            const loginRequiredText = document.getElementById('minerLoginRequired');
            const userMiner = minerSystem.getUserMiner(window.userSystem.currentUser.id);
            
            if (userMiner.isActive) {
                const timeLeft = userMiner.endTime - Date.now();
                const isTimeUp = timeLeft <= 0;
                
                if (!isTimeUp) {
                    // هنوز در حال استخراج
                    if (diamondLogo) diamondLogo.classList.add('mining-active');
                    if (hammer) hammer.style.display = 'block';
                    if (loginRequiredText) {
                        loginRequiredText.textContent = '⛏️ Mining in progress...';
                        loginRequiredText.style.color = 'var(--primary)';
                    }
                    
                    // تغییر رنگ الماس بر اساس پیشرفت
                    const progress = Math.min((minerSystem.settings.duration - timeLeft) / minerSystem.settings.duration, 1);
                    if (diamondLogo) {
                        if (progress < 0.33) {
                            diamondLogo.style.background = 'linear-gradient(135deg, #ffd700, #ff6b00)';
                        } else if (progress < 0.66) {
                            diamondLogo.style.background = 'linear-gradient(135deg, #ff6b00, #ffd700)';
                        } else {
                            diamondLogo.style.background = 'linear-gradient(135deg, #00ff88, #ffd700)';
                        }
                        // 🔥 آپدیت کارت‌های مدرن
const coinsCard = document.getElementById('coinsCard');
const timeCard = document.getElementById('timeCard');

if (userMiner.isActive) {
    const timeLeft = userMiner.endTime - Date.now();
    const isTimeUp = timeLeft <= 0;
    
    if (!isTimeUp) {
        // در حال استخراج
        coinsCard?.classList.add('mining-active');
        timeCard?.classList.add('mining-active');
        timeCard?.classList.add('countdown-active');
    } else {
        // آماده برداشت
        coinsCard?.classList.remove('mining-active');
        coinsCard?.classList.add('ready-to-harvest');
        timeCard?.classList.remove('mining-active', 'countdown-active');
        timeCard?.classList.add('ready-to-harvest');
    }
} else {
    // غیرفعال
    coinsCard?.classList.remove('mining-active', 'ready-to-harvest', 'countdown-active');
    timeCard?.classList.remove('mining-active', 'ready-to-harvest', 'countdown-active');
}

// مدیریت سایز اعداد
const collectedElement = document.getElementById('minerCollected');
const timeElement = document.getElementById('minerTimeLeft');

if (collectedElement && collectedElement.textContent.length > 8) {
    collectedElement.style.fontSize = '1.4rem';
} else if (collectedElement) {
    collectedElement.style.fontSize = '';
}

if (timeElement && timeElement.textContent.length > 8) {
    timeElement.style.fontSize = '1.3rem';
} else if (timeElement) {
    timeElement.style.fontSize = '';
}
                    }
                    
                } else {
                    // زمان تموم شده - آماده برداشت
                    if (diamondLogo) {
                        diamondLogo.classList.remove('mining-active');
                        diamondLogo.style.background = 'linear-gradient(135deg, #00ff88, #00ff88, #00ff88)';
                        diamondLogo.style.animation = 'pulse 1s infinite';
                    }
                    if (hammer) hammer.style.display = 'none';
                    if (loginRequiredText) {
                        loginRequiredText.textContent = 'Ready for withdrawal';
                        loginRequiredText.style.color = 'var(--success)';
                    }
                }
                
            } else {
                // ماینر غیرفعال
                if (diamondLogo) {
                    diamondLogo.classList.remove('mining-active');
                    diamondLogo.style.background = 'linear-gradient(135deg, #ffd700, #ff6b00, #ffd700)';
                    diamondLogo.style.animation = 'goldenDiamondPulse 3s ease-in-out infinite';
                }
                if (hammer) hammer.style.display = 'none';
                if (loginRequiredText) {
                    loginRequiredText.textContent = 'Click to start mining';
                    loginRequiredText.style.color = 'var(--gray)';
                }
            }
        }
    }, 500);
}

// ==================== رویدادها ====================
// تابع اصلی تبدیل سکه - فقط ارزهای دیجیتال
safeAddEventListener('convertBtn', 'click', async function() {
    if (!userSystem.currentUser) {
        showNotification('Please log in to your account first', 'error');
        return;
    }
    
    const coinAmount = parseInt(safeGetValue('coinAmount')) || 1;
    
    if (coinAmount < 1) {
        showNotification('حداقل ۱ سکه برای تبدیل لازم است', 'error');
        return;
    }
    
    if (coinAmount > gameState.coinCount) {
        showNotification('You dont have enough coins', 'error');
        return;
    }
    
    // نمایش وضعیت در حال پردازش
    const convertBtn = safeGetElement('convertBtn');
    const originalText = convertBtn.innerHTML;
    convertBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> در حال تبدیل...';
    convertBtn.disabled = true;
    
    try {
        // دریافت نرخ‌های به‌روز
        await cryptoRateSystem.fetchAllRates();
        
        // محاسبه مقادیر برای هر ارز
        const amounts = cryptoRateSystem.calculateCryptoAmount(coinAmount);
        
        // کسر سکه‌ها از موجودی کاربر
        gameState.coinCount -= coinAmount;
        
        // اضافه کردن به موجودی ارزهای دیجیتال
        cryptoRateSystem.addToUserBalance(amounts);
        
        // نمایش نتایج تبدیل
        showNotification(
            `✅ ${coinAmount.toLocaleString()} Coins converted successfully<br>
            🎉 Your cryptocurrency balance has increased<br>
            - ${amounts.tether.toFixed(6)} USDT<br>
            - ${amounts.bitcoin.toFixed(8)} BTC<br>
            - ${amounts.ethereum.toFixed(6)} ETH`,
            'success'
        );
        
        // آپدیت نمایش‌ها
        updateAllDisplays();
        userSystem.saveUserData(gameState, levelSystem);
        
    } catch (error) {
        console.error('خطا در تبدیل سکه:', error);
        showNotification('خطا در محاسبه نرخ ارزها. لطفاً مجدداً تلاش کنید.', 'error');
    } finally {
        // بازگرداندن دکمه به حالت عادی
        convertBtn.innerHTML = originalText;
        convertBtn.disabled = false;
    }
});

safeAddEventListener('coinAmount', 'input', updateConversionAmount);

const navIcons = document.querySelectorAll('.nav-icon');
const sections = document.querySelectorAll('.section');

navIcons.forEach(icon => {
    icon.addEventListener('click', function(e) {
        e.preventDefault();
        
        // توقف تمام انیمیشن‌ها و تایمرهای فعال
        cleanupAllAnimations();
        
        navIcons.forEach(i => i.classList.remove('active'));
        this.classList.add('active');
        
        sections.forEach(section => {
            section.classList.remove('active');
            // غیرفعال کردن تمام انیمیشن‌ها در بخش‌های غیرفعال
            if (section.id !== this.getAttribute('data-section')) {
                stopSectionAnimations(section.id);
            }
        });
        
        const targetSection = this.getAttribute('data-section');
        const targetElement = safeGetElement(targetSection);
        if (targetElement) {
            targetElement.classList.add('active');
            // راه‌اندازی انیمیشن‌های بخش فعال
            initializeSectionAnimations(targetSection);
        }
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
});

safeAddEventListener('userAvatar', 'click', function() {
    sections.forEach(section => section.classList.remove('active'));
    const profileSection = safeGetElement('profile-section');
    if (profileSection) profileSection.classList.add('active');
    
    navIcons.forEach(icon => icon.classList.remove('active'));
    const profileNav = document.querySelector('[data-section="profile-section"]');
    if (profileNav) profileNav.classList.add('active');
});

safeAddEventListener('profileLoginBtn', 'click', function() {
    if (userSystem.currentUser) {
        userSystem.logout();
        updateUserInterface();
        showNotification('Successfully logged out of your account', 'info');
    } else {
        const registerModal = safeGetElement('registerModal');
        if (registerModal) registerModal.style.display = 'flex';
    }
});

safeAddEventListener('closeLoginModal', 'click', function() {
    const loginModal = safeGetElement('loginModal');
    if (loginModal) loginModal.style.display = 'none';
});

safeAddEventListener('closeRegisterModal', 'click', function() {
    const registerModal = safeGetElement('registerModal');
    if (registerModal) registerModal.style.display = 'none';
});

safeAddEventListener('closeVipModal', 'click', function() {
    closeVipModal();
});

safeAddEventListener('closeLimitModal', 'click', function() {
    closeLimitModal();
});

safeAddEventListener('showRegister', 'click', function(e) {
    e.preventDefault();
    const loginModal = safeGetElement('loginModal');
    const registerModal = safeGetElement('registerModal');
    
    if (loginModal) loginModal.style.display = 'none';
    if (registerModal) registerModal.style.display = 'flex';
    
    const urlParams = new URLSearchParams(window.location.search);
    const refCode = urlParams.get('ref');
    if (refCode) {
        safeSetValue('referralCode', refCode);
    }
});

safeAddEventListener('showLogin', 'click', function(e) {
    e.preventDefault();
    const registerModal = safeGetElement('registerModal');
    const loginModal = safeGetElement('loginModal');
    
    if (registerModal) registerModal.style.display = 'none';
    if (loginModal) loginModal.style.display = 'flex';
});

safeAddEventListener('loginBtnModal', 'click', function() {
    const email = safeGetValue('loginEmail');
    const password = safeGetValue('loginPassword');
    
    try {
        userSystem.login(email, password);
        const loginModal = safeGetElement('loginModal');
        if (loginModal) loginModal.style.display = 'none';
        updateUserInterface();
        
        showFormNotification('You have successfully signed in', 'success', 'login');
    } catch (error) {
        showFormNotification(error.message, 'error', 'login');
    }
});

safeAddEventListener('registerBtnModal', 'click', function() {
    const name = safeGetValue('registerName');
    const email = safeGetValue('registerEmail');
    const password = safeGetValue('registerPassword');
    const confirmPassword = safeGetValue('registerConfirmPassword');
    const referralCode = safeGetValue('referralCode');
    if (!email || email.trim() === '') {
        showFormNotification('Email is required', 'error', 'register');
        return;
    }
     
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        showFormNotification('Please enter a valid email address', 'error', 'register');
        return;
    }
    
    if (password !== confirmPassword) {
        showFormNotification('Passwords dont match', 'error', 'register');
        return;
    }
    
    if (name.length < 2) {
        showFormNotification('Please enter your username', 'error', 'register');
        return;
    }
    
    if (password.length < 6) {
        showFormNotification('Password must be at least 6', 'error', 'register');
        return;
    }
    
    try {
        userSystem.register(name, email, password, referralCode || null);
        userSystem.login(email, password);
        const registerModal = safeGetElement('registerModal');
        if (registerModal) registerModal.style.display = 'none';
        updateUserInterface();
        
        safeSetValue('registerName', '');
        safeSetValue('registerEmail', '');
        safeSetValue('registerPassword', '');
        safeSetValue('registerConfirmPassword', '');
        safeSetValue('referralCode', '');
        
        if (referralCode) {
            showFormNotification('Registration successful and referral code applied', 'success', 'register');
        } else {
            showFormNotification('Registration completed successfully', 'success', 'register');
        }
    } catch (error) {
        showFormNotification(error.message, 'error', 'register');
    }
});

safeAddEventListener('copyCodeBtn', 'click', function() {
    if (!userSystem.currentUser) {
        showNotification('Please log in to your account first', 'error');
        return;
    }
    
    const code = safeGetElement('personalReferralCode')?.textContent;
    if (code) {
        navigator.clipboard.writeText(code).then(() => {
            showNotification('Referral code copied successfully', 'success');
        }).catch(() => {
            const textArea = document.createElement('textarea');
            textArea.value = code;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showNotification('Referral code copied successfully', 'success');
        });
    }
});

['loginModal', 'registerModal', 'vipActivatedModal', 'limitReachedModal', 'adminLoginModal'].forEach(modalId => {
    const modal = safeGetElement(modalId);
    if (modal) {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                if (modalId === 'vipActivatedModal') {
                    closeVipModal();
                } else if (modalId === 'limitReachedModal') {
                    closeLimitModal();
                } else if (modalId === 'adminLoginModal') {
                    adminSystem.hideAdminLogin();
                } else {
                    modal.style.display = 'none';
                }
            }
        });
    }
});

// راه‌اندازی بازی
window.addEventListener('load', initGame);
</script>
// ==================== سیستم ارتباط با سرور ====================
const API_BASE = '';

async function registerUser(name, email, password) {
    try {
        const response = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, password })
        });
        return await response.json();
    } catch (error) {
        return { error: 'Connection failed' };
    }
}

async function loginUser(email, password) {
    try {
        const response = await fetch('/api/login', {
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });
        return await response.json();
    } catch (error) {
        return { error: 'Connection failed' };
    }
}

async function updateUserData(userId, data) {
    try {
        const response = await fetch('/api/user/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId, ...data })
        });
        return await response.json();
    } catch (error) {
        console.log('Failed to save data');
    }
}
<script>
// سیستم نوتیفیکیشن زنگوله - نسخه اصلاح شده
class NotificationManager {
    constructor() {
        this.notifications = [];
        this.isInitialized = false;
    }

    init() {
        if (this.isInitialized) return;
        
        this.createBellHTML();
        this.loadNotifications();
        this.setupEventListeners();
        this.updateDisplay();
        this.isInitialized = true;
        
        console.log('🔔 Notification system is now active');
    }

    createBellHTML() {
        // اگر از قبل وجود دارد، حذف کن
        const existingBell = document.getElementById('notificationBell');
        const existingPanel = document.getElementById('notificationPanel');
        if (existingBell) existingBell.remove();
        if (existingPanel) existingPanel.remove();

        // ایجاد HTML زنگوله - زیر هدر
        const bellHTML = `
            <div class="notification-bell" id="notificationBell">
                <i class="fas fa-bell"></i>
                <div class="notification-badge" id="notificationBadge" style="display: none;">0</div>
            </div>

            <div class="notification-panel" id="notificationPanel">
                <div class="notification-header">
                    <h3><i class="fas fa-bell"></i> New Messages</h3>
                    <div>
                        <button class="notification-clear" id="notificationClear" title="پاک کردن همه">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="notification-close" id="notificationClose">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="notification-list" id="notificationList">
                    <div class="notification-empty">
                        <i class="fas fa-bell-slash"></i>
                        <div>No messages available</div>
                    </div>
                </div>
            </div>
        `;

        // قرار دادن زیر هدر
        const header = document.querySelector('header');
        if (header) {
            header.insertAdjacentHTML('afterend', bellHTML);
        } else {
            document.body.insertAdjacentHTML('afterbegin', bellHTML);
        }
    }

    setupEventListeners() {
        // کلیک روی زنگوله
        document.getElementById('notificationBell').addEventListener('click', (e) => {
            e.stopPropagation();
            this.togglePanel();
        });

        // بستن پنل
        document.getElementById('notificationClose').addEventListener('click', (e) => {
            e.stopPropagation();
            this.hidePanel();
        });

        // پاک کردن همه
        document.getElementById('notificationClear').addEventListener('click', (e) => {
            e.stopPropagation();
            this.clearAll();
        });

        // کلیک خارج از پنل
        document.addEventListener('click', (e) => {
            const panel = document.getElementById('notificationPanel');
            const bell = document.getElementById('notificationBell');
            
            if (panel.classList.contains('show') && 
                !panel.contains(e.target) && 
                !bell.contains(e.target)) {
                this.hidePanel();
            }
        });

        // جلوگیری از بستن پنل وقتی داخلش کلیک میشه
        document.getElementById('notificationPanel').addEventListener('click', (e) => {
            e.stopPropagation();
        });
    }

    togglePanel() {
        const panel = document.getElementById('notificationPanel');
        if (panel.classList.contains('show')) {
            this.hidePanel();
        } else {
            this.showPanel();
        }
    }

    showPanel() {
        const panel = document.getElementById('notificationPanel');
        panel.classList.add('show');
        this.markAllAsRead();
    }

    hidePanel() {
        const panel = document.getElementById('notificationPanel');
        panel.classList.remove('show');
    }

    // ارسال پیام جدید
    sendNotification(message, type = 'info') {
        const notification = {
            id: Date.now() + Math.random(),
            message: message,
            type: type,
            timestamp: Date.now(),
            read: false
        };
        
        this.notifications.unshift(notification);
        this.saveNotifications();
        this.updateDisplay();
        this.showNotificationAlert(notification);
        
        return notification;
    }

    showNotificationAlert(notification) {
        // ایجاد هشدار موقت
        const alert = document.createElement('div');
        alert.className = 'notification-alert';
        alert.style.cssText = `
            position: fixed;
            top: 90px;
            right: 20px;
            background: rgba(20, 20, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 15px 20px;
            color: white;
            z-index: 1001;
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 300px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            font-family: 'Vazirmatn', sans-serif;
        `;
        
        alert.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <i class="fas fa-bell" style="color: #ffd700;"></i>
                <strong style="color: #ffd700;">پیام جدید</strong>
            </div>
            <div style="font-size: 0.9rem; line-height: 1.4;">${notification.message}</div>
        `;
        
        document.body.appendChild(alert);
        
        // نمایش
        setTimeout(() => {
            alert.style.transform = 'translateX(0)';
        }, 100);
        
        // پنهان کردن
        setTimeout(() => {
            alert.style.transform = 'translateX(400px)';
            setTimeout(() => {
                if (alert.parentNode) alert.remove();
            }, 400);
        }, 5000);
    }

    updateDisplay() {
        const list = document.getElementById('notificationList');
        const badge = document.getElementById('notificationBadge');
        const unreadCount = this.getUnreadCount();
        
        // آپدیت بج
        if (unreadCount > 0) {
            badge.style.display = 'flex';
            badge.textContent = unreadCount > 9 ? '9+' : unreadCount.toString();
        } else {
            badge.style.display = 'none';
        }
        
        // آپدیت لیست
        if (this.notifications.length === 0) {
            list.innerHTML = `
                <div class="notification-empty">
                    <i class="fas fa-bell-slash"></i>
                    <div>No messages</div>
                </div>
            `;
            return;
        }
        
        list.innerHTML = this.notifications.map(notif => `
            <div class="notification-item ${notif.read ? '' : 'unread'}" 
                 onclick="window.notificationManager.markAsRead('${notif.id}')">
                <div class="notification-content">
                    ${notif.message}
                </div>
                <div class="notification-time">
                    <i class="fas fa-clock"></i>
                    ${this.formatTime(notif.timestamp)}
                </div>
            </div>
        `).join('');
    }

    markAsRead(notificationId) {
        const notification = this.notifications.find(n => n.id == notificationId);
        if (notification && !notification.read) {
            notification.read = true;
            this.saveNotifications();
            this.updateDisplay();
        }
    }

    markAllAsRead() {
        let changed = false;
        this.notifications.forEach(notif => {
            if (!notif.read) {
                notif.read = true;
                changed = true;
            }
        });
        
        if (changed) {
            this.saveNotifications();
            this.updateDisplay();
        }
    }

    getUnreadCount() {
        return this.notifications.filter(notif => !notif.read).length;
    }

    formatTime(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diff = now - date;
        
        if (diff < 60 * 1000) {
            return 'Just now';
        } else if (diff < 60 * 60 * 1000) {
            const minutes = Math.floor(diff / (60 * 1000));
            return `${minutes} minutes ago`;
        } else if (diff < 24 * 60 * 60 * 1000) {
            const hours = Math.floor(diff / (60 * 60 * 1000));
            return `${hours} hours ago`;
        } else {
            return date.toLocaleDateString('fa-IR');
        }
    }

    saveNotifications() {
        localStorage.setItem('user_notifications', JSON.stringify(this.notifications));
    }

    loadNotifications() {
        try {
            const saved = localStorage.getItem('user_notifications');
            if (saved) {
                this.notifications = JSON.parse(saved);
            }
        } catch (error) {
            console.warn('خطا در بارگذاری نوتیفیکیشن‌ها:', error);
            this.notifications = [];
        }
    }

    clearAll() {
        if (confirm('آیا از پاک کردن همه پیام‌ها اطمینان دارید؟')) {
            this.notifications = [];
            this.saveNotifications();
            this.updateDisplay();
            this.hidePanel();
            
            // نمایش پیام موفقیت
            if (window.adminSystem && window.adminSystem.showAdminNotification) {
                window.adminSystem.showAdminNotification('همه پیام‌ها پاک شدند', 'success');
            }
        }
    }
}

// ایجاد نمونه جهانی
window.notificationManager = new NotificationManager();

// راه‌اندازی وقتی صفحه لود شد
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        window.notificationManager.init();
    }, 1000);
});

// تابع برای پنل مدیریت
window.sendAdminNotification = function() {
    const messageInput = document.getElementById('adminNotificationMessage');
    const message = messageInput ? messageInput.value : '';
    
    if (!message || message.trim() === '') {
        alert('لطفاً متن پیام را وارد کنید');
        return;
    }
    
    if (window.notificationManager) {
        window.notificationManager.sendNotification(message);
        
        // پاک کردن فیلد متن
        if (messageInput) {
            messageInput.value = '';
        }
        
        // نمایش موفقیت در پنل مدیریت
        if (window.adminSystem && window.adminSystem.showAdminNotification) {
            window.adminSystem.showAdminNotification('پیام با موفقیت ارسال شد', 'success');
        } else {
            alert('پیام با موفقیت ارسال شد!');
        }
    } else {
        alert('سیستم نوتیفیکیشن در دسترس نیست');
    }
};

// تابع پاک کردن همه پیام‌ها از پنل مدیریت
window.clearAllNotifications = function() {
    if (window.notificationManager) {
        window.notificationManager.clearAll();
    } else {
        alert('سیستم نوتیفیکیشن در دسترس نیست');
    }
};
</script>

<style>
/* استایل‌های سیستم نوتیفیکیشن - نسخه اصلاح شده */
.notification-bell {
    position: fixed;
    top: 80px; /* زیر هدر */
    left: 20px;
    background: linear-gradient(135deg, #ffd700, #ff6b00);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1000;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    transition: all 0.3s ease;
}

.notification-bell:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
}

.notification-bell i {
    color: white;
    font-size: 1.3rem;
}

.notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff4757;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 0.7rem;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: pulse 1.5s infinite;
}

.notification-panel {
    position: fixed;
    top: 140px; /* زیر زنگوله */
    left: 20px;
    width: 350px;
    background: rgba(20, 20, 30, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 15px;
    border: 1px solid rgba(255, 215, 0, 0.3);
    z-index: 1000;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    transform: translateX(-400px);
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    max-height: 500px;
    overflow: hidden;
}

.notification-panel.show {
    transform: translateX(0);
}

.notification-header {
    padding: 15px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notification-header h3 {
    color: #ffd700;
    margin: 0;
    font-size: 1.1rem;
}

.notification-header div {
    display: flex;
    gap: 10px;
}

.notification-close, .notification-clear {
    background: none;
    border: none;
    color: #b0b0b0;
    cursor: pointer;
    font-size: 1.2rem;
    transition: all 0.3s ease;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.notification-close:hover {
    color: #ffd700;
    background: rgba(255, 215, 0, 0.1);
}

.notification-clear:hover {
    color: #ff4757;
    background: rgba(255, 71, 87, 0.1);
}

.notification-list {
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
}

.notification-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
    border-left: 3px solid #ffd700;
    transition: all 0.3s ease;
    cursor: pointer;
}

.notification-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(5px);
}

.notification-item.unread {
    background: rgba(255, 215, 0, 0.1);
    border-left-color: #ffd700;
}

.notification-content {
    color: #ffffff;
    font-size: 0.9rem;
    line-height: 1.4;
    margin-bottom: 8px;
}

.notification-time {
    color: #b0b0b0;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    gap: 5px;
}

.notification-empty {
    text-align: center;
    padding: 40px 20px;
    color: #b0b0b0;
}

.notification-empty i {
    font-size: 3rem;
    margin-bottom: 15px;
    opacity: 0.5;
}

/* اسکرول بار */
.notification-list::-webkit-scrollbar {
    width: 4px;
}

.notification-list::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
}

.notification-list::-webkit-scrollbar-thumb {
    background: #ffd700;
    border-radius: 2px;
}

.notification-list::-webkit-scrollbar-thumb:hover {
    background: #ff6b00;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}
</style>
<script>
// سیستم مدیریت پرداخت‌های USDT - نسخه نهایی با تب‌بندی
const usdtAdminSystem = {
    currentTab: 'pending',
    
    init() {
        this.addAdminButton();
        this.setupEventListeners();
        console.log('✅ سیستم مدیریت پرداخت USDT راه‌اندازی شد');
    },

    addAdminButton() {
        const adminOperationsSection = document.getElementById('admin-operations-section');
        
        if (!adminOperationsSection) {
            console.log('❌ بخش admin-operations-section پیدا نشد');
            setTimeout(() => this.addAdminButton(), 1000);
            return;
        }

        const existingBtn = document.getElementById('usdtAdminBtn');
        if (existingBtn) {
            existingBtn.remove();
        }

        const usdtBtn = document.createElement('button');
        usdtBtn.id = 'usdtAdminBtn';
        usdtBtn.className = 'admin-btn admin-btn-primary';
        usdtBtn.innerHTML = `
            <i class="fab fa-usdt"></i>
            مدیریت پرداخت‌های USDT
        `;
        usdtBtn.style.cssText = `
            width: 100%;
            margin: 10px 0;
            padding: 15px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        `;
        usdtBtn.onclick = () => this.showUsdtPayments();

        adminOperationsSection.insertBefore(usdtBtn, adminOperationsSection.firstChild);
        
        console.log('✅ دکمه مدیریت USDT اضافه شد');
        this.addStatsToAdminPanel();
    },

    addStatsToAdminPanel() {
        const statsSection = document.querySelector('.admin-stats-grid');
        if (!statsSection) {
            console.log('❌ بخش آمار پیدا نشد');
            return;
        }

        const existingStats = document.getElementById('usdtAdminStats');
        if (existingStats) {
            existingStats.remove();
        }

        const usdtStats = document.createElement('div');
        usdtStats.className = 'admin-stat-card';
        usdtStats.id = 'usdtAdminStats';
        usdtStats.innerHTML = `
            <div class="admin-stat-icon">
                <i class="fab fa-usdt"></i>
            </div>
            <div class="admin-stat-value" id="usdtTotalRevenue">0</div>
            <div class="admin-stat-label">درآمد USDT</div>
        `;

        statsSection.appendChild(usdtStats);
        this.updateAdminStats();
    },

    updateAdminStats() {
        const requests = JSON.parse(localStorage.getItem('usdt_payment_requests') || '[]');
        const totalRevenue = requests
            .filter(req => req.status === 'approved')
            .reduce((sum, req) => sum + (req.amount || 0), 0);

        const revenueElement = document.getElementById('usdtTotalRevenue');
        if (revenueElement) {
            revenueElement.textContent = totalRevenue.toLocaleString();
        }
    },

    showUsdtPayments() {
        console.log('📋 نمایش درخواست‌های USDT');
        
        const requests = JSON.parse(localStorage.getItem('usdt_payment_requests') || '[]');
        
        const oldPanel = document.getElementById('usdtAdminPanel');
        if (oldPanel) oldPanel.remove();

        const panel = document.createElement('div');
        panel.id = 'usdtAdminPanel';
        panel.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a1a;
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 25px;
            z-index: 10000;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            color: white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            font-family: Tahoma, sans-serif;
        `;

        const pendingRequests = requests.filter(req => req.status === 'pending');
        const approvedRequests = requests.filter(req => req.status === 'approved');
        
        const total = requests.length;
        const pending = pendingRequests.length;
        const approved = approvedRequests.length;
        const totalRevenue = approvedRequests.reduce((sum, req) => sum + (req.amount || 0), 0);

        let html = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px;">
                <h3 style="margin: 0; color: #00ff88; display: flex; align-items: center; gap: 10px;">
                    💰 مدیریت پرداخت‌های USDT
                </h3>
                <button onclick="usdtAdminSystem.closePanel()" 
                        style="background: #ff4757; border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 16px;">
                    ×
                </button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                <div style="background: #2a2a2a; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 1.8rem; color: #00ff88; font-weight: bold;">${total}</div>
                    <div style="color: #888; font-size: 0.8rem;">کل درخواست‌ها</div>
                </div>
                <div style="background: #2a2a2a; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 1.8rem; color: orange; font-weight: bold;">${pending}</div>
                    <div style="color: #888; font-size: 0.8rem;">در انتظار</div>
                </div>
                <div style="background: #2a2a2a; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 1.8rem; color: #00ff88; font-weight: bold;">${approved}</div>
                    <div style="color: #888; font-size: 0.8rem;">تایید شده</div>
                </div>
                <div style="background: #2a2a2a; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 1.8rem; color: #0099ff; font-weight: bold;">${totalRevenue}</div>
                    <div style="color: #888; font-size: 0.8rem;">درآمد (USDT)</div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 20px; background: #2a2a2a; padding: 10px; border-radius: 10px;">
                <button onclick="usdtAdminSystem.switchTab('pending')" 
                        style="flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; 
                               background: ${this.currentTab === 'pending' ? '#00ff88' : '#333'}; 
                               color: ${this.currentTab === 'pending' ? '#000' : '#fff'};">
                    ⏳ در انتظار تایید (${pending})
                </button>
                <button onclick="usdtAdminSystem.switchTab('approved')" 
                        style="flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
                               background: ${this.currentTab === 'approved' ? '#0099ff' : '#333'}; 
                               color: ${this.currentTab === 'approved' ? '#000' : '#fff'};">
                    ✅ تایید شده‌ها (${approved})
                </button>
            </div>
        `;

        if (this.currentTab === 'pending') {
            if (pendingRequests.length === 0) {
                html += `
                    <div style="text-align: center; padding: 40px 20px; color: #888;">
                        <div style="font-size: 3rem; margin-bottom: 15px;">✅</div>
                        <h4 style="margin: 0 0 10px 0;">هیچ درخواست در انتظاری وجود ندارد</h4>
                        <p style="margin: 0;">تمام درخواست‌ها بررسی شده‌اند</p>
                    </div>
                `;
            } else {
                pendingRequests.forEach(request => {
                    html += this.renderRequestCard(request, 'pending');
                });
            }
        } else {
            if (approvedRequests.length === 0) {
                html += `
                    <div style="text-align: center; padding: 40px 20px; color: #888;">
                        <div style="font-size: 3rem; margin-bottom: 15px;">📝</div>
                        <h4 style="margin: 0 0 10px 0;">هیچ درخواست تایید شده‌ای وجود ندارد</h4>
                        <p style="margin: 0;">درخواست‌های تایید شده در اینجا نمایش داده می‌شوند</p>
                    </div>
                `;
            } else {
                approvedRequests.forEach(request => {
                    html += this.renderRequestCard(request, 'approved');
                });
            }
        }

        html += `
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="usdtAdminSystem.refreshPanel()" 
                        style="flex: 1; padding: 12px; background: #0099ff; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">
                    🔄 بروزرسانی لیست
                </button>
                <button onclick="usdtAdminSystem.closePanel()" 
                        style="padding: 12px 25px; background: #666; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">
                    بستن
                </button>
            </div>
        `;

        panel.innerHTML = html;
        document.body.appendChild(panel);
    },

    renderRequestCard(request, status) {
        const userHasVip = this.checkUserHasVip(request.userId);
        const currentVipPlan = userHasVip ? this.getUserVipPlan(request.userId) : null;
        const date = new Date(request.timestamp).toLocaleString('fa-IR');
        const approvedDate = request.approvedDate ? new Date(request.approvedDate).toLocaleString('fa-IR') : '';
        const planNames = {1: 'Silver', 2: 'Gold', 3: 'Diamond'};

        return `
            <div style="background: #2a2a2a; border-radius: 12px; padding: 20px; margin-bottom: 15px; border: 1px solid #333; position: relative;">
                <div style="position: absolute; top: -10px; right: 20px; background: ${status === 'pending' ? 'orange' : '#00ff88'}; padding: 4px 12px; border-radius: 12px; z-index: 2;">
                    <div style="color: white; font-weight: bold; font-size: 0.75rem; display: flex; align-items: center; gap: 4px;">
                        ${status === 'pending' ? '⏳ در انتظار تایید' : '✅ تایید شده'}
                    </div>
                </div>

                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                    <div style="width: 45px; height: 45px; background: linear-gradient(135deg, #00ff88, #0099ff); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1rem;">
                        ${request.userName ? request.userName.charAt(0) : 'U'}
                    </div>
                    <div>
                        <div style="font-weight: bold; color: white; font-size: 1.1rem;">${request.userName || 'نامشخص'}</div>
                        <div style="color: #888; font-size: 0.8rem;">${request.userEmail || 'ایمیل نامشخص'}</div>
                        ${userHasVip ? `
                            <div style="color: #ffd700; font-size: 0.7rem; margin-top: 4px;">
                                ⭐ کاربر دارای VIP ${currentVipPlan} است
                            </div>
                        ` : ''}
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;">
                    <div style="background: #1a1a1a; padding: 12px; border-radius: 8px; border-left: 3px solid #00ff88;">
                        <div style="color: #888; font-size: 0.8rem; margin-bottom: 6px;">پلن VIP</div>
                        <div style="color: white; font-weight: bold; font-size: 0.95rem;">${planNames[request.planId]}</div>
                    </div>
                    <div style="background: #1a1a1a; padding: 12px; border-radius: 8px; border-left: 3px solid #0099ff;">
                        <div style="color: #888; font-size: 0.8rem; margin-bottom: 6px;">مبلغ پرداخت</div>
                        <div style="color: #00ff88; font-weight: bold; font-size: 0.95rem;">${request.amount} USDT</div>
                    </div>
                </div>

                <div style="background: #1a1a1a; padding: 10px; border-radius: 8px; margin-bottom: 12px;">
                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 4px;">تاریخ درخواست</div>
                    <div style="color: white; font-size: 0.85rem;">${date}</div>
                </div>

                ${status === 'approved' ? `
                    <div style="background: #1a1a1a; padding: 10px; border-radius: 8px; margin-bottom: 12px;">
                        <div style="color: #888; font-size: 0.8rem; margin-bottom: 4px;">تاریخ تایید</div>
                        <div style="color: #00ff88; font-size: 0.85rem;">${approvedDate}</div>
                    </div>
                ` : ''}

                <div style="background: #1a1a1a; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 6px;">شناسه تراکنش (TXID)</div>
                    <div style="font-family: monospace; font-size: 0.75rem; color: white; word-break: break-all; background: #000; padding: 8px; border-radius: 4px; line-height: 1.4;">
                        ${request.txid}
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    ${status === 'pending' ? `
                        <button onclick="usdtAdminSystem.approvePayment('${request.txid}')" 
                                style="flex: 1; padding: 12px; background: #00ff88; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 0.9rem;">
                            ✅ تایید و فعال‌سازی VIP
                        </button>
                        <button onclick="usdtAdminSystem.rejectRequest('${request.txid}')" 
                                style="padding: 12px 20px; background: #ff4757; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 0.9rem;">
                            ❌ رد درخواست
                        </button>
                    ` : `
                        <button onclick="usdtAdminSystem.deleteApprovedRequest('${request.txid}')" 
                                style="flex: 1; padding: 12px; background: #ff4757; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 0.9rem;">
                            🗑️ حذف از لیست
                        </button>
                        <button onclick="usdtAdminSystem.checkVipStatus('${request.userId}')" 
                                style="padding: 12px 20px; background: #0099ff; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 0.9rem;">
                            🔍 بررسی وضعیت VIP
                        </button>
                    `}
                </div>
            </div>
        `;
    },

    switchTab(tabName) {
        this.currentTab = tabName;
        this.refreshPanel();
    },

    closePanel() {
        const panel = document.getElementById('usdtAdminPanel');
        if (panel) panel.remove();
    },

    refreshPanel() {
        this.showUsdtPayments();
        this.updateAdminStats();
    },

    checkUserHasVip(userId) {
        if (!window.userSystem || !window.userSystem.userData || !window.userSystem.userData[userId]) {
            return false;
        }
        return window.userSystem.userData[userId].vipStatus && 
               window.userSystem.userData[userId].vipStatus.isActive;
    },

    getUserVipPlan(userId) {
        if (!window.userSystem || !window.userSystem.userData[userId]) return null;
        const vipStatus = window.userSystem.userData[userId].vipStatus;
        if (!vipStatus || !vipStatus.isActive) return null;
        const planNames = {1: 'Silver', 2: 'Gold', 3: 'Diamond'};
        return planNames[vipStatus.id] || vipStatus.id;
    },

    approvePayment(txid) {
        if (!confirm('آیا از تایید این درخواست و فعال‌سازی VIP کاربر اطمینان دارید؟')) return;

        const requests = JSON.parse(localStorage.getItem('usdt_payment_requests') || '[]');
        const requestIndex = requests.findIndex(req => req.txid === txid);
        
        if (requestIndex === -1) {
            alert('درخواست پیدا نشد!');
            return;
        }

        const request = requests[requestIndex];
        
        // تغییر وضعیت به approved
        requests[requestIndex].status = 'approved';
        requests[requestIndex].approvedDate = Date.now();
        requests[requestIndex].approvedBy = 'admin';
        
        localStorage.setItem('usdt_payment_requests', JSON.stringify(requests));
        
        // فعال‌سازی VIP
        this.activateUserVip(request.userId, request.planId);
        
        // آپدیت سیستم‌ها
        if (window.adminSystem) {
            window.adminSystem.updateAdminStats();
            window.adminSystem.loadUsersTable();
        }
        
        this.refreshPanel();
        
        if (window.adminSystem && window.adminSystem.showAdminNotification) {
            window.adminSystem.showAdminNotification(
                `✅ درخواست کاربر ${request.userName} تایید و VIP فعال شد`,
                'success'
            );
        }
        
        console.log('✅ درخواست تایید شد:', txid);
    },

    rejectRequest(txid) {
        if (!confirm('آیا از رد این درخواست اطمینان دارید؟')) return;

        const requests = JSON.parse(localStorage.getItem('usdt_payment_requests') || '[]');
        const requestIndex = requests.findIndex(req => req.txid === txid);
        
        if (requestIndex === -1) {
            alert('درخواست پیدا نشد!');
            return;
        }

        const request = requests[requestIndex];
        
        requests.splice(requestIndex, 1);
        localStorage.setItem('usdt_payment_requests', JSON.stringify(requests));
        
        this.refreshPanel();
        
        if (window.adminSystem && window.adminSystem.showAdminNotification) {
            window.adminSystem.showAdminNotification(
                `❌ درخواست کاربر ${request.userName} رد شد`,
                'error'
            );
        }
    },

    deleteApprovedRequest(txid) {
        if (!confirm('آیا از حذف این درخواست تایید شده اطمینان دارید؟')) return;

        const requests = JSON.parse(localStorage.getItem('usdt_payment_requests') || '[]');
        const requestIndex = requests.findIndex(req => req.txid === txid);
        
        if (requestIndex === -1) {
            alert('درخواست پیدا نشد!');
            return;
        }

        requests.splice(requestIndex, 1);
        localStorage.setItem('usdt_payment_requests', JSON.stringify(requests));
        
        this.refreshPanel();
        
        if (window.adminSystem && window.adminSystem.showAdminNotification) {
            window.adminSystem.showAdminNotification(
                `🗑️ درخواست تایید شده حذف شد`,
                'warning'
            );
        }
    },

    checkVipStatus(userId) {
        const userData = JSON.parse(localStorage.getItem('userData') || '{}');
        const user = userData[userId];
        
        if (user && user.vipStatus && user.vipStatus.isActive) {
            const planNames = {1: 'Silver', 2: 'Gold', 3: 'Diamond'};
            const planName = planNames[user.vipStatus.id] || user.vipStatus.id;
            alert(`✅ کاربر دارای VIP ${planName} است\nتاریخ فعال‌سازی: ${new Date(user.vipStatus.activationDate).toLocaleString('fa-IR')}`);
        } else {
            alert('❌ کاربر VIP فعال ندارد');
        }
    },

    activateUserVip(userId, planId) {
        console.log('فعال‌سازی VIP برای کاربر:', userId, 'پلن:', planId);
        
        let userData = JSON.parse(localStorage.getItem('userData') || '{}');
        
        if (!userData[userId]) {
            userData[userId] = {
                vipStatus: null,
                joinDate: new Date().toISOString()
            };
        }

        const planNames = {1: 'Silver', 2: 'Gold', 3: 'Diamond'};
        const planPrices = {1: 10, 2: 20, 3: 30};
        
        const vipStatus = {
            id: parseInt(planId),
            name: planNames[planId] || 'نامشخص',
            price: planPrices[planId] || 0,
            dailyLimit: planId == 3 ? -1 : (planId == 2 ? 500000 : 100000),
            duration: 30,
            isActive: true,
            purchaseDate: new Date().toISOString(),
            activationDate: Date.now(),
            paymentMethod: 'USDT'
        };

        userData[userId].vipStatus = vipStatus;

        localStorage.setItem('userData', JSON.stringify(userData));
        
        // آپدیت real-time
        if (window.userSystem && window.userSystem.userData) {
            window.userSystem.userData[userId] = userData[userId];
            
            if (window.userSystem.currentUser && window.userSystem.currentUser.id === userId) {
                if (window.vipSystem) {
                    window.vipSystem.currentVip = vipStatus;
                    window.vipSystem.dailyCollected = 0;
                    window.vipSystem.lastResetDate = Date.now();
                    
                    // آپدیت نمایش‌ها
                    if (window.updateLimitDisplay) window.updateLimitDisplay();
                    if (window.generateVipPlans) window.generateVipPlans();
                    if (window.updateVipStatus) window.updateVipStatus();
                    if (window.updateResetTimerDisplay) window.updateResetTimerDisplay();
                }
            }
        }

        console.log('✅ VIP activated for user', userId);
    },

    setupEventListeners() {
        setInterval(() => {
            const adminOperations = document.getElementById('admin-operations-section');
            const usdtBtn = document.getElementById('usdtAdminBtn');
            
            if (adminOperations && adminOperations.classList.contains('active') && !usdtBtn) {
                this.addAdminButton();
            }
        }, 2000);
    }
};

// راه‌اندازی سیستم
document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 راه‌اندازی سیستم مدیریت پرداخت USDT');
    
    setTimeout(() => {
        if (window.adminSystem) {
            usdtAdminSystem.init();
        } else {
            console.log('⏳ منتظر بارگذاری سیستم مدیریت...');
            const checkAdminSystem = setInterval(() => {
                if (window.adminSystem) {
                    clearInterval(checkAdminSystem);
                    usdtAdminSystem.init();
                }
            }, 1000);
        }
    }, 2000);
});
</script>
</body>
</html>